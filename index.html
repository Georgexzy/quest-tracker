<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Life Quest RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        fitness: '#ef4444',
                        nutrition: '#16a34a',
                        hydration: '#3b82f6',
                        wellness: '#a855f7',
                        focus: '#f59e0b',
                        personal: '#6366f1'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .floating-notification {
            animation: slideInRight 0.5s ease-out, slideOutRight 0.5s ease-in 2.5s forwards;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .xp-burst {
            animation: xpBurst 2s ease-out forwards;
        }
        @keyframes xpBurst {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            50% { transform: scale(1.2) translateY(-20px); opacity: 1; }
            100% { transform: scale(1) translateY(-60px); opacity: 0; }
        }
        .level-up {
            animation: levelUp 1s ease-out;
        }
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-bottom: 2px solid #ffffff;
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">
    
    <div class="min-h-screen">
        <!-- Header -->
        <header class="gradient-bg text-white p-4 shadow-lg">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold">üèÜ Life Quest RPG</h1>
                        <span class="text-sm opacity-90">Ultimate AI Edition</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showStorageInfo()" class="glass-effect px-3 py-1 rounded-lg text-sm hover:bg-white/20">
                            üíæ Storage
                        </button>
                        <button onclick="showProfile()" class="glass-effect px-3 py-1 rounded-lg text-sm hover:bg-white/20">
                            ‚öôÔ∏è Profile
                        </button>
                        <div class="text-right">
                            <div id="playerLevel" class="font-bold">Level 1</div>
                            <div class="text-xs opacity-90">
                                <span id="currentXP">0</span>/<span id="nextLevelXP">100</span> XP
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- XP Progress Bar -->
                <div class="mt-3">
                    <div class="bg-white/20 rounded-full h-2">
                        <div id="xpProgress" class="bg-yellow-400 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="gradient-bg border-b border-white/20">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex space-x-6 overflow-x-auto">
                    <button onclick="switchTab('dashboard')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap active">
                        üìä Dashboard
                    </button>
                    <button onclick="switchTab('exercise')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üí™ Exercise
                    </button>
                    <button onclick="switchTab('nutrition')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        ü•ó Nutrition
                    </button>
                    <button onclick="switchTab('health')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üèÉ‚Äç‚ôÇÔ∏è Health
                    </button>
                    <button onclick="switchTab('ai')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üß† AI Coach
                    </button>
                    <button onclick="switchTab('tasks')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üìã Tasks
                    </button>
                    <button onclick="switchTab('music')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üéµ Music
                    </button>
                    <button onclick="switchTab('settings')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        ‚öôÔ∏è Settings
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto p-4">
            <!-- AI Insights (visible on all tabs) -->
            <div id="aiInsights" class="mb-6"></div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-fitness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-fitness">üèÉ‚Äç‚ôÇÔ∏è</span>
                            <span id="stepsCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Steps</div>
                        <div class="text-xs text-fitness">Goal: 8,000</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-hydration/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-hydration">üíß</span>
                            <span id="waterCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Water</div>
                        <div class="text-xs text-hydration">Goal: 8 glasses</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-nutrition/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-nutrition">ü•ó</span>
                            <span id="caloriesCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Calories</div>
                        <div class="text-xs text-nutrition">Target: 2000</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-focus/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-focus">üß†</span>
                            <span id="focusCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Focus (min)</div>
                        <div class="text-xs text-focus">Goal: 120</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-wellness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-wellness">üò¥</span>
                            <span id="sleepCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Sleep (hrs)</div>
                        <div class="text-xs text-wellness">Goal: 8</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-fitness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-fitness">üí™</span>
                            <span id="workoutCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Workouts</div>
                        <div class="text-xs text-fitness">Goal: 1</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">üìã Today's Quests</h3>
                        <div id="tasksList" class="space-y-2 max-h-64 overflow-y-auto mb-4">
                            <!-- Tasks will be populated here -->
                        </div>
                        <button onclick="addCustomTask()" class="w-full bg-personal text-white py-2 rounded hover:bg-indigo-600">
                            ‚ûï Add Custom Quest
                        </button>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">üèÜ Recent Achievements</h3>
                        <div id="achievementsList" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Achievements will be populated here -->
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">‚ö° Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="trackWater()" class="bg-hydration text-white p-3 rounded-lg hover:bg-blue-600 text-sm">
                                üíß Water
                            </button>
                            <button onclick="logWorkout()" class="bg-fitness text-white p-3 rounded-lg hover:bg-red-600 text-sm">
                                üí™ Workout
                            </button>
                            <button onclick="logMeal()" class="bg-nutrition text-white p-3 rounded-lg hover:bg-green-600 text-sm">
                                ü•ó Meal
                            </button>
                            <button onclick="startPomodoro()" class="bg-focus text-white p-3 rounded-lg hover:bg-yellow-600 text-sm">
                                üçÖ Focus
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exercise Tab -->
            <div id="exercise-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Daily Steps Tracker -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-orange-500">üö∂‚Äç‚ôÇÔ∏è Daily Steps</h3>
                            
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <div class="text-3xl font-bold text-orange-500" id="exerciseSteps">0</div>
                                        <div class="text-sm text-gray-500">Today's Steps</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-gray-700 dark:text-gray-300" id="stepGoal">8,000</div>
                                        <div class="text-xs text-gray-500">Daily Goal</div>
                                    </div>
                                </div>
                                
                                <!-- Steps Progress Bar -->
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-3">
                                    <div id="stepsProgress" class="bg-orange-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                
                                <div class="text-xs text-center text-gray-600 dark:text-gray-400" id="stepsStatus">
                                    Start walking to reach your goal!
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="quickLogSteps()" class="bg-orange-500 text-white py-3 px-4 rounded-lg hover:bg-orange-600 font-medium">
                                    üìù Log Steps
                                </button>
                                <button onclick="adjustStepGoal()" class="bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 font-medium">
                                    üéØ Set Goal
                                </button>
                            </div>
                            
                            <div class="mt-4 text-center">
                                <div class="text-xs text-purple-600 dark:text-purple-400" id="stepInsight">
                                    <!-- AI insight about steps will appear here -->
                                </div>
                            </div>
                        </div>

                        <!-- Today's Exercise Progress -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-fitness">üí™ Today's Exercise</h3>
                            
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-fitness" id="exerciseWorkouts">0</div>
                                    <div class="text-sm text-gray-500">Workouts</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-500" id="exerciseCalories">0</div>
                                    <div class="text-sm text-gray-500">Calories</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-500" id="exerciseMinutes">0</div>
                                    <div class="text-sm text-gray-500">Minutes</div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <button onclick="quickStartWorkout('cardio')" class="w-full text-left px-4 py-3 bg-red-50 dark:bg-red-900/30 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/50 border border-red-200 dark:border-red-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üèÉ‚Äç‚ôÇÔ∏è</span>
                                            <div>
                                                <div class="font-medium">Cardio Blast</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">15-30 min high intensity</div>
                                            </div>
                                        </div>
                                        <div class="text-red-600 font-bold">START</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickStartWorkout('strength')" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 border border-blue-200 dark:border-blue-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üí™</span>
                                            <div>
                                                <div class="font-medium">Strength Training</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">20-45 min muscle building</div>
                                            </div>
                                        </div>
                                        <div class="text-blue-600 font-bold">START</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickStartWorkout('yoga')" class="w-full text-left px-4 py-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50 border border-purple-200 dark:border-purple-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üßò‚Äç‚ôÄÔ∏è</span>
                                            <div>
                                                <div class="font-medium">Yoga & Flexibility</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">15-30 min stretching</div>
                                            </div>
                                        </div>
                                        <div class="text-purple-600 font-bold">START</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Exercise Library -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìö Exercise Library</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="showExerciseCategory('bodyweight')" class="bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600 text-sm">
                                    ü§∏‚Äç‚ôÇÔ∏è Bodyweight
                                </button>
                                <button onclick="showExerciseCategory('weights')" class="bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 text-sm">
                                    üèãÔ∏è‚Äç‚ôÇÔ∏è Weights
                                </button>
                                <button onclick="showExerciseCategory('cardio')" class="bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 text-sm">
                                    üèÉ‚Äç‚ôÇÔ∏è Cardio
                                </button>
                                <button onclick="showExerciseCategory('flexibility')" class="bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 text-sm">
                                    ü§∏‚Äç‚ôÄÔ∏è Flexibility
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Weekly Exercise Plan -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìÖ Weekly Plan</h3>
                            <div id="weeklyExercisePlan" class="space-y-3">
                                <!-- Weekly plan will be populated here -->
                            </div>
                            <button onclick="generateWeeklyPlan()" class="w-full mt-4 bg-primary text-white py-2 rounded hover:bg-purple-600">
                                üîÑ Generate New Plan
                            </button>
                        </div>

                        <!-- Exercise Streaks & Goals -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üî• Streaks & Goals</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üî•</span>
                                        <div>
                                            <div class="font-medium">Workout Streak</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Current streak</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-red-600" id="workoutStreak">0</div>
                                        <div class="text-xs text-red-500">days</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üéØ</span>
                                        <div>
                                            <div class="font-medium">Weekly Goal</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Workouts this week</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-blue-600" id="weeklyProgress">0/5</div>
                                        <div class="text-xs text-blue-500">goal</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üí™</span>
                                        <div>
                                            <div class="font-medium">Total Minutes</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">This week</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-green-600" id="totalMinutes">0</div>
                                        <div class="text-xs text-green-500">min</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nutrition Tab -->
            <div id="nutrition-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Daily Nutrition Tracker -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-nutrition">ü•ó Daily Nutrition</h3>
                            
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <div class="text-3xl font-bold text-nutrition" id="nutritionCalories">0</div>
                                        <div class="text-sm text-gray-500">Today's Calories</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-gray-700 dark:text-gray-300" id="calorieTarget">2000</div>
                                        <div class="text-xs text-gray-500">Daily Target</div>
                                    </div>
                                </div>
                                
                                <!-- Calories Progress Bar -->
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-3">
                                    <div id="caloriesProgress" class="bg-nutrition h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                
                                <div class="text-xs text-center text-gray-600 dark:text-gray-400" id="caloriesStatus">
                                    Start tracking meals to reach your goal!
                                </div>
                            </div>
                            
                            <!-- Macro Breakdown -->
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <div class="text-center p-3 bg-red-50 dark:bg-red-900/30 rounded-lg">
                                    <div class="text-xl font-bold text-red-600" id="proteinCount">0g</div>
                                    <div class="text-xs text-red-500">Protein</div>
                                    <div class="text-xs text-gray-500" id="proteinTarget">25%</div>
                                </div>
                                <div class="text-center p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg">
                                    <div class="text-xl font-bold text-yellow-600" id="carbsCount">0g</div>
                                    <div class="text-xs text-yellow-500">Carbs</div>
                                    <div class="text-xs text-gray-500" id="carbsTarget">50%</div>
                                </div>
                                <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="text-xl font-bold text-blue-600" id="fatCount">0g</div>
                                    <div class="text-xs text-blue-500">Fat</div>
                                    <div class="text-xs text-gray-500" id="fatTarget">25%</div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="quickLogMeal()" class="bg-nutrition text-white py-3 px-4 rounded-lg hover:bg-green-600 font-medium">
                                    üìù Log Meal
                                </button>
                                <button onclick="adjustNutritionGoals()" class="bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 font-medium">
                                    üéØ Set Goals
                                </button>
                            </div>
                            
                            <div class="mt-4 text-center">
                                <div class="text-xs text-purple-600 dark:text-purple-400" id="nutritionInsight">
                                    <!-- AI insight about nutrition will appear here -->
                                </div>
                            </div>
                        </div>

                        <!-- Today's Meals Progress -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-nutrition">üçΩÔ∏è Today's Meals</h3>
                            
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-nutrition" id="mealsCount">0</div>
                                    <div class="text-sm text-gray-500">Meals</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-500" id="waterDaily">0</div>
                                    <div class="text-sm text-gray-500">Water</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-500" id="snacksCount">0</div>
                                    <div class="text-sm text-gray-500">Snacks</div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <button onclick="quickAddMeal('breakfast')" class="w-full text-left px-4 py-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg hover:bg-yellow-100 dark:hover:bg-yellow-900/50 border border-yellow-200 dark:border-yellow-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üåÖ</span>
                                            <div>
                                                <div class="font-medium">Breakfast</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">Start your day right</div>
                                            </div>
                                        </div>
                                        <div class="text-yellow-600 font-bold">ADD</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickAddMeal('lunch')" class="w-full text-left px-4 py-3 bg-green-50 dark:bg-green-900/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50 border border-green-200 dark:border-green-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">ü•ô</span>
                                            <div>
                                                <div class="font-medium">Lunch</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">Midday fuel</div>
                                            </div>
                                        </div>
                                        <div class="text-green-600 font-bold">ADD</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickAddMeal('dinner')" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 border border-blue-200 dark:border-blue-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üçΩÔ∏è</span>
                                            <div>
                                                <div class="font-medium">Dinner</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">Evening nourishment</div>
                                            </div>
                                        </div>
                                        <div class="text-blue-600 font-bold">ADD</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Food Library -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìö Food Library</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="showFoodCategory('proteins')" class="bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 text-sm">
                                    üçñ Proteins
                                </button>
                                <button onclick="showFoodCategory('grains')" class="bg-yellow-600 text-white p-3 rounded-lg hover:bg-yellow-700 text-sm">
                                    üåæ Grains
                                </button>
                                <button onclick="showFoodCategory('vegetables')" class="bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 text-sm">
                                    ü•¨ Vegetables
                                </button>
                                <button onclick="showFoodCategory('fruits')" class="bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600 text-sm">
                                    üçé Fruits
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Weekly Meal Plan -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìÖ Weekly Meal Plan</h3>
                            <div id="weeklyMealPlan" class="space-y-3">
                                <!-- Weekly meal plan will be populated here -->
                            </div>
                            <button onclick="generateWeeklyMealPlan()" class="w-full mt-4 bg-primary text-white py-2 rounded hover:bg-purple-600">
                                üîÑ Generate AI Meal Plan
                            </button>
                        </div>

                        <!-- Nutrition Streaks & Goals -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üî• Nutrition Tracking</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üî•</span>
                                        <div>
                                            <div class="font-medium">Meal Streak</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Daily tracking</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-green-600" id="mealStreak">0</div>
                                        <div class="text-xs text-green-500">days</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üíß</span>
                                        <div>
                                            <div class="font-medium">Hydration Goal</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Glasses today</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-blue-600" id="hydrationProgress">0/8</div>
                                        <div class="text-xs text-blue-500">goal</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">‚öñÔ∏è</span>
                                        <div>
                                            <div class="font-medium">Macro Balance</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Protein-Carbs-Fat</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-purple-600" id="macroBalance">25-50-25</div>
                                        <div class="text-xs text-purple-500">ratio</div>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üìä</span>
                                        <div>
                                            <div class="font-medium">Weekly Average</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Daily calories</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-orange-600" id="weeklyAverage">0</div>
                                        <div class="text-xs text-orange-500">cal/day</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Tab -->
            <div id="health-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Apple Health Integration -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üì±</span>
                                <div>
                                    <h3 class="text-xl font-bold">Apple Health</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Sync your health data automatically</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="showAppleHealthSetup()" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50">
                                    <div class="font-medium">‚öôÔ∏è Setup Auto-Sync</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Configure iOS shortcuts</div>
                                </button>
                                <button onclick="importHealthData()" class="w-full text-left px-4 py-3 bg-green-50 dark:bg-green-900/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50">
                                    <div class="font-medium">üì• Import Data</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Manual import options</div>
                                </button>
                                <button onclick="showHealthStatus()" class="w-full text-left px-4 py-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50">
                                    <div class="font-medium">üìä Sync Status</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">View connection status</div>
                                </button>
                            </div>
                        </div>

                        <!-- Manual Logging -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìù Manual Logging</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="logSteps()" class="bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600">
                                    üö∂‚Äç‚ôÇÔ∏è Steps
                                </button>
                                <button onclick="logWorkout()" class="bg-fitness text-white p-3 rounded-lg hover:bg-red-600">
                                    üí™ Workout
                                </button>
                                <button onclick="logSleep()" class="bg-wellness text-white p-3 rounded-lg hover:bg-purple-600">
                                    üò¥ Sleep
                                </button>
                                <button onclick="logMeal()" class="bg-nutrition text-white p-3 rounded-lg hover:bg-green-600">
                                    ü•ó Meal
                                </button>
                                <button onclick="trackWater()" class="bg-hydration text-white p-3 rounded-lg hover:bg-blue-600">
                                    üíß Water
                                </button>
                                <button onclick="logCustomActivity()" class="bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700">
                                    ‚ö° Other
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <!-- Health Progress -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìä Health Progress</h3>
                            <div id="healthProgressContainer" class="space-y-4">
                                <!-- Health progress will be populated here -->
                            </div>
                            <button onclick="showHabitTracker()" class="w-full mt-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-600">
                                View Detailed Tracker
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Coach Tab -->
            <div id="ai-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üß†</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Nutrition Coach</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Personalized meal recommendations</p>
                                </div>
                            </div>
                            <button onclick="generateAINutritionPlan()" class="w-full bg-nutrition text-white py-3 rounded-lg hover:bg-green-600">
                                üçΩÔ∏è Generate Nutrition Plan
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üí™</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Workout Coach</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Smart exercise recommendations</p>
                                </div>
                            </div>
                            <button onclick="generateAIWorkoutPlan()" class="w-full bg-fitness text-white py-3 rounded-lg hover:bg-red-600">
                                üèãÔ∏è‚Äç‚ôÇÔ∏è Generate Workout Plan
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üéØ</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Task Generator</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Context-aware task suggestions</p>
                                </div>
                            </div>
                            <button onclick="generateAdvancedAITasks()" class="w-full bg-personal text-white py-3 rounded-lg hover:bg-indigo-600">
                                ‚ú® Generate Smart Tasks
                            </button>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg h-full">
                            <h3 class="text-xl font-bold mb-4">ü§ñ AI Insights</h3>
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/30 dark:to-blue-900/30 p-4 rounded-lg">
                                    <h4 class="font-bold mb-2">How AI Coaching Works</h4>
                                    <ul class="text-sm space-y-2 text-gray-600 dark:text-gray-400">
                                        <li>‚Ä¢ Analyzes your current stats and patterns</li>
                                        <li>‚Ä¢ Considers your goals and preferences</li>
                                        <li>‚Ä¢ Adapts to time of day and energy levels</li>
                                        <li>‚Ä¢ Provides personalized recommendations</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-lg">
                                    <h4 class="font-bold mb-2">AI Features</h4>
                                    <ul class="text-sm space-y-2 text-gray-600 dark:text-gray-400">
                                        <li>‚Ä¢ Smart meal planning with macro tracking</li>
                                        <li>‚Ä¢ Adaptive workout routines</li>
                                        <li>‚Ä¢ Context-aware task generation</li>
                                        <li>‚Ä¢ Pattern recognition and insights</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Tab -->
            <div id="tasks-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold">üìã Today's Quests</h3>
                                <button onclick="generateDailyTasks()" class="text-primary hover:text-purple-600 text-sm">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div id="tasksListDetailed" class="space-y-2 max-h-96 overflow-y-auto mb-4">
                                <!-- Tasks will be populated here -->
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="addCustomTask()" class="flex-1 bg-personal text-white py-2 rounded hover:bg-indigo-600">
                                    ‚ûï Add Custom Quest
                                </button>
                                <button onclick="generateAdvancedAITasks()" class="flex-1 bg-purple-500 text-white py-2 rounded hover:bg-purple-600">
                                    üß† AI Tasks
                                </button>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üéØ Productivity Tools</h3>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="startPomodoro()" class="w-full text-left px-4 py-3 bg-orange-50 dark:bg-orange-900/30 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/50">
                                    <div class="font-medium">üçÖ Pomodoro Timer</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">25-minute focus sessions</div>
                                </button>
                                <button onclick="showHabitTracker()" class="w-full text-left px-4 py-3 bg-green-50 dark:bg-green-900/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50">
                                    <div class="font-medium">üìä Habit Tracker</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Track your daily habits</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üèÜ Achievements</h3>
                            <div id="achievementsListDetailed" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Achievements will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Music Tab -->
            <div id="music-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Spotify Connection -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üéµ</span>
                                <div>
                                    <h3 class="text-xl font-bold">Spotify Integration</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm" id="spotifyStatus">
                                        Connect your Spotify account for AI music coaching
                                    </p>
                                </div>
                            </div>
                            
                            <div id="spotifyAuthSection" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Spotify Client ID</label>
                                    <input type="text" id="spotifyClientId" placeholder="Enter your Spotify app client ID..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <div class="text-xs text-gray-500 mt-1">
                                        Get this from your <a href="https://developer.spotify.com/dashboard" target="_blank" class="text-blue-500 hover:underline">Spotify Developer Dashboard</a>
                                    </div>
                                </div>
                                
                                <button onclick="connectSpotify()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 font-medium">
                                    üéµ Connect to Spotify
                                </button>
                            </div>
                            
                            <div id="spotifyConnectedSection" class="space-y-4" style="display: none;">
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-green-600">‚úì</span>
                                        <span class="font-medium">Connected to Spotify</span>
                                    </div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400" id="spotifyUserInfo"></div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="refreshSpotifyData()" class="bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                        üîÑ Refresh Data
                                    </button>
                                    <button onclick="disconnectSpotify()" class="bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">
                                        üö´ Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Music Player -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üéµ Music Player</h3>
                            
                            <div id="currentTrack" class="mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <div class="w-16 h-16 bg-gray-300 dark:bg-gray-600 rounded-lg flex items-center justify-center" id="albumArt">
                                        üéµ
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold" id="trackName">No track playing</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400" id="artistName">Connect Spotify to see current track</div>
                                    </div>
                                </div>
                                
                                <!-- Progress Bar -->
                                <div class="mt-4">
                                    <div class="flex justify-between text-xs text-gray-500 mb-1">
                                        <span id="currentTime">0:00</span>
                                        <span id="totalTime">0:00</span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1">
                                        <div id="progressBar" class="bg-green-500 h-full rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Player Controls -->
                            <div class="flex justify-center items-center space-x-4">
                                <button onclick="previousTrack()" class="p-3 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
                                    ‚èÆÔ∏è
                                </button>
                                <button onclick="togglePlayPause()" class="p-4 bg-green-500 text-white rounded-full hover:bg-green-600" id="playPauseButton">
                                    ‚ñ∂Ô∏è
                                </button>
                                <button onclick="nextTrack()" class="p-3 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
                                    ‚è≠Ô∏è
                                </button>
                            </div>
                            
                            <div class="text-center mt-4 space-y-2">
                                <div class="text-xs text-gray-500">Connect Spotify for full playback control</div>
                                <button onclick="transferToWebPlayer()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 text-sm" id="transferButton" style="display: none;">
                                    üì±‚û°Ô∏èüíª Transfer to Web Player
                                </button>
                                <div class="text-xs text-blue-600" id="webPlayerStatus" style="display: none;">
                                    Web player ready - you can now control music here!
                                </div>
                            </div>
                        </div>

                        <!-- Workout Playlists -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üèÉ‚Äç‚ôÇÔ∏è Workout Playlists</h3>
                            
                            <div id="workoutPlaylists" class="space-y-3">
                                <!-- Playlists will be populated here -->
                            </div>
                            
                            <button onclick="generateWorkoutPlaylist()" class="w-full mt-4 bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">
                                üéµ Generate AI Workout Playlist
                            </button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- AI Music Coach -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üß† AI Music Coach</h3>
                            
                            <div id="musicCoachInsights" class="space-y-4 mb-6">
                                <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                                    <h4 class="font-bold mb-2 text-purple-700 dark:text-purple-300">üéØ Smart Recommendations</h4>
                                    <div class="text-sm text-purple-600 dark:text-purple-400" id="musicRecommendation">
                                        Connect Spotify to get personalized music recommendations for your activities!
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="getMusicForActivity('workout')" class="w-full text-left px-4 py-3 bg-red-50 dark:bg-red-900/30 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/50">
                                    <div class="font-medium">üèÉ‚Äç‚ôÇÔ∏è Workout Music</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">High-energy tracks for exercise</div>
                                </button>
                                <button onclick="getMusicForActivity('focus')" class="w-full text-left px-4 py-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg hover:bg-yellow-100 dark:hover:bg-yellow-900/50">
                                    <div class="font-medium">üß† Focus Music</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Concentration-enhancing sounds</div>
                                </button>
                                <button onclick="getMusicForActivity('relaxation')" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50">
                                    <div class="font-medium">üòå Relaxation Music</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Calming tracks for wellness</div>
                                </button>
                            </div>
                        </div>

                        <!-- Music Analytics -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìä Your Music Profile</h3>
                            
                            <div id="musicAnalytics" class="space-y-4">
                                <div class="text-center text-gray-500 py-8">
                                    <div class="text-4xl mb-2">üéµ</div>
                                    <div>Connect Spotify to analyze your music preferences</div>
                                </div>
                            </div>
                        </div>

                        <!-- Music Achievements -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üèÜ Music Achievements</h3>
                            
                            <div id="musicAchievements" class="space-y-3">
                                <div class="text-center text-gray-500 py-8">
                                    Start listening to music during activities to unlock achievements!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üë§ Profile</h3>
                            <button onclick="showProfile()" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-purple-600">
                                Edit Profile Settings
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üîî Notifications</h3>
                            <button onclick="showNotificationSettings()" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
                                Manage Reminders
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üíæ Data</h3>
                            <button onclick="showStorageInfo()" class="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Storage Information
                            </button>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg h-full">
                            <h3 class="text-xl font-bold mb-4">üìä Statistics</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-blue-600" id="settingsLevel">1</div>
                                    <div class="text-sm text-blue-500">Current Level</div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-green-600" id="settingsTotalXP">0</div>
                                    <div class="text-sm text-green-500">Total XP</div>
                                </div>
                                <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-purple-600" id="settingsAchievements">0</div>
                                    <div class="text-sm text-purple-500">Achievements</div>
                                </div>
                                <div class="bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-orange-600" id="settingsTasks">0</div>
                                    <div class="text-sm text-orange-500">Total Tasks</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Notifications Container -->
    <div id="notificationsContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <script>
        // üéÆ GAME STATE MANAGEMENT
        let gameState = {
            level: 1,
            xp: 0,
            totalXP: 0,
            dailyStats: {
                steps: 0,
                waterGlasses: 0,
                calories: 0,
                protein: 0,
                carbs: 0,
                fat: 0,
                meals: 0,
                focusMinutes: 0,
                sleepHours: 0,
                workouts: 0,
                caloriesBurned: 0,
                exerciseMinutes: 0
            },
            tasks: [],
            achievements: [],
            profile: {
                age: null,
                weight: null,
                height: null,
                activityLevel: 'moderate',
                fitnessGoal: 'maintain',
                bmr: null,
                stepGoal: 8000,
                calorieTarget: 2000,
                proteinPercent: 25,
                carbsPercent: 50,
                fatPercent: 25,
                equipment: {
                    dumbbells: false,
                    barbells: false,
                    kettlebells: false,
                    resistanceBands: false,
                    pullupBar: false,
                    yogaMat: true,
                    treadmill: false,
                    bike: false,
                    homeGym: false
                },
                dietaryRestrictions: {
                    vegetarian: false,
                    vegan: false,
                    glutenFree: false,
                    dairyFree: false,
                    nutFree: false,
                    lowCarb: false,
                    keto: false
                },
                workoutPreferences: {
                    duration: 30,
                    timeOfDay: 'morning',
                    intensity: 'moderate',
                    focusAreas: ['full_body'],
                    experienceLevel: 'beginner'
                },
                interests: [
                    { id: 'philosophy', name: 'Philosophy', category: 'intellectual', description: 'Existentialism, absurdism, political thought', active: true, dateAdded: new Date().toISOString() },
                    { id: 'history_science', name: 'History & Science', category: 'intellectual', description: 'Learning, discussing, reading, watching videos', active: true, dateAdded: new Date().toISOString() },
                    { id: 'reading_writing', name: 'Reading & Writing', category: 'creative', description: 'Reflective, analytical style', active: true, dateAdded: new Date().toISOString() },
                    { id: 'films', name: 'Films', category: 'cultural', description: 'Cinema analysis and appreciation', active: true, dateAdded: new Date().toISOString() },
                    { id: 'music', name: 'Music', category: 'cultural', description: 'Indie/alternative bands, mood and identity', active: true, dateAdded: new Date().toISOString() },
                    { id: 'golf', name: 'Golf', category: 'physical', description: 'Sports and physical activity', active: true, dateAdded: new Date().toISOString() },
                    { id: 'socializing', name: 'Socializing', category: 'social', description: 'Close friend group, pubs, meetups', active: true, dateAdded: new Date().toISOString() },
                    { id: 'personal_growth', name: 'Personal Growth', category: 'development', description: 'Fitness, self-improvement, reinventing style', active: true, dateAdded: new Date().toISOString() }
                ]
            },
            patterns: {
                activities: {},
                preferences: {},
                timing: {},
                learning: {
                    enabled: true,
                    confidence: 0.5,
                    minOccurrences: 3
                }
            },
            streaks: {
                workout: 0,
                water: 0,
                sleep: 0
            },
            exercise: {
                weeklyPlan: [],
                preferences: {
                    favoriteTypes: ['cardio', 'strength'],
                    timePreference: 'morning',
                    difficulty: 'intermediate'
                },
                history: []
            },
            settings: {
                notifications: true,
                darkMode: 'auto',
                reminders: false,
                reminderTimes: {
                    water: ['09:00', '12:00', '15:00', '18:00'],
                    workout: ['07:00', '17:00'],
                    tasks: ['09:00', '14:00'],
                    sleep: ['22:00']
                }
            }
        };

        // üéØ INITIALIZATION
        function initializeApp() {
            // Apply dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });

            loadGameState();
            updateAllUI();
            generateDailyTasks();
            generateWeeklyExercisePlan();
            showAIInsights();
            
            // Initialize Spotify
            loadSpotifyState();
            handleSpotifyCallback();
            
            // Auto-save every 30 seconds
            setInterval(saveGameState, 30000);
            
            console.log('üéÆ Life Quest RPG - Ultimate AI Edition Initialized!');
            
            // Check for health data on load
            checkForHealthData();
        }

        // üíæ STORAGE MANAGEMENT
        function saveGameState() {
            try {
                const serializedState = JSON.stringify(gameState);
                localStorage.setItem('lifeQuestRPG', serializedState);
                localStorage.setItem('lifeQuestRPG_lastSave', new Date().toISOString());
                console.log('‚úÖ Game state saved successfully');
            } catch (error) {
                console.error('‚ùå Failed to save game state:', error);
                showFloatingNotification('‚ö†Ô∏è Save Error', 'Unable to save progress');
            }
        }

        function loadGameState() {
            try {
                const savedState = localStorage.getItem('lifeQuestRPG');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    gameState = { ...gameState, ...parsedState };
                    console.log('‚úÖ Game state loaded successfully');
                    showFloatingNotification('üíæ Progress Loaded', 'Your data has been restored');
                } else {
                    console.log('üì± No saved data found, starting fresh');
                }
            } catch (error) {
                console.error('‚ùå Failed to load game state:', error);
                console.log('üÜï Using default game state');
            }
        }

        function showStorageInfo() {
            const stateSize = JSON.stringify(gameState).length;
            const approximateMemoryUsage = stateSize * 2;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üíæ Storage Information</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-bold mb-2">üìä Current Usage</h4>
                            <div class="text-sm space-y-1">
                                <div>Game State Size: <span class="font-mono">${(stateSize/1024).toFixed(2)} KB</span></div>
                                <div>Memory Usage: <span class="font-mono">${(approximateMemoryUsage/1024).toFixed(2)} KB</span></div>
                                <div>Tasks Count: <span class="font-mono">${gameState.tasks.length}</span></div>
                                <div>Achievements: <span class="font-mono">${gameState.achievements.length}</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                            <h4 class="font-bold mb-2 text-blue-700 dark:text-blue-300">üí° Data Persistence</h4>
                            <div class="text-sm text-blue-600 dark:text-blue-400 space-y-1">
                                <p>‚Ä¢ All progress saved automatically</p>
                                <p>‚Ä¢ Data persists across browser sessions</p>
                                <p>‚Ä¢ No internet required for saving</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="exportData()" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600">
                                üì§ Export
                            </button>
                            <button onclick="importData()" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                                üì• Import
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function exportData() {
            const dataStr = JSON.stringify(gameState, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `lifequest-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showFloatingNotification('üì§ Data Exported', 'Backup file downloaded successfully');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            gameState = { ...gameState, ...importedData };
                            saveGameState();
                            updateAllUI();
                            showFloatingNotification('üì• Data Imported', 'Your backup has been restored');
                            document.querySelector('.fixed')?.remove();
                        } catch (error) {
                            showFloatingNotification('‚ùå Import Failed', 'Invalid backup file');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // üéØ INTERESTS & PATTERN LEARNING SYSTEM
        function showProfile() {
            showInterestsManager();
        }
        
        function showInterestsManager() {
            const interests = gameState.profile.interests || [];
            const patterns = analyzeUserPatterns();
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold">üéØ Interests & Pattern Learning</h3>
                        <div class="flex space-x-2">
                            <button onclick="showPatternInsights()" class="bg-purple-500 text-white px-3 py-2 rounded-lg hover:bg-purple-600 text-sm">
                                üß† Pattern Insights
                            </button>
                            <button onclick="exportInterests()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 text-sm">
                                üì§ Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Current Interests -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-bold">üìö Your Interests</h4>
                            <button onclick="addNewInterest()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                                ‚ûï Add Interest
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="interestsList">
                            ${interests.map(interest => `
                                <div class="border rounded-lg p-4 ${interest.active ? 'border-green-300 bg-green-50 dark:bg-green-900/20' : 'border-gray-300 bg-gray-50 dark:bg-gray-700'}" data-interest-id="${interest.id}">
                                    <div class="flex items-start justify-between mb-2">
                                        <div class="flex-1">
                                            <div class="font-bold text-${getCategoryColor(interest.category)}-600">${interest.name}</div>
                                            <div class="text-xs text-gray-500 capitalize">${interest.category}</div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button onclick="toggleInterest('${interest.id}')" class="text-xs px-2 py-1 rounded ${interest.active ? 'bg-green-500 text-white' : 'bg-gray-500 text-white'}">
                                                ${interest.active ? 'Active' : 'Inactive'}
                                            </button>
                                            <button onclick="editInterest('${interest.id}')" class="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                                                ‚úèÔ∏è
                                            </button>
                                            <button onclick="deleteInterest('${interest.id}')" class="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">${interest.description}</div>
                                    <div class="text-xs text-gray-500">Added: ${new Date(interest.dateAdded).toLocaleDateString()}</div>
                                    ${patterns.interestUsage[interest.id] ? `
                                        <div class="mt-2 text-xs bg-blue-100 dark:bg-blue-900/30 p-2 rounded">
                                            üîç Used in ${patterns.interestUsage[interest.id]} tasks
                                            ${patterns.timing[interest.id] ? `‚Ä¢ Best time: ${patterns.timing[interest.id]}` : ''}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Pattern Learning Insights -->
                    <div class="mb-6">
                        <h4 class="text-lg font-bold mb-4">üß† AI Learning Insights</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                                <h5 class="font-bold text-purple-700 dark:text-purple-300 mb-2">üî• Most Engaged</h5>
                                <div class="text-sm space-y-1">
                                    ${patterns.topInterests.slice(0, 3).map(item => `
                                        <div class="flex justify-between">
                                            <span>${item.name}</span>
                                            <span class="text-purple-600">${item.count} tasks</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                <h5 class="font-bold text-blue-700 dark:text-blue-300 mb-2">‚è∞ Optimal Times</h5>
                                <div class="text-sm space-y-1">
                                    ${Object.entries(patterns.bestTimes).slice(0, 3).map(([time, activities]) => `
                                        <div class="flex justify-between">
                                            <span>${time}</span>
                                            <span class="text-blue-600">${activities.join(', ')}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                <h5 class="font-bold text-green-700 dark:text-green-300 mb-2">üìÖ Weekend Predictions</h5>
                                <div class="text-sm">
                                    ${patterns.weekendPredictions.length > 0 ? patterns.weekendPredictions.join(', ') : 'Learning your patterns...'}
                                </div>
                            </div>
                            
                            <div class="bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg">
                                <h5 class="font-bold text-orange-700 dark:text-orange-300 mb-2">üéØ Suggested Focus</h5>
                                <div class="text-sm">
                                    ${patterns.suggestedInterests.length > 0 ? patterns.suggestedInterests.join(', ') : 'Keep using the app to see suggestions!'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Learning Settings -->
                    <div class="mb-6">
                        <h4 class="text-lg font-bold mb-4">‚öôÔ∏è Learning Settings</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2">
                                    <input type="checkbox" ${gameState.patterns.learning.enabled ? 'checked' : ''} onchange="togglePatternLearning(this.checked)">
                                    <span>Enable Pattern Learning</span>
                                </label>
                                <span class="text-sm text-gray-500">Learn from your task completion patterns</span>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2">
                                    <span>Confidence Threshold</span>
                                    <input type="range" min="0.1" max="1" step="0.1" value="${gameState.patterns.learning.confidence}" onchange="updateConfidenceThreshold(this.value)" class="ml-2">
                                </label>
                                <span class="text-sm text-gray-500">${Math.round(gameState.patterns.learning.confidence * 100)}%</span>
                            </div>
                            
                            <div class="text-sm bg-blue-100 dark:bg-blue-900/30 p-3 rounded">
                                <strong>How it works:</strong> The app tracks when and how you complete tasks, learning your preferences for timing (like golf on weekends), interests, and energy levels to make better suggestions.
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function getCategoryColor(category) {
            const colors = {
                intellectual: 'blue',
                creative: 'purple',
                cultural: 'indigo',
                physical: 'red',
                social: 'green',
                development: 'orange'
            };
            return colors[category] || 'gray';
        }
        
        function addNewInterest() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">‚ûï Add New Interest</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Interest Name</label>
                            <input type="text" id="newInterestName" placeholder="e.g., Photography, Cooking, Rock Climbing..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Category</label>
                            <select id="newInterestCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="intellectual">üß† Intellectual</option>
                                <option value="creative">üé® Creative</option>
                                <option value="cultural">üé≠ Cultural</option>
                                <option value="physical">üí™ Physical</option>
                                <option value="social">üë• Social</option>
                                <option value="development">üìà Development</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Description</label>
                            <textarea id="newInterestDescription" placeholder="Describe what you enjoy about this interest..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base h-20"></textarea>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveNewInterest()" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600">
                                üíæ Save Interest
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('newInterestName').focus();
        }
        
        function saveNewInterest() {
            const name = document.getElementById('newInterestName').value.trim();
            const category = document.getElementById('newInterestCategory').value;
            const description = document.getElementById('newInterestDescription').value.trim();
            
            if (!name) {
                showFloatingNotification('‚ö†Ô∏è Validation Error', 'Please enter an interest name');
                return;
            }
            
            const newInterest = {
                id: Date.now().toString(),
                name: name,
                category: category,
                description: description || `Exploring ${name}`,
                active: true,
                dateAdded: new Date().toISOString()
            };
            
            if (!gameState.profile.interests) {
                gameState.profile.interests = [];
            }
            
            gameState.profile.interests.push(newInterest);
            saveGameState();
            
            showFloatingNotification('‚úÖ Interest Added!', `${name} has been added to your interests`);
            document.querySelectorAll('.fixed').forEach(modal => modal.remove());
            showInterestsManager();
        }
        
        function toggleInterest(interestId) {
            const interest = gameState.profile.interests.find(i => i.id === interestId);
            if (interest) {
                interest.active = !interest.active;
                saveGameState();
                showFloatingNotification(
                    interest.active ? '‚úÖ Interest Activated' : '‚è∏Ô∏è Interest Paused',
                    `${interest.name} is now ${interest.active ? 'active' : 'inactive'}`
                );
                showInterestsManager();
            }
        }
        
        function editInterest(interestId) {
            const interest = gameState.profile.interests.find(i => i.id === interestId);
            if (!interest) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">‚úèÔ∏è Edit Interest</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Interest Name</label>
                            <input type="text" id="editInterestName" value="${interest.name}" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Category</label>
                            <select id="editInterestCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="intellectual" ${interest.category === 'intellectual' ? 'selected' : ''}>üß† Intellectual</option>
                                <option value="creative" ${interest.category === 'creative' ? 'selected' : ''}>üé® Creative</option>
                                <option value="cultural" ${interest.category === 'cultural' ? 'selected' : ''}>üé≠ Cultural</option>
                                <option value="physical" ${interest.category === 'physical' ? 'selected' : ''}>üí™ Physical</option>
                                <option value="social" ${interest.category === 'social' ? 'selected' : ''}>üë• Social</option>
                                <option value="development" ${interest.category === 'development' ? 'selected' : ''}>üìà Development</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Description</label>
                            <textarea id="editInterestDescription" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base h-20">${interest.description}</textarea>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveEditedInterest('${interestId}')" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                                üíæ Save Changes
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function saveEditedInterest(interestId) {
            const interest = gameState.profile.interests.find(i => i.id === interestId);
            if (!interest) return;
            
            const name = document.getElementById('editInterestName').value.trim();
            const category = document.getElementById('editInterestCategory').value;
            const description = document.getElementById('editInterestDescription').value.trim();
            
            if (!name) {
                showFloatingNotification('‚ö†Ô∏è Validation Error', 'Please enter an interest name');
                return;
            }
            
            interest.name = name;
            interest.category = category;
            interest.description = description;
            
            saveGameState();
            showFloatingNotification('‚úÖ Interest Updated!', `${name} has been updated`);
            document.querySelectorAll('.fixed').forEach(modal => modal.remove());
            showInterestsManager();
        }
        
        function deleteInterest(interestId) {
            const interest = gameState.profile.interests.find(i => i.id === interestId);
            if (!interest) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üóëÔ∏è Delete Interest</h3>
                    
                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                        Are you sure you want to delete "<strong>${interest.name}</strong>"? This will remove it from your interests and stop generating related tasks.
                    </p>
                    
                    <div class="flex space-x-3">
                        <button onclick="confirmDeleteInterest('${interestId}')" class="flex-1 bg-red-500 text-white py-2 rounded hover:bg-red-600">
                            üóëÔ∏è Delete
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function confirmDeleteInterest(interestId) {
            const interestIndex = gameState.profile.interests.findIndex(i => i.id === interestId);
            if (interestIndex !== -1) {
                const deletedInterest = gameState.profile.interests[interestIndex];
                gameState.profile.interests.splice(interestIndex, 1);
                saveGameState();
                showFloatingNotification('üóëÔ∏è Interest Deleted', `${deletedInterest.name} has been removed`);
                document.querySelectorAll('.fixed').forEach(modal => modal.remove());
                showInterestsManager();
            }
        }
        
        function analyzeUserPatterns() {
            const completedTasks = gameState.tasks.filter(t => t.completed);
            const patterns = {
                interestUsage: {},
                timing: {},
                topInterests: [],
                bestTimes: {},
                weekendPredictions: [],
                suggestedInterests: []
            };
            
            // Analyze interest usage patterns
            const interests = gameState.profile.interests || [];
            interests.forEach(interest => {
                const relatedTasks = completedTasks.filter(task => 
                    task.text.toLowerCase().includes(interest.name.toLowerCase()) ||
                    task.category === interest.category
                );
                
                if (relatedTasks.length > 0) {
                    patterns.interestUsage[interest.id] = relatedTasks.length;
                    
                    // Analyze timing for this interest
                    const timingData = relatedTasks.map(task => {
                        if (task.completedAt) {
                            const date = new Date(task.completedAt);
                            const hour = date.getHours();
                            const dayOfWeek = date.getDay();
                            return { hour, dayOfWeek, isWeekend: dayOfWeek === 0 || dayOfWeek === 6 };
                        }
                        return null;
                    }).filter(Boolean);
                    
                    if (timingData.length > 0) {
                        const avgHour = timingData.reduce((sum, d) => sum + d.hour, 0) / timingData.length;
                        const timeOfDay = avgHour < 12 ? 'Morning' : avgHour < 17 ? 'Afternoon' : 'Evening';
                        patterns.timing[interest.id] = timeOfDay;
                        
                        // Weekend prediction for golf and other activities
                        const weekendTasks = timingData.filter(d => d.isWeekend).length;
                        const weekdayTasks = timingData.filter(d => !d.isWeekend).length;
                        
                        if (weekendTasks > weekdayTasks && interest.name.toLowerCase().includes('golf')) {
                            patterns.weekendPredictions.push('Golf outings on weekends');
                        }
                    }
                }
            });
            
            // Create top interests list
            patterns.topInterests = interests
                .map(interest => ({
                    name: interest.name,
                    count: patterns.interestUsage[interest.id] || 0
                }))
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count);
            
            // Analyze best times for activities
            const hourlyActivity = {};
            completedTasks.forEach(task => {
                if (task.completedAt) {
                    const hour = new Date(task.completedAt).getHours();
                    const timeSlot = hour < 6 ? 'Late Night' : 
                                  hour < 12 ? 'Morning' : 
                                  hour < 17 ? 'Afternoon' : 
                                  hour < 21 ? 'Evening' : 'Night';
                    
                    if (!hourlyActivity[timeSlot]) {
                        hourlyActivity[timeSlot] = [];
                    }
                    hourlyActivity[timeSlot].push(task.category);
                }
            });
            
            Object.entries(hourlyActivity).forEach(([time, activities]) => {
                const counts = {};
                activities.forEach(activity => {
                    counts[activity] = (counts[activity] || 0) + 1;
                });
                const topActivities = Object.entries(counts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 2)
                    .map(([activity]) => activity);
                patterns.bestTimes[time] = topActivities;
            });
            
            return patterns;
        }
        
        function recordActivityPattern(activity, category, dayOfWeek, hour) {
            if (!gameState.patterns.learning.enabled) return;
            
            const patternKey = `${activity}_${dayOfWeek}_${Math.floor(hour/4)}`;
            if (!gameState.patterns.activities[patternKey]) {
                gameState.patterns.activities[patternKey] = 0;
            }
            gameState.patterns.activities[patternKey]++;
            
            // Special handling for weekend golf pattern
            if (activity.toLowerCase().includes('golf') && (dayOfWeek === 0 || dayOfWeek === 6)) {
                if (!gameState.patterns.preferences['golf_weekend']) {
                    gameState.patterns.preferences['golf_weekend'] = 0;
                }
                gameState.patterns.preferences['golf_weekend']++;
            }
            
            saveGameState();
        }
        
        function predictOptimalActivities(dayOfWeek, hour) {
            if (!gameState.patterns.learning.enabled) return [];
            
            const timeSlot = Math.floor(hour/4);
            const predictions = [];
            
            // Check for weekend golf pattern
            if ((dayOfWeek === 0 || dayOfWeek === 6) && gameState.patterns.preferences['golf_weekend'] >= gameState.patterns.learning.minOccurrences) {
                predictions.push({
                    activity: 'golf',
                    confidence: Math.min(0.95, gameState.patterns.preferences['golf_weekend'] * 0.1),
                    reason: 'You typically enjoy golf outings on weekends'
                });
            }
            
            // Check general activity patterns
            Object.entries(gameState.patterns.activities).forEach(([patternKey, count]) => {
                const [activity, patternDay, patternTime] = patternKey.split('_');
                if (parseInt(patternDay) === dayOfWeek && parseInt(patternTime) === timeSlot && count >= gameState.patterns.learning.minOccurrences) {
                    predictions.push({
                        activity: activity,
                        confidence: Math.min(0.9, count * 0.05),
                        reason: `You often do ${activity} at this time on ${['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][dayOfWeek]}s`
                    });
                }
            });
            
            return predictions.filter(p => p.confidence >= gameState.patterns.learning.confidence);
        }
        
        function generateTasksFromUserInterests() {
            const activeInterests = (gameState.profile.interests || []).filter(i => i.active);
            const tasks = [];
            
            activeInterests.forEach(interest => {
                // Generate tasks based on interest category and description
                const interestTasks = createTasksForInterest(interest);
                tasks.push(...interestTasks);
            });
            
            return tasks;
        }
        
        function createTasksForInterest(interest) {
            const taskTemplates = {
                intellectual: [
                    `Read about ${interest.name} for 15 minutes`,
                    `Write a reflection on ${interest.name}`,
                    `Research the history of ${interest.name}`,
                    `Discuss ${interest.name} with someone knowledgeable`
                ],
                creative: [
                    `Spend 20 minutes practicing ${interest.name}`,
                    `Create something new related to ${interest.name}`,
                    `Learn a new technique in ${interest.name}`,
                    `Share your ${interest.name} work with others`
                ],
                cultural: [
                    `Explore ${interest.name} from a different culture`,
                    `Attend or watch a ${interest.name} performance/event`,
                    `Learn about the cultural significance of ${interest.name}`,
                    `Connect with others who enjoy ${interest.name}`
                ],
                physical: [
                    `Practice ${interest.name} for 30 minutes`,
                    `Learn proper technique for ${interest.name}`,
                    `Set a new goal in ${interest.name}`,
                    `Plan a ${interest.name} session with friends`
                ],
                social: [
                    `Organize a ${interest.name} meetup`,
                    `Invite someone to join you for ${interest.name}`,
                    `Share your passion for ${interest.name} with others`,
                    `Find a local ${interest.name} community`
                ],
                development: [
                    `Identify one area to improve in ${interest.name}`,
                    `Practice ${interest.name} skills for 20 minutes`,
                    `Set a SMART goal related to ${interest.name}`,
                    `Reflect on your progress in ${interest.name}`
                ]
            };
            
            const templates = taskTemplates[interest.category] || taskTemplates.development;
            const selectedTemplate = templates[Math.floor(Math.random() * templates.length)];
            
            return [{
                id: 'user_interest_' + Date.now() + Math.random(),
                text: selectedTemplate,
                category: 'personal',
                icon: getCategoryIcon(interest.category),
                xp: 30,
                timeEstimate: '15-30 minutes',
                difficulty: 'medium',
                userGenerated: true,
                interestId: interest.id,
                aiReasoning: `Generated from your interest in ${interest.name}. ${interest.description}`
            }];
        }
        
        function getCategoryIcon(category) {
            const icons = {
                intellectual: 'üß†',
                creative: 'üé®',
                cultural: 'üé≠',
                physical: 'üí™',
                social: 'üë•',
                development: 'üìà'
            };
            return icons[category] || 'üéØ';
        }
        
        function togglePatternLearning(enabled) {
            gameState.patterns.learning.enabled = enabled;
            saveGameState();
            showFloatingNotification(
                enabled ? 'üß† Learning Enabled' : '‚è∏Ô∏è Learning Paused',
                enabled ? 'AI will learn from your patterns' : 'AI learning has been paused'
            );
        }
        
        function updateConfidenceThreshold(value) {
            gameState.patterns.learning.confidence = parseFloat(value);
            saveGameState();
        }
        
        function showPatternInsights() {
            const patterns = analyzeUserPatterns();
            const predictions = predictOptimalActivities(new Date().getDay(), new Date().getHours());
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6">üß† Pattern Learning Insights</h3>
                    
                    <div class="space-y-6">
                        <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-700 dark:text-blue-300 mb-3">üîÆ Current Predictions</h4>
                            ${predictions.length > 0 ? `
                                <div class="space-y-2">
                                    ${predictions.map(pred => `
                                        <div class="bg-white dark:bg-gray-700 p-3 rounded">
                                            <div class="font-medium">${pred.activity}</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">${pred.reason}</div>
                                            <div class="text-xs text-blue-600">Confidence: ${Math.round(pred.confidence * 100)}%</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-gray-600 dark:text-gray-400 text-center py-4">
                                    Keep completing tasks! The AI needs more data to make predictions.
                                </div>
                            `}
                        </div>
                        
                        <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                            <h4 class="font-bold text-green-700 dark:text-green-300 mb-3">üìä Learning Status</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <div class="font-medium">Completed Tasks</div>
                                    <div class="text-green-600">${gameState.tasks.filter(t => t.completed).length}</div>
                                </div>
                                <div>
                                    <div class="font-medium">Patterns Identified</div>
                                    <div class="text-green-600">${Object.keys(gameState.patterns.activities).length}</div>
                                </div>
                                <div>
                                    <div class="font-medium">Learning Enabled</div>
                                    <div class="text-green-600">${gameState.patterns.learning.enabled ? 'Yes' : 'No'}</div>
                                </div>
                                <div>
                                    <div class="font-medium">Confidence Level</div>
                                    <div class="text-green-600">${Math.round(gameState.patterns.learning.confidence * 100)}%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                            <h4 class="font-bold text-purple-700 dark:text-purple-300 mb-3">üéØ Examples of What I Learn</h4>
                            <div class="text-sm space-y-2">
                                <div>‚Ä¢ <strong>Golf on weekends:</strong> If you often do golf-related tasks on Saturday/Sunday, I'll suggest golf activities for weekends</div>
                                <div>‚Ä¢ <strong>Morning workouts:</strong> If you complete fitness tasks in the morning, I'll prioritize exercise suggestions before noon</div>
                                <div>‚Ä¢ <strong>Evening philosophy:</strong> If you do intellectual tasks in the evening, I'll suggest reading/reflection activities after 6 PM</div>
                                <div>‚Ä¢ <strong>Social preferences:</strong> If you complete social tasks on certain days, I'll learn your social patterns</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function exportInterests() {
            const data = {
                interests: gameState.profile.interests,
                patterns: gameState.patterns,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `interests-and-patterns-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showFloatingNotification('üì§ Interests Exported', 'Your interests and patterns have been exported');
        }

        // üèÜ XP AND LEVELING SYSTEM - Fixed for meaningful XP only
        function awardXP(amount, reason) {
            gameState.xp += amount;
            gameState.totalXP += amount;
            
            const xpForNextLevel = gameState.level * 100;
            if (gameState.xp >= xpForNextLevel) {
                levelUp();
            }
            
            updateXPDisplay();
            showXPAnimation(amount, reason);
            saveGameState();
        }

        function levelUp() {
            const oldLevel = gameState.level;
            gameState.level++;
            gameState.xp = gameState.xp - (oldLevel * 100);
            
            addAchievement(`üéâ Level ${gameState.level}!`, `Reached level ${gameState.level}`, gameState.level * 50);
            
            updateXPDisplay();
            showFloatingNotification('üéâ LEVEL UP!', `Welcome to Level ${gameState.level}!`);
            
            const levelElement = document.getElementById('playerLevel');
            levelElement.classList.add('level-up');
            setTimeout(() => levelElement.classList.remove('level-up'), 1000);
        }

        function updateXPDisplay() {
            const xpForNextLevel = gameState.level * 100;
            const progress = (gameState.xp / xpForNextLevel) * 100;
            
            document.getElementById('playerLevel').textContent = `Level ${gameState.level}`;
            document.getElementById('currentXP').textContent = gameState.xp;
            document.getElementById('nextLevelXP').textContent = xpForNextLevel;
            document.getElementById('xpProgress').style.width = `${progress}%`;
        }

        function showXPAnimation(amount, reason) {
            const container = document.createElement('div');
            container.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 xp-burst pointer-events-none';
            container.innerHTML = `
                <div class="bg-yellow-400 text-yellow-900 px-4 py-2 rounded-full font-bold shadow-lg">
                    +${amount} XP
                </div>
                <div class="text-center text-sm text-gray-600 dark:text-gray-400 mt-1">${reason}</div>
            `;
            document.body.appendChild(container);
            
            setTimeout(() => container.remove(), 2000);
        }

        // üß† ENHANCED AI TASK GENERATION SYSTEM
        function generateAdvancedAITasks() {
            const profile = gameState.profile;
            const stats = gameState.dailyStats;
            const hour = new Date().getHours();
            const dayOfWeek = new Date().getDay();
            
            const aiTasks = generateContextualTasks(profile, stats, hour, dayOfWeek);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold">üß† Enhanced AI Task Generator</h3>
                        <div class="flex space-x-2">
                            <button onclick="regenerateAITasks()" class="bg-purple-500 text-white px-3 py-2 rounded-lg hover:bg-purple-600 text-sm">
                                üîÑ Regenerate
                            </button>
                            <button onclick="showAISettings()" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 text-sm">
                                ‚öôÔ∏è AI Settings
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        ${aiTasks.map(task => `
                            <div class="border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 ${task.priority === 'high' ? 'border-red-300 bg-red-50 dark:bg-red-900/20' : task.priority === 'medium' ? 'border-yellow-300 bg-yellow-50 dark:bg-yellow-900/20' : 'border-gray-300'}">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-start space-x-3">
                                        <div class="text-2xl">${task.icon}</div>
                                        <div class="flex-1">
                                            <div class="font-bold">${task.text}</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400 flex items-center space-x-2">
                                                <span class="capitalize">${task.category}</span>
                                                <span>‚Ä¢</span>
                                                <span class="text-green-600">${task.xp} XP</span>
                                                <span>‚Ä¢</span>
                                                <span class="capitalize">${task.difficulty}</span>
                                                ${task.priority === 'high' ? '<span class="text-red-600">‚Ä¢ üî• Priority</span>' : ''}
                                            </div>
                                            ${task.timeEstimate ? `<div class="text-xs text-blue-600 mt-1">‚è±Ô∏è ${task.timeEstimate}</div>` : ''}
                                            ${task.progressiveSteps ? `<div class="text-xs text-indigo-600 mt-1">üìà Builds to: ${task.progressiveSteps.slice(-1)[0]}</div>` : ''}
                                        </div>
                                    </div>
                                    ${task.confidence ? `<div class="text-xs bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 px-2 py-1 rounded">${task.confidence}%</div>` : ''}
                                </div>
                                
                                <div class="text-sm text-purple-600 dark:text-purple-400 mb-3 bg-purple-50 dark:bg-purple-900/30 p-2 rounded">
                                    üß† ${task.aiReasoning}
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button onclick="adoptAITask('${task.text.replace(/'/g, "\\'")}', '${task.category}', ${task.xp}, '${task.icon}', '${task.aiReasoning.replace(/'/g, "\\'")}', '${task.difficulty || 'medium'}')" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700 text-sm">
                                        ‚úÖ Add Task
                                    </button>
                                    ${task.customizable ? `<button onclick="customizeAITask('${task.id}')" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">‚öôÔ∏è</button>` : ''}
                                    <button onclick="skipAITask('${task.id}')" class="bg-gray-400 text-white px-3 py-2 rounded hover:bg-gray-500 text-sm">‚è≠Ô∏è</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/30 dark:to-blue-900/30 p-4 rounded-lg mb-4">
                        <h4 class="font-bold mb-2">üéØ AI Analysis Summary</h4>
                        <div class="text-sm space-y-1">
                            <div>‚Ä¢ Analyzed ${Object.keys(stats).length} current health metrics</div>
                            <div>‚Ä¢ Optimized for ${hour < 12 ? 'morning' : hour < 17 ? 'afternoon' : 'evening'} energy patterns</div>
                            <div>‚Ä¢ Personalized for ${profile.fitnessGoal || 'general'} fitness goals</div>
                            <div>‚Ä¢ Factored in ${['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][dayOfWeek]} schedule patterns</div>
                            <div>‚Ä¢ Applied machine learning from your task completion history</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function generateContextualTasks(profile, stats, hour, dayOfWeek) {
            const taskHistory = gameState.tasks.filter(t => t.completed);
            const context = analyzeUserContext(profile, stats, hour, dayOfWeek);
            
            // Generate tasks using multiple sophisticated algorithms
            const priorityTasks = generatePriorityTasks(context, stats);
            const adaptiveTasks = generateAdaptiveTasks(context, taskHistory);
            const progressiveTasks = generateProgressiveTasks(context, stats);
            const serendipityTasks = generateSerendipityTasks(context);
            const biometricTasks = generateBiometricAwareTasks(context, stats);
            const contextualTasks = generateAdvancedContextualTasks(context, stats, hour);
            
            let allTasks = [...priorityTasks, ...adaptiveTasks, ...progressiveTasks, ...serendipityTasks, ...biometricTasks, ...contextualTasks];
            
            // Apply advanced filtering and ranking
            allTasks = filterByRelevance(allTasks, context);
            allTasks = rankByOptimalTiming(allTasks, hour, dayOfWeek);
            allTasks = ensureVariety(allTasks);
            
            return allTasks.slice(0, 8);
        }
        
        function analyzeUserContext(profile, stats, hour, dayOfWeek) {
            const energyLevel = Math.sin((hour - 6) * Math.PI / 12) * 0.5 + 0.5 + (stats.workouts > 0 ? 0.2 : 0);
            const stressLevel = 0.3 + (hour >= 9 && hour <= 17 ? 0.2 : 0) + (stats.waterGlasses < 4 ? 0.2 : 0);
            const motivationState = 0.5 + (stats.steps >= (profile.stepGoal || 8000) * 0.8 ? 0.2 : 0);
            
            return {
                energyLevel: Math.max(0.1, Math.min(1.0, energyLevel)),
                stressLevel: Math.max(0.1, Math.min(1.0, stressLevel)),
                motivationState: Math.max(0.1, Math.min(1.0, motivationState)),
                timeOfDay: hour < 12 ? 'morning' : hour < 17 ? 'afternoon' : 'evening',
                weekContext: dayOfWeek === 0 || dayOfWeek === 6 ? 'weekend' : 'weekday',
                deficitAreas: identifyDeficitAreas(stats, profile),
                availableTime: hour >= 9 && hour <= 17 ? 'low' : 'medium'
            };
        }
        
        function identifyDeficitAreas(stats, profile) {
            const deficits = [];
            if (stats.waterGlasses < 4) deficits.push('hydration');
            if (stats.steps < (profile.stepGoal || 8000) * 0.5) deficits.push('movement');
            if (stats.workouts === 0) deficits.push('exercise');
            if (stats.focusMinutes < 30) deficits.push('productivity');
            if (stats.meals < 2) deficits.push('nutrition');
            return deficits;
        }
        
        function generatePriorityTasks(context, stats) {
            const tasks = [];
            
            context.deficitAreas.forEach(area => {
                switch(area) {
                    case 'hydration':
                        tasks.push({
                            id: 'priority_hydration_' + Date.now(),
                            text: 'Drink a large glass of water mindfully',
                            category: 'hydration',
                            icon: 'üíß',
                            xp: 20,
                            priority: 'high',
                            difficulty: 'easy',
                            timeEstimate: '2 minutes',
                            confidence: 95,
                            aiReasoning: `Critical hydration deficit detected. Current intake: ${stats.waterGlasses} glasses. Dehydration reduces cognitive performance by up to 23%.`
                        });
                        break;
                    case 'movement':
                        tasks.push({
                            id: 'priority_movement_' + Date.now(),
                            text: context.energyLevel > 0.7 ? 'Complete 5-minute energizing movement flow' : 'Take a gentle 7-minute walk',
                            category: 'fitness',
                            icon: 'üèÉ‚Äç‚ôÇÔ∏è',
                            xp: 30,
                            priority: 'high',
                            difficulty: context.energyLevel > 0.7 ? 'medium' : 'easy',
                            timeEstimate: context.energyLevel > 0.7 ? '5 minutes' : '7 minutes',
                            confidence: 90,
                            aiReasoning: `Movement deficit detected (${stats.steps} steps). Regular movement increases BDNF levels and enhances neuroplasticity.`
                        });
                        break;
                }
            });
            
            return tasks;
        }
        
        function generateAdaptiveTasks(context, taskHistory) {
            const tasks = [];
            const successRate = taskHistory.length > 0 ? taskHistory.filter(t => t.completed).length / taskHistory.length : 0;
            
            if (successRate > 0.8 && context.motivationState > 0.7) {
                tasks.push({
                    id: 'adaptive_challenge_' + Date.now(),
                    text: 'Complete a personalized 12-minute challenge circuit',
                    category: 'fitness',
                    icon: 'üéØ',
                    xp: 45,
                    priority: 'medium',
                    difficulty: 'hard',
                    timeEstimate: '12 minutes',
                    confidence: 85,
                    aiReasoning: `High success rate (${Math.round(successRate * 100)}%) indicates readiness for increased challenge.`,
                    customizable: true
                });
            }
            
            return tasks;
        }
        
        function generateProgressiveTasks(context, stats) {
            const tasks = [];
            
            if (stats.steps > 0) {
                const nextMilestone = Math.ceil(stats.steps / 1000) * 1000;
                if (nextMilestone > stats.steps) {
                    tasks.push({
                        id: 'progressive_steps_' + Date.now(),
                        text: `Reach ${nextMilestone.toLocaleString()} steps today`,
                        category: 'fitness',
                        icon: 'üéØ',
                        xp: 25,
                        priority: 'medium',
                        difficulty: 'medium',
                        timeEstimate: 'ongoing',
                        confidence: 80,
                        aiReasoning: `Progressive challenge: ${nextMilestone - stats.steps} steps from next milestone.`,
                        progressiveSteps: [stats.steps.toString(), nextMilestone.toString(), (nextMilestone + 1000).toString()]
                    });
                }
            }
            
            return tasks;
        }
        
        function generateSerendipityTasks(context) {
            const pools = {
                creative: [
                    {
                        text: 'Write a haiku about your current mood',
                        category: 'wellness',
                        icon: 'üéã',
                        xp: 25,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Poetry writing engages both analytical and creative brain regions, improving emotional regulation.'
                    },
                    {
                        text: 'Sketch or doodle for 10 minutes without judgment',
                        category: 'wellness',
                        icon: '‚úèÔ∏è',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Non-judgmental creative expression reduces anxiety and activates the default mode network.'
                    },
                    {
                        text: 'Create a playlist that perfectly captures your current emotional state',
                        category: 'personal',
                        icon: 'üéµ',
                        xp: 25,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Music curation tied to identity helps process emotions and creates personal soundscapes.'
                    },
                    {
                        text: 'Write a letter to your future self (6 months from now)',
                        category: 'personal',
                        icon: 'üíå',
                        xp: 35,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Future self-visualization strengthens goal commitment and self-compassion.'
                    },
                    {
                        text: 'Take 20 photos of textures, patterns, or interesting details',
                        category: 'wellness',
                        icon: 'üì∏',
                        xp: 25,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Mindful photography enhances present-moment awareness and visual creativity.'
                    },
                    {
                        text: 'Write a short philosophical reflection on today\'s experiences',
                        category: 'personal',
                        icon: 'üìù',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Philosophical reflection develops critical thinking and helps process life experiences meaningfully.'
                    },
                    {
                        text: 'Create a mood board or visual collage representing your ideal self',
                        category: 'personal',
                        icon: 'üé®',
                        xp: 40,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Visual self-representation clarifies identity goals and activates creative planning centers.'
                    },
                    {
                        text: 'Write a film review analyzing themes and cinematography of something you recently watched',
                        category: 'personal',
                        icon: 'üé¨',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Film analysis develops critical thinking and articulation of complex aesthetic experiences.'
                    },
                    {
                        text: 'Compose a short piece of music or sound arrangement using available tools',
                        category: 'wellness',
                        icon: 'üéº',
                        xp: 45,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Music composition integrates mathematical and emotional processing, enhancing cognitive flexibility.'
                    },
                    {
                        text: 'Design your ideal living space layout with attention to personal style',
                        category: 'personal',
                        icon: 'üè†',
                        xp: 30,
                        timeEstimate: '18 minutes',
                        aiReasoning: 'Environmental design reflects and shapes identity, supporting self-improvement goals.'
                    },
                    {
                        text: 'Write a character study of someone interesting you encountered recently',
                        category: 'personal',
                        icon: 'üë•',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Character analysis develops empathy and observational skills while processing social experiences.'
                    },
                    {
                        text: 'Create an abstract representation of a philosophical concept through drawing',
                        category: 'wellness',
                        icon: 'üîÆ',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Visual philosophy bridges abstract thinking and creative expression, deepening conceptual understanding.'
                    },
                    {
                        text: 'Design and plan a creative project you\'d like to complete this month',
                        category: 'personal',
                        icon: 'üìã',
                        xp: 40,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Project planning with creative elements builds executive function while honoring artistic impulses.'
                    },
                    {
                        text: 'Write song lyrics inspired by a recent meaningful conversation',
                        category: 'personal',
                        icon: 'üé§',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Lyrical composition processes social connections and creates artistic meaning from daily interactions.'
                    },
                    {
                        text: 'Create a personal manifesto outlining your current life philosophy',
                        category: 'personal',
                        icon: 'üìú',
                        xp: 50,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Personal manifestos clarify values and create coherent frameworks for decision-making and growth.'
                    },
                    {
                        text: 'Redesign your personal style concept with 3 specific improvements',
                        category: 'personal',
                        icon: 'üëî',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Style reinvention supports identity development and builds confidence through external self-expression.'
                    },
                    {
                        text: 'Create a visual timeline of your personal growth over the past year',
                        category: 'personal',
                        icon: 'üìà',
                        xp: 40,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Growth visualization reinforces progress and identifies patterns in personal development.'
                    },
                    {
                        text: 'Write a short story exploring an existential theme that interests you',
                        category: 'personal',
                        icon: 'üìö',
                        xp: 50,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Existential fiction writing processes complex philosophical questions through narrative exploration.'
                    },
                    {
                        text: 'Design a custom workout routine that reflects your personality and goals',
                        category: 'fitness',
                        icon: 'üí™',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Personalized fitness design integrates physical and identity goals, improving adherence and satisfaction.'
                    },
                    {
                        text: 'Create an artistic interpretation of your current life philosophy through any medium',
                        category: 'wellness',
                        icon: 'üé≠',
                        xp: 45,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Artistic philosophy expression deepens understanding and creates personal meaning-making systems.'
                    },
                    {
                        text: 'Document and reflect on a meaningful interaction from your social circle',
                        category: 'personal',
                        icon: 'üó£Ô∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Social reflection processing strengthens relationships and develops interpersonal awareness.'
                    },
                    {
                        text: 'Design the perfect pub conversation topics for your friend group',
                        category: 'personal',
                        icon: 'üç∫',
                        xp: 20,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Social planning enhances group dynamics and creates meaningful shared experiences.'
                    }
                ],
                
                learning: [
                    {
                        text: 'Read and analyze a short philosophical text or essay (5-10 minutes)',
                        category: 'personal',
                        icon: 'üìö',
                        xp: 35,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Philosophical reading develops critical thinking and explores fundamental questions about existence and meaning.'
                    },
                    {
                        text: 'Watch a documentary or video essay about a historical period that interests you',
                        category: 'personal',
                        icon: 'üé¨',
                        xp: 40,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Historical documentaries combine visual learning with analytical thinking, enhancing retention and understanding.'
                    },
                    {
                        text: 'Research the scientific principles behind something you use daily',
                        category: 'personal',
                        icon: 'üî¨',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Understanding everyday science builds curiosity and connects abstract knowledge to practical experience.'
                    },
                    {
                        text: 'Explore the political philosophy behind a current event or policy',
                        category: 'personal',
                        icon: 'üèõÔ∏è',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Political analysis develops critical thinking and connects philosophical concepts to real-world applications.'
                    },
                    {
                        text: 'Learn about an indie or alternative band you\'ve never heard before',
                        category: 'personal',
                        icon: 'üé∏',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Musical exploration tied to personal taste develops aesthetic awareness and cultural understanding.'
                    },
                    {
                        text: 'Read a film analysis or review of a movie you\'ve seen recently',
                        category: 'personal',
                        icon: 'üé≠',
                        xp: 25,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Film criticism enhances analytical skills and deepens appreciation for cinematic art.'
                    },
                    {
                        text: 'Explore the historical context of a philosophical movement (existentialism, absurdism, etc.)',
                        category: 'personal',
                        icon: '‚è≥',
                        xp: 40,
                        timeEstimate: '18 minutes',
                        aiReasoning: 'Understanding philosophical history connects ideas to their cultural context and development.'
                    },
                    {
                        text: 'Research the science behind a fitness technique or training method',
                        category: 'fitness',
                        icon: 'üìä',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Evidence-based fitness learning improves training effectiveness and builds scientific literacy.'
                    },
                    {
                        text: 'Learn about a scientific discovery made in the last decade',
                        category: 'personal',
                        icon: 'üß™',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Recent scientific discoveries maintain intellectual curiosity and understanding of ongoing human progress.'
                    },
                    {
                        text: 'Study the cultural impact of a film genre or director you enjoy',
                        category: 'personal',
                        icon: 'üé•',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Film studies develop cultural awareness and analytical skills while exploring personal interests.'
                    },
                    {
                        text: 'Explore the biography of a philosopher whose ideas resonate with you',
                        category: 'personal',
                        icon: 'üë§',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Philosophical biographies connect abstract ideas to human lives and historical context.'
                    },
                    {
                        text: 'Learn about the history of golf techniques or equipment development',
                        category: 'personal',
                        icon: '‚õ≥',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Sports history combines personal interest with cultural and technological development understanding.'
                    },
                    {
                        text: 'Research the political and social context of a book you\'re reading or want to read',
                        category: 'personal',
                        icon: 'üìñ',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Literary contextualization deepens reading comprehension and critical analysis skills.'
                    },
                    {
                        text: 'Explore the philosophical implications of a recent scientific discovery',
                        category: 'personal',
                        icon: 'ü§î',
                        xp: 40,
                        timeEstimate: '18 minutes',
                        aiReasoning: 'Science-philosophy connections develop interdisciplinary thinking and explore meaning-making frameworks.'
                    },
                    {
                        text: 'Learn about the music theory behind a song or album you love',
                        category: 'personal',
                        icon: 'üéº',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Music theory understanding enhances appreciation and connects technical knowledge to aesthetic experience.'
                    },
                    {
                        text: 'Study the historical development of a fitness practice or sport',
                        category: 'fitness',
                        icon: 'üèÉ‚Äç‚ôÇÔ∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Sports history connects physical practice to cultural development and human achievement.'
                    },
                    {
                        text: 'Research the psychological aspects of personal style and self-presentation',
                        category: 'personal',
                        icon: 'üëî',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Style psychology connects self-improvement to identity development and social understanding.'
                    },
                    {
                        text: 'Explore the existential themes in a film you\'ve seen recently',
                        category: 'personal',
                        icon: 'üé¨',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Existential film analysis combines philosophical thinking with artistic appreciation and critical skills.'
                    },
                    {
                        text: 'Learn about the scientific method through a specific historical discovery',
                        category: 'personal',
                        icon: 'üîç',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Historical science learning develops critical thinking and understanding of evidence-based reasoning.'
                    },
                    {
                        text: 'Study the social dynamics of pub culture and community gathering spaces',
                        category: 'personal',
                        icon: 'üç∫',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Social space analysis connects personal experience to cultural anthropology and community understanding.'
                    },
                    {
                        text: 'Research the philosophy of self-improvement and personal development',
                        category: 'personal',
                        icon: 'üìà',
                        xp: 40,
                        timeEstimate: '18 minutes',
                        aiReasoning: 'Self-improvement philosophy provides frameworks for growth and develops meta-cognitive awareness.'
                    },
                    {
                        text: 'Learn about a historical figure who embodied principles you admire',
                        category: 'personal',
                        icon: 'üéñÔ∏è',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Biographical learning connects personal values to historical examples and character development.'
                    }
                ],
                
                social: [
                    {
                        text: 'Send a voice message to someone you care about',
                        category: 'personal',
                        icon: 'üé§',
                        xp: 30,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Voice communication conveys emotional nuance and strengthens social bonds.'
                    },
                    {
                        text: 'Compliment a stranger or service worker genuinely',
                        category: 'personal',
                        icon: 'ü§ù',
                        xp: 25,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Positive social interactions trigger oxytocin release and improve community connection.'
                    },
                    {
                        text: 'Write a positive review for a local business you enjoy',
                        category: 'personal',
                        icon: '‚≠ê',
                        xp: 20,
                        timeEstimate: '6 minutes',
                        aiReasoning: 'Contributing to community support creates a sense of civic engagement and purpose.'
                    },
                    {
                        text: 'Share a helpful tip or resource with your social network',
                        category: 'personal',
                        icon: 'üí°',
                        xp: 25,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Knowledge sharing reinforces learning and builds social capital.'
                    },
                    {
                        text: 'Plan a simple surprise for someone (gift, note, or gesture)',
                        category: 'personal',
                        icon: 'üéÅ',
                        xp: 35,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Altruistic planning activates reward centers and strengthens emotional bonds.'
                    },
                    {
                        text: 'Organize a casual pub meetup with your close friend group',
                        category: 'personal',
                        icon: 'üç∫',
                        xp: 40,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Pub culture facilitates authentic social connection and community building through shared experiences.'
                    },
                    {
                        text: 'Send a thoughtful message to someone who inspired or challenged your thinking recently',
                        category: 'personal',
                        icon: 'üí≠',
                        xp: 30,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Acknowledging intellectual influence strengthens relationships and encourages meaningful discourse.'
                    },
                    {
                        text: 'Plan a discussion topic for your next social gathering based on recent reading',
                        category: 'personal',
                        icon: 'üó£Ô∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Prepared conversation topics enhance social interactions and share intellectual discoveries.'
                    },
                    {
                        text: 'Reach out to someone whose perspective you value and ask for their thoughts on something',
                        category: 'personal',
                        icon: 'ü§î',
                        xp: 30,
                        timeEstimate: '7 minutes',
                        aiReasoning: 'Seeking diverse perspectives develops intellectual humility and strengthens social bonds.'
                    },
                    {
                        text: 'Share a meaningful film or book recommendation with reasoning behind the choice',
                        category: 'personal',
                        icon: 'üìö',
                        xp: 25,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Cultural sharing deepens relationships and expands collective understanding.'
                    },
                    {
                        text: 'Plan a low-key social activity that incorporates physical movement (walk, golf, etc.)',
                        category: 'personal',
                        icon: '‚õ≥',
                        xp: 35,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Active socializing combines physical and social benefits while building shared experiences.'
                    },
                    {
                        text: 'Write a brief letter or email to someone who positively influenced your personal growth',
                        category: 'personal',
                        icon: 'üìù',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Gratitude expression strengthens relationships and reinforces positive influences on development.'
                    },
                    {
                        text: 'Create and share a music playlist that captures a shared memory or inside joke',
                        category: 'personal',
                        icon: 'üéµ',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Musical sharing tied to relationships creates emotional bonds and shared identity markers.'
                    },
                    {
                        text: 'Organize a casual golf outing or suggest alternative active meetup',
                        category: 'personal',
                        icon: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                        xp: 40,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Sports-based socializing combines physical activity with social connection and shared challenge.'
                    },
                    {
                        text: 'Schedule quality time with someone important, prioritizing presence over activities',
                        category: 'personal',
                        icon: '‚è∞',
                        xp: 35,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Intentional presence in relationships builds deeper connections and emotional intimacy.'
                    },
                    {
                        text: 'Research and suggest a local event or venue for group exploration',
                        category: 'personal',
                        icon: 'üé™',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Social exploration planning builds community connections and creates novel shared experiences.'
                    },
                    {
                        text: 'Send an article, video, or resource that might interest someone in your social circle',
                        category: 'personal',
                        icon: 'üì§',
                        xp: 20,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Intellectual sharing demonstrates care and attention to others\' interests and development.'
                    },
                    {
                        text: 'Practice active listening: reach out specifically to hear someone else\'s perspective',
                        category: 'personal',
                        icon: 'üëÇ',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Active listening skills strengthen relationships and provide diverse viewpoints for personal growth.'
                    },
                    {
                        text: 'Plan a discussion around philosophical or ethical topics for your friend group',
                        category: 'personal',
                        icon: 'ü§î',
                        xp: 40,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Philosophical discussions develop critical thinking while building deeper social connections.'
                    },
                    {
                        text: 'Create a group chat or plan focused on sharing daily wins and growth moments',
                        category: 'personal',
                        icon: 'üì±',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Growth-focused social sharing creates accountability and mutual support systems.'
                    },
                    {
                        text: 'Reach out to reconnect with someone whose friendship you value but haven\'t talked to recently',
                        category: 'personal',
                        icon: 'üîÑ',
                        xp: 35,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Relationship maintenance prevents social isolation and preserves valuable connections.'
                    },
                    {
                        text: 'Plan a culture-focused meetup: film discussion, book club, or music sharing session',
                        category: 'personal',
                        icon: 'üé≠',
                        xp: 45,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Cultural socializing combines personal interests with community building and intellectual exchange.'
                    }
                ],
                
                mindfulness: [
                    {
                        text: 'Practice the 5-4-3-2-1 grounding technique',
                        category: 'wellness',
                        icon: 'üéØ',
                        xp: 20,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Sensory grounding reduces anxiety and anchors attention in the present moment.'
                    },
                    {
                        text: 'Mindfully eat a small snack, focusing on all senses',
                        category: 'nutrition',
                        icon: 'üçá',
                        xp: 25,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Mindful eating improves digestion and develops interoceptive awareness.'
                    },
                    {
                        text: 'Do a loving-kindness meditation for 7 minutes',
                        category: 'wellness',
                        icon: 'üíñ',
                        xp: 30,
                        timeEstimate: '7 minutes',
                        aiReasoning: 'Loving-kindness practice increases self-compassion and reduces negative emotions.'
                    },
                    {
                        text: 'Practice progressive muscle relaxation',
                        category: 'wellness',
                        icon: 'üòå',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Muscle relaxation activates the parasympathetic nervous system and reduces physical tension.'
                    },
                    {
                        text: 'Spend 5 minutes in complete silence, just listening',
                        category: 'wellness',
                        icon: 'üëÇ',
                        xp: 20,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Auditory mindfulness enhances sensory awareness and calms mental chatter.'
                    },
                    {
                        text: 'Practice mindful breathing while reflecting on an existential question',
                        category: 'wellness',
                        icon: 'ü§î',
                        xp: 35,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Combining breathwork with philosophical contemplation deepens both practices and integrates mind-body awareness.'
                    },
                    {
                        text: 'Do a body scan meditation with attention to physical sensations',
                        category: 'wellness',
                        icon: 'üßò‚Äç‚ôÇÔ∏è',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Body scanning develops interoceptive awareness and reduces mind-body disconnection.'
                    },
                    {
                        text: 'Practice mindful walking, focusing entirely on each step',
                        category: 'wellness',
                        icon: 'üö∂‚Äç‚ôÄÔ∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Walking meditation combines movement with mindfulness, grounding awareness in physical sensation.'
                    },
                    {
                        text: 'Sit in contemplative silence about the nature of identity and self',
                        category: 'wellness',
                        icon: 'ü™û',
                        xp: 40,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Self-contemplation aligns with existential interests while developing introspective awareness.'
                    },
                    {
                        text: 'Practice mindful observation of thoughts without judgment for 8 minutes',
                        category: 'wellness',
                        icon: 'üí≠',
                        xp: 30,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Thought observation develops meta-cognitive awareness and reduces emotional reactivity.'
                    },
                    {
                        text: 'Focus mindfully on the absurdity and beauty of ordinary moments',
                        category: 'wellness',
                        icon: 'üå∏',
                        xp: 35,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Absurdist mindfulness connects philosophical interests with present-moment awareness and appreciation.'
                    },
                    {
                        text: 'Practice gratitude meditation specifically for intellectual and creative influences',
                        category: 'wellness',
                        icon: 'üìö',
                        xp: 30,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Intellectual gratitude connects mindfulness to personal growth and learning appreciation.'
                    },
                    {
                        text: 'Mindfully engage with a piece of music, noting emotional and physical responses',
                        category: 'wellness',
                        icon: 'üéµ',
                        xp: 25,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Musical mindfulness combines aesthetic appreciation with embodied awareness and emotional processing.'
                    },
                    {
                        text: 'Practice acceptance meditation about personal growth challenges',
                        category: 'wellness',
                        icon: 'üå±',
                        xp: 35,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Acceptance practice supports self-improvement goals while reducing self-judgment and pressure.'
                    },
                    {
                        text: 'Engage in mindful stretching with attention to physical and mental flexibility',
                        category: 'wellness',
                        icon: 'ü§∏‚Äç‚ôÄÔ∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Mindful movement connects physical and mental flexibility, supporting both fitness and psychological goals.'
                    },
                    {
                        text: 'Practice mindful observation of social dynamics when in public spaces',
                        category: 'wellness',
                        icon: 'üë•',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Social mindfulness develops empathy and understanding while practicing present-moment awareness.'
                    },
                    {
                        text: 'Contemplate the interconnectedness of personal choices and broader impact',
                        category: 'wellness',
                        icon: 'üåê',
                        xp: 40,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Systems thinking meditation connects personal awareness to political and social consciousness.'
                    },
                    {
                        text: 'Practice mindful appreciation of literary or cinematic art',
                        category: 'wellness',
                        icon: 'üé≠',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Aesthetic mindfulness deepens cultural appreciation while developing focused attention skills.'
                    },
                    {
                        text: 'Engage in contemplative reading of a meaningful passage',
                        category: 'wellness',
                        icon: 'üìñ',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Contemplative reading combines intellectual engagement with mindful attention and reflection.'
                    },
                    {
                        text: 'Practice mindful awareness of personal style choices and their meaning',
                        category: 'wellness',
                        icon: 'üëî',
                        xp: 25,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Style mindfulness connects self-expression choices to identity awareness and intentional living.'
                    },
                    {
                        text: 'Contemplate mortality and meaning while maintaining equanimity',
                        category: 'wellness',
                        icon: '‚è≥',
                        xp: 45,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Existential contemplation develops philosophical clarity while building emotional resilience and acceptance.'
                    },
                    {
                        text: 'Practice mindful attention to the quality of your friendships and social connections',
                        category: 'wellness',
                        icon: 'üí≠',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Relationship mindfulness enhances social awareness and appreciation for meaningful connections.'
                    }
                ],
                
                micro: [
                    {
                        text: 'Do 20 jumping jacks with enthusiasm',
                        category: 'fitness',
                        icon: 'ü§∏',
                        xp: 15,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Burst exercise increases heart rate and releases endorphins quickly.'
                    },
                    {
                        text: 'Organize one small space (desk drawer, wallet, bag)',
                        category: 'personal',
                        icon: 'üóÇÔ∏è',
                        xp: 15,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Micro-organization reduces cognitive load and provides immediate satisfaction.'
                    },
                    {
                        text: 'Practice perfect posture for 3 minutes',
                        category: 'wellness',
                        icon: 'üßç',
                        xp: 10,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Posture awareness improves confidence and reduces musculoskeletal strain.'
                    },
                    {
                        text: 'Smile genuinely at yourself in a mirror',
                        category: 'wellness',
                        icon: 'üòä',
                        xp: 10,
                        timeEstimate: '1 minute',
                        aiReasoning: 'Mirror work with positive facial expressions activates mood-lifting neural circuits.'
                    },
                    {
                        text: 'Take 10 slow, intentional breaths',
                        category: 'wellness',
                        icon: 'ü´Å',
                        xp: 10,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Controlled breathing activates the vagus nerve and promotes calm focus.'
                    },
                    {
                        text: 'Do 15 wall push-ups with proper form',
                        category: 'fitness',
                        icon: 'üí™',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Wall push-ups provide accessible strength training without equipment requirements.'
                    },
                    {
                        text: 'Clean and organize your phone\'s home screen',
                        category: 'personal',
                        icon: 'üì±',
                        xp: 10,
                        timeEstimate: '4 minutes',
                        aiReasoning: 'Phone organization reduces digital friction and improves daily efficiency.'
                    },
                    {
                        text: 'Practice gratitude by listing 3 things you appreciate right now',
                        category: 'wellness',
                        icon: 'üôè',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Micro-gratitude practices shift neural patterns toward positive emotion regulation.'
                    },
                    {
                        text: 'Do 30 seconds of high knees in place',
                        category: 'fitness',
                        icon: 'üèÉ‚Äç‚ôÇÔ∏è',
                        xp: 10,
                        timeEstimate: '1 minute',
                        aiReasoning: 'Brief cardio bursts activate circulation and mental alertness quickly.'
                    },
                    {
                        text: 'Write down one insight from recent reading or learning',
                        category: 'personal',
                        icon: 'üí°',
                        xp: 15,
                        timeEstimate: '4 minutes',
                        aiReasoning: 'Insight documentation consolidates learning and builds personal knowledge systems.'
                    },
                    {
                        text: 'Practice mindful hand washing with full attention',
                        category: 'wellness',
                        icon: 'ü§≤',
                        xp: 10,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Mindful routines transform daily activities into presence practice opportunities.'
                    },
                    {
                        text: 'Do 20 calf raises while thinking about your goals',
                        category: 'fitness',
                        icon: 'ü¶µ',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Combining movement with goal visualization reinforces both physical and mental practices.'
                    },
                    {
                        text: 'Clear your digital downloads folder',
                        category: 'personal',
                        icon: 'üìÇ',
                        xp: 10,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Digital decluttering reduces cognitive overhead and improves system performance.'
                    },
                    {
                        text: 'Stretch your neck and shoulders mindfully',
                        category: 'wellness',
                        icon: 'ü§∑‚Äç‚ôÄÔ∏è',
                        xp: 15,
                        timeEstimate: '4 minutes',
                        aiReasoning: 'Targeted stretching releases tension and improves posture awareness.'
                    },
                    {
                        text: 'Write a single sentence describing your current mood',
                        category: 'wellness',
                        icon: 'üìù',
                        xp: 10,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Mood labeling develops emotional awareness and self-understanding.'
                    },
                    {
                        text: 'Do 10 squats with mindful attention to form',
                        category: 'fitness',
                        icon: '‚¨áÔ∏è',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Mindful bodyweight exercises build strength while developing movement awareness.'
                    },
                    {
                        text: 'Send one encouraging text to someone in your network',
                        category: 'personal',
                        icon: 'üí¨',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Micro-support actions strengthen social bonds and spread positive energy.'
                    },
                    {
                        text: 'Practice the 4-7-8 breathing pattern twice',
                        category: 'wellness',
                        icon: 'üå¨Ô∏è',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Structured breathing patterns activate parasympathetic nervous system responses.'
                    },
                    {
                        text: 'Organize your keychain and remove unnecessary items',
                        category: 'personal',
                        icon: 'üîë',
                        xp: 10,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Physical simplification reduces daily friction and improves mindful awareness.'
                    },
                    {
                        text: 'Do 15 arm circles forward and backward',
                        category: 'fitness',
                        icon: 'üîÑ',
                        xp: 10,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Shoulder mobility exercises improve circulation and reduce upper body tension.'
                    },
                    {
                        text: 'Look up and contemplate one interesting fact about today\'s date in history',
                        category: 'personal',
                        icon: 'üìÖ',
                        xp: 15,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Historical curiosity connects present moments to broader human narrative and learning.'
                    },
                    {
                        text: 'Practice mindful listening to ambient sounds for 2 minutes',
                        category: 'wellness',
                        icon: 'üëÇ',
                        xp: 15,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Auditory mindfulness develops present-moment awareness and sensory appreciation.'
                    }
                ],
                
                exploration: [
                    {
                        text: 'Explore a new route to a familiar destination',
                        category: 'personal',
                        icon: 'üó∫Ô∏è',
                        xp: 25,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Novel routes stimulate neuroplasticity and prevent autopilot behavior.'
                    },
                    {
                        text: 'Try a new healthy recipe with ingredients you rarely use',
                        category: 'nutrition',
                        icon: 'üë®‚Äçüç≥',
                        xp: 40,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Culinary exploration expands nutrient diversity and cognitive flexibility.'
                    },
                    {
                        text: 'Listen to music from a genre you never choose',
                        category: 'personal',
                        icon: 'üéº',
                        xp: 20,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Musical diversity stimulates different neural networks and emotional responses.'
                    },
                    {
                        text: 'Research and try a productivity technique you\'ve never used',
                        category: 'productivity',
                        icon: '‚öôÔ∏è',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Productivity experimentation helps discover personalized efficiency methods.'
                    },
                    {
                        text: 'Visit a local place you\'ve never been before',
                        category: 'personal',
                        icon: 'üìç',
                        xp: 35,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Local exploration builds community connection and spatial memory.'
                    },
                    {
                        text: 'Try a completely different style of golf swing or technique',
                        category: 'fitness',
                        icon: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                        xp: 30,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Golf technique exploration develops motor learning and athletic adaptability.'
                    },
                    {
                        text: 'Experiment with a new writing style or format (poetry, stream of consciousness, etc.)',
                        category: 'personal',
                        icon: '‚úçÔ∏è',
                        xp: 35,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Writing style exploration develops creative expression and analytical thinking skills.'
                    },
                    {
                        text: 'Watch a film from a culture or time period completely unfamiliar to you',
                        category: 'personal',
                        icon: 'üé¨',
                        xp: 40,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Cross-cultural film exploration broadens perspective and develops cultural empathy.'
                    },
                    {
                        text: 'Explore a philosophical concept you\'ve never studied before',
                        category: 'personal',
                        icon: 'ü§î',
                        xp: 40,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Philosophical exploration develops critical thinking and expands intellectual frameworks.'
                    },
                    {
                        text: 'Try a new form of physical exercise or movement you\'ve never attempted',
                        category: 'fitness',
                        icon: 'ü§∏‚Äç‚ôÇÔ∏è',
                        xp: 35,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Movement exploration builds physical literacy and challenges coordination patterns.'
                    },
                    {
                        text: 'Experiment with a new method of self-improvement or personal development',
                        category: 'personal',
                        icon: 'üî¨',
                        xp: 35,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Growth technique exploration helps discover personalized development approaches.'
                    },
                    {
                        text: 'Try a completely different approach to your morning routine',
                        category: 'wellness',
                        icon: 'üåÖ',
                        xp: 25,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Routine variation prevents habituation and reveals optimal timing preferences.'
                    },
                    {
                        text: 'Explore a local pub or social venue you\'ve never been to',
                        category: 'personal',
                        icon: 'üç∫',
                        xp: 30,
                        timeEstimate: '45 minutes',
                        aiReasoning: 'Social venue exploration builds community knowledge and expands social possibilities.'
                    },
                    {
                        text: 'Try reading a book or article in a completely new subject area',
                        category: 'personal',
                        icon: 'üìö',
                        xp: 35,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Cross-disciplinary reading builds cognitive flexibility and knowledge connections.'
                    },
                    {
                        text: 'Experiment with a new form of creative expression (sculpture, dance, etc.)',
                        category: 'wellness',
                        icon: 'üé≠',
                        xp: 40,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Creative exploration activates different neural pathways and enhances self-expression.'
                    },
                    {
                        text: 'Try a new approach to socializing or connecting with people',
                        category: 'personal',
                        icon: 'ü§ù',
                        xp: 30,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Social approach experimentation develops interpersonal skills and confidence.'
                    },
                    {
                        text: 'Explore a political perspective or ideology different from your own',
                        category: 'personal',
                        icon: 'üèõÔ∏è',
                        xp: 40,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Political exploration develops critical thinking and intellectual empathy.'
                    },
                    {
                        text: 'Try a new method of organizing or structuring your thoughts',
                        category: 'productivity',
                        icon: 'üß†',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Cognitive organization experiments improve thinking clarity and mental efficiency.'
                    },
                    {
                        text: 'Experiment with a new way of expressing your personal style',
                        category: 'personal',
                        icon: 'üëî',
                        xp: 25,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Style experimentation supports identity development and self-expression confidence.'
                    },
                    {
                        text: 'Try a new approach to learning or studying something',
                        category: 'personal',
                        icon: 'üìñ',
                        xp: 30,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Learning method exploration helps discover optimal educational approaches for your brain.'
                    },
                    {
                        text: 'Explore a new way of tracking or reflecting on your personal growth',
                        category: 'personal',
                        icon: 'üìä',
                        xp: 35,
                        timeEstimate: '18 minutes',
                        aiReasoning: 'Growth tracking experimentation helps discover the most motivating progress methods.'
                    }
                ]
            };
            
            // Select tasks from different pools based on context
            const selectedPools = [];
            
            if (context.stressLevel > 0.6) selectedPools.push('mindfulness', 'micro');
            if (context.energyLevel > 0.7) selectedPools.push('exploration', 'creative');
            if (context.motivationState > 0.6) selectedPools.push('learning', 'social');
            if (context.timeOfDay === 'evening') selectedPools.push('mindfulness', 'creative');
            if (context.weekContext === 'weekend') selectedPools.push('exploration', 'social');
            
            // Default pools if none selected
            if (selectedPools.length === 0) {
                selectedPools.push('creative', 'learning', 'micro');
            }
            
            let availableTasks = [];
            selectedPools.forEach(poolName => {
                if (pools[poolName]) {
                    availableTasks.push(...pools[poolName]);
                }
            });
            
            const shuffled = availableTasks.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3).map(task => ({
                id: 'serendipity_' + Date.now() + Math.random(),
                ...task,
                priority: 'low',
                difficulty: 'easy',
                confidence: Math.floor(70 + Math.random() * 20)
            }));
        }
        
        function generateBiometricAwareTasks(context, stats) {
            const tasks = [];
            
            if (context.energyLevel < 0.4) {
                tasks.push({
                    id: 'energy_boost_' + Date.now(),
                    text: 'Energizing breathwork: 4-7-8 breathing pattern for 3 minutes',
                    category: 'wellness',
                    icon: '‚ö°',
                    xp: 20,
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '3 minutes',
                    confidence: 88,
                    aiReasoning: `Low energy detected (${Math.round(context.energyLevel * 100)}%). This breathing pattern naturally activates the sympathetic nervous system.`
                });
            }
            
            if (context.stressLevel > 0.6) {
                tasks.push({
                    id: 'stress_relief_' + Date.now(),
                    text: 'Stress release: 5-minute progressive muscle relaxation',
                    category: 'wellness',
                    icon: 'üòå',
                    xp: 25,
                    priority: 'high',
                    difficulty: 'easy',
                    timeEstimate: '5 minutes',
                    confidence: 92,
                    aiReasoning: `Elevated stress detected (${Math.round(context.stressLevel * 100)}%). Progressive relaxation reduces cortisol effectively.`
                });
            }
            
            return tasks;
        }
        
        function generateAdvancedContextualTasks(context, stats, hour) {
            const tasks = [];
            const month = new Date().getMonth();
            const dayOfWeek = new Date().getDay();
            
            // üåÖ MORNING OPTIMIZATION (6-10 AM)
            if (hour >= 6 && hour <= 10) {
                const morningTasks = [
                    {
                        text: 'Start your day with intentional breath work - 4-7-8 pattern for energy',
                        category: 'wellness',
                        icon: 'üåÖ',
                        xp: 25,
                        timeEstimate: '4 minutes',
                        aiReasoning: 'Morning breathwork optimizes oxygen delivery and activates the sympathetic nervous system naturally.'
                    },
                    {
                        text: 'Set three specific intentions for today and write them down',
                        category: 'personal',
                        icon: 'üéØ',
                        xp: 20,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Intention setting activates the prefrontal cortex and improves goal-directed behavior.'
                    },
                    {
                        text: 'Do 5 minutes of gentle stretching or sun salutations',
                        category: 'fitness',
                        icon: 'üßò‚Äç‚ôÄÔ∏è',
                        xp: 30,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Morning movement increases circulation and releases mood-enhancing endorphins.'
                    }
                ];
                
                if (stats.waterGlasses === 0) {
                    morningTasks.push({
                        text: 'Hydrate mindfully: drink warm water with lemon while practicing gratitude',
                        category: 'hydration',
                        icon: 'üçã',
                        xp: 25,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Morning hydration with citrus aids liver detoxification and vitamin C absorption.'
                    });
                }
                
                const morningTask = morningTasks[Math.floor(Math.random() * morningTasks.length)];
                tasks.push({
                    id: 'morning_' + Date.now(),
                    ...morningTask,
                    priority: 'medium',
                    difficulty: 'easy',
                    confidence: 90
                });
            }
            
            // üåû MIDDAY OPTIMIZATION (11 AM - 2 PM)
            if (hour >= 11 && hour <= 14) {
                const middayTasks = [
                    {
                        text: 'Take a mindful eating break - savor 5 bites extremely slowly',
                        category: 'nutrition',
                        icon: 'üçΩÔ∏è',
                        xp: 20,
                        timeEstimate: '7 minutes',
                        aiReasoning: 'Mindful eating improves digestion and prevents overconsumption through satiety awareness.'
                    },
                    {
                        text: 'Practice desk exercises: shoulder rolls, neck stretches, and spinal twists',
                        category: 'fitness',
                        icon: 'ü™ë',
                        xp: 15,
                        timeEstimate: '4 minutes',
                        aiReasoning: 'Midday movement breaks reduce muscle tension and improve posture-related strain.'
                    },
                    {
                        text: 'Step outside for natural light exposure and 20 deep breaths',
                        category: 'wellness',
                        icon: '‚òÄÔ∏è',
                        xp: 20,
                        timeEstimate: '6 minutes',
                        aiReasoning: 'Natural light exposure regulates circadian rhythms and supports vitamin D synthesis.'
                    }
                ];
                
                const middayTask = middayTasks[Math.floor(Math.random() * middayTasks.length)];
                tasks.push({
                    id: 'midday_' + Date.now(),
                    ...middayTask,
                    priority: 'medium',
                    difficulty: 'easy',
                    confidence: 85
                });
            }
            
            // üåÖ AFTERNOON SLUMP (2-4 PM)
            if (hour >= 14 && hour <= 16) {
                const afternoonTasks = [
                    {
                        text: 'Beat the afternoon slump: 15-minute deep work sprint',
                        category: 'productivity',
                        icon: 'üß†',
                        xp: 40,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Afternoon attention dip is natural - brief focused sessions can restore cognitive capacity.'
                    },
                    {
                        text: 'Energy boost sequence: 20 jumping jacks + cold water + power posing',
                        category: 'fitness',
                        icon: '‚ö°',
                        xp: 25,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Combined movement, hydration, and power posing increases alertness and confidence.'
                    },
                    {
                        text: 'Practice the 20-20-20 rule: look at something 20 feet away for 20 seconds',
                        category: 'wellness',
                        icon: 'üëÅÔ∏è',
                        xp: 15,
                        timeEstimate: '2 minutes',
                        aiReasoning: 'Eye exercises reduce digital eye strain and prevent accommodation fatigue.'
                    }
                ];
                
                if (stats.focusMinutes < 60) {
                    const focusTask = afternoonTasks[0];
                    tasks.push({
                        id: 'afternoon_focus_' + Date.now(),
                        ...focusTask,
                        priority: 'medium',
                        difficulty: 'medium',
                        confidence: 85
                    });
                } else {
                    const alternativeTask = afternoonTasks[Math.floor(Math.random() * (afternoonTasks.length - 1)) + 1];
                    tasks.push({
                        id: 'afternoon_' + Date.now(),
                        ...alternativeTask,
                        priority: 'low',
                        difficulty: 'easy',
                        confidence: 80
                    });
                }
            }
            
            // üåÜ EVENING OPTIMIZATION (5-8 PM)
            if (hour >= 17 && hour <= 20) {
                const eveningTasks = [
                    {
                        text: 'Reflect and journal: What went well today? What did you learn?',
                        category: 'personal',
                        icon: 'üìñ',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Evening reflection consolidates learning and improves emotional regulation.'
                    },
                    {
                        text: 'Prepare tomorrow: lay out clothes, prep breakfast, set priorities',
                        category: 'personal',
                        icon: 'üìã',
                        xp: 25,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Evening preparation reduces morning decision fatigue and improves sleep quality.'
                    },
                    {
                        text: 'Digital sunset: reduce screen brightness and switch to warm lighting',
                        category: 'wellness',
                        icon: 'üåÖ',
                        xp: 15,
                        timeEstimate: '3 minutes',
                        aiReasoning: 'Blue light reduction in evening supports natural melatonin production.'
                    },
                    {
                        text: 'Connect socially: call someone, send a thoughtful message, or plan quality time',
                        category: 'personal',
                        icon: 'ü§ó',
                        xp: 30,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Evening social connection strengthens relationships and provides emotional support.'
                    }
                ];
                
                const eveningTask = eveningTasks[Math.floor(Math.random() * eveningTasks.length)];
                tasks.push({
                    id: 'evening_' + Date.now(),
                    ...eveningTask,
                    priority: 'low',
                    difficulty: 'easy',
                    confidence: 85
                });
            }
            
            // üåô NIGHT WIND-DOWN (8 PM+)
            if (hour >= 20) {
                const nightTasks = [
                    {
                        text: 'Create a calming bedtime ritual: dim lights, herbal tea, gentle music',
                        category: 'wellness',
                        icon: 'üåô',
                        xp: 25,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Consistent bedtime rituals signal the brain to prepare for restorative sleep.'
                    },
                    {
                        text: 'Practice gratitude meditation: focus on 3 things you appreciated today',
                        category: 'wellness',
                        icon: 'üôè',
                        xp: 20,
                        timeEstimate: '8 minutes',
                        aiReasoning: 'Gratitude practice before bed improves sleep quality and emotional well-being.'
                    },
                    {
                        text: 'Progressive muscle relaxation: tense and release each muscle group',
                        category: 'wellness',
                        icon: 'üòå',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Progressive relaxation activates the parasympathetic nervous system for better sleep.'
                    }
                ];
                
                const nightTask = nightTasks[Math.floor(Math.random() * nightTasks.length)];
                tasks.push({
                    id: 'night_' + Date.now(),
                    ...nightTask,
                    priority: 'low',
                    difficulty: 'easy',
                    confidence: 90
                });
            }
            
            // üìÖ WEEKLY CONTEXT TASKS
            if (dayOfWeek === 1) { // Monday
                tasks.push({
                    id: 'monday_' + Date.now(),
                    text: 'Monday motivation: set your weekly priorities and visualize success',
                    category: 'personal',
                    icon: 'üöÄ',
                    xp: 35,
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '12 minutes',
                    confidence: 85,
                    aiReasoning: 'Monday goal-setting creates momentum and clarity for the entire week.'
                });
            }
            
            if (dayOfWeek === 5) { // Friday
                tasks.push({
                    id: 'friday_' + Date.now(),
                    text: 'Friday reflection: celebrate weekly wins and plan weekend rejuvenation',
                    category: 'personal',
                    icon: 'üéâ',
                    xp: 30,
                    priority: 'low',
                    difficulty: 'easy',
                    timeEstimate: '10 minutes',
                    confidence: 90,
                    aiReasoning: 'Weekly reflection builds self-awareness and maintains motivation patterns.'
                });
            }
            
            if (dayOfWeek === 0 || dayOfWeek === 6) { // Weekend
                const weekendTasks = [
                    {
                        text: 'Weekend adventure: try a new local spot or activity',
                        category: 'personal',
                        icon: 'üó∫Ô∏è',
                        xp: 40,
                        timeEstimate: '45 minutes',
                        aiReasoning: 'Novel experiences stimulate neuroplasticity and create positive memories.'
                    },
                    {
                        text: 'Meal prep session: prepare healthy options for the coming week',
                        category: 'nutrition',
                        icon: 'ü•ò',
                        xp: 50,
                        timeEstimate: '30 minutes',
                        aiReasoning: 'Meal preparation improves nutrition consistency and reduces decision fatigue.'
                    },
                    {
                        text: 'Digital detox hour: no screens, focus on reading, nature, or creativity',
                        category: 'wellness',
                        icon: 'üìµ',
                        xp: 35,
                        timeEstimate: '60 minutes',
                        aiReasoning: 'Regular digital breaks improve attention span and mental well-being.'
                    }
                ];
                
                const weekendTask = weekendTasks[Math.floor(Math.random() * weekendTasks.length)];
                tasks.push({
                    id: 'weekend_' + Date.now(),
                    ...weekendTask,
                    priority: 'low',
                    difficulty: 'medium',
                    confidence: 80
                });
            }
            
            // üåç SEASONAL TASKS
            const seasonalTasks = generateSeasonalTasks(month);
            if (seasonalTasks.length > 0) {
                tasks.push(seasonalTasks[0]);
            }
            
            // üî• STREAK-BASED MOTIVATIONAL TASKS  
            const streakTasks = generateStreakMotivationTasks(context, stats);
            tasks.push(...streakTasks);
            
            // üé≠ PERSONALITY-BASED TASKS
            const personalityTasks = generatePersonalityAwareTasks(context, stats);
            tasks.push(...personalityTasks);
            
            return tasks;
        }
        
        function generateSeasonalTasks(month) {
            const tasks = [];
            
            // Spring (March-May)
            if (month >= 2 && month <= 4) {
                const springTasks = [
                    {
                        text: 'Spring cleaning: declutter one area and donate unused items',
                        category: 'personal',
                        icon: 'üå∏',
                        xp: 35,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Spring decluttering aligns with natural renewal cycles and reduces cognitive load.'
                    },
                    {
                        text: 'Start or tend to a small plant - even herbs on a windowsill',
                        category: 'wellness',
                        icon: 'üå±',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Plant care connects you with nature and provides nurturing satisfaction.'
                    },
                    {
                        text: 'Take advantage of longer days - extend outdoor time by 10 minutes',
                        category: 'wellness',
                        icon: '‚òÄÔ∏è',
                        xp: 25,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Increased sunlight exposure helps reset circadian rhythms after winter.'
                    }
                ];
                tasks.push(springTasks[Math.floor(Math.random() * springTasks.length)]);
            }
            
            // Summer (June-August)
            if (month >= 5 && month <= 7) {
                const summerTasks = [
                    {
                        text: 'Hydration boost: create fruit-infused water for extra vitamins',
                        category: 'hydration',
                        icon: 'üçì',
                        xp: 20,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Summer heat increases fluid needs; fruit infusion adds electrolytes and antioxidants.'
                    },
                    {
                        text: 'Early morning movement: exercise before the day gets too hot',
                        category: 'fitness',
                        icon: 'üåÖ',
                        xp: 35,
                        timeEstimate: '20 minutes',
                        aiReasoning: 'Morning exercise in summer avoids heat stress while maximizing energy benefits.'
                    },
                    {
                        text: 'Connect with nature: find shade outdoors and practice mindfulness',
                        category: 'wellness',
                        icon: 'üå≥',
                        xp: 25,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Natural settings reduce cortisol and improve attention restoration.'
                    }
                ];
                tasks.push(summerTasks[Math.floor(Math.random() * summerTasks.length)]);
            }
            
            // Fall (September-November)  
            if (month >= 8 && month <= 10) {
                const fallTasks = [
                    {
                        text: 'Cozy preparation: organize your space for comfort and warmth',
                        category: 'personal',
                        icon: 'üçÇ',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Creating cozy environments supports mental health during seasonal transitions.'
                    },
                    {
                        text: 'Immune support routine: focus on vitamin C-rich foods or supplements',
                        category: 'nutrition',
                        icon: 'üçä',
                        xp: 25,
                        timeEstimate: '5 minutes',
                        aiReasoning: 'Fall immune system preparation helps prevent seasonal illness.'
                    },
                    {
                        text: 'Reflection practice: journal about what you want to release and embrace',
                        category: 'personal',
                        icon: 'üìù',
                        xp: 30,
                        timeEstimate: '12 minutes',
                        aiReasoning: 'Fall naturally invites introspection and personal growth reflection.'
                    }
                ];
                tasks.push(fallTasks[Math.floor(Math.random() * fallTasks.length)]);
            }
            
            // Winter (December-February)
            if (month >= 11 || month <= 1) {
                const winterTasks = [
                    {
                        text: 'Light therapy: spend time near a bright window or light source',
                        category: 'wellness',
                        icon: 'üí°',
                        xp: 20,
                        timeEstimate: '10 minutes',
                        aiReasoning: 'Winter light exposure helps combat seasonal mood changes.'
                    },
                    {
                        text: 'Warming nutrition: prepare a nourishing hot meal or drink mindfully',
                        category: 'nutrition',
                        icon: 'üç≤',
                        xp: 35,
                        timeEstimate: '25 minutes',
                        aiReasoning: 'Warm foods support metabolism and provide psychological comfort in winter.'
                    },
                    {
                        text: 'Indoor movement: create a energizing routine you can do inside',
                        category: 'fitness',
                        icon: 'üè†',
                        xp: 30,
                        timeEstimate: '15 minutes',
                        aiReasoning: 'Indoor exercise maintains activity levels when outdoor options are limited.'
                    }
                ];
                tasks.push(winterTasks[Math.floor(Math.random() * winterTasks.length)]);
            }
            
            return tasks.map(task => ({
                id: 'seasonal_' + Date.now() + Math.random(),
                ...task,
                priority: 'low',
                difficulty: 'easy',
                confidence: 85
            }));
        }
        
        function generateStreakMotivationTasks(context, stats) {
            const tasks = [];
            const streaks = gameState.streaks;
            
            // Celebrate existing streaks
            if (streaks.workout >= 3) {
                tasks.push({
                    id: 'streak_workout_' + Date.now(),
                    text: `Amazing! Extend your ${streaks.workout}-day workout streak with any movement`,
                    category: 'fitness',
                    icon: 'üî•',
                    xp: 25 + (streaks.workout * 2),
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '10 minutes',
                    confidence: 95,
                    aiReasoning: `Your ${streaks.workout}-day streak shows great consistency. Momentum is powerful for habit formation.`
                });
            }
            
            if (streaks.water >= 3) {
                tasks.push({
                    id: 'streak_water_' + Date.now(),
                    text: `Keep your ${streaks.water}-day hydration streak alive - drink mindfully`,
                    category: 'hydration',
                    icon: 'üíß',
                    xp: 20 + streaks.water,
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '2 minutes',
                    confidence: 95,
                    aiReasoning: `${streaks.water} consecutive days of good hydration! Consistency is building strong neural pathways.`
                });
            }
            
            // Encourage streak starts for broken streaks
            if (streaks.workout === 0 && stats.workouts === 0) {
                tasks.push({
                    id: 'restart_workout_' + Date.now(),
                    text: 'Fresh start: begin a new workout streak with 5 minutes of any movement',
                    category: 'fitness',
                    icon: 'üåü',
                    xp: 30,
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '5 minutes',
                    confidence: 90,
                    aiReasoning: 'New beginnings are powerful. Even small movements can restart positive momentum.'
                });
            }
            
            return tasks;
        }
        
        function generatePersonalityAwareTasks(context, stats) {
            const tasks = [];
            const completedTasks = gameState.tasks.filter(t => t.completed);
            
            // Analyze user preferences from history
            const categoryPreferences = {};
            completedTasks.forEach(task => {
                categoryPreferences[task.category] = (categoryPreferences[task.category] || 0) + 1;
            });
            
            const topCategory = Object.entries(categoryPreferences)
                .sort((a, b) => b[1] - a[1])[0]?.[0];
            
            // Generate tasks based on preferred patterns
            if (topCategory === 'fitness' && context.energyLevel > 0.6) {
                tasks.push({
                    id: 'fitness_lover_' + Date.now(),
                    text: 'Challenge yourself: try a new exercise variation or increase intensity slightly',
                    category: 'fitness',
                    icon: 'üí™',
                    xp: 40,
                    priority: 'medium',
                    difficulty: 'medium',
                    timeEstimate: '15 minutes',
                    confidence: 85,
                    aiReasoning: 'Your fitness focus suggests you enjoy physical challenges. Progressive overload builds strength.'
                });
            }
            
            if (topCategory === 'wellness' && context.stressLevel > 0.5) {
                tasks.push({
                    id: 'wellness_focus_' + Date.now(),
                    text: 'Mindful transition: create a 5-minute calming ritual between activities',
                    category: 'wellness',
                    icon: 'üßò‚Äç‚ôÄÔ∏è',
                    xp: 25,
                    priority: 'medium',
                    difficulty: 'easy',
                    timeEstimate: '5 minutes',
                    confidence: 90,
                    aiReasoning: 'Your wellness focus indicates mindfulness resonates with you. Transitions prevent stress accumulation.'
                });
            }
            
            if (topCategory === 'personal' && context.motivationState > 0.7) {
                tasks.push({
                    id: 'growth_minded_' + Date.now(),
                    text: 'Personal development: identify one skill you want to develop and take a tiny first step',
                    category: 'personal',
                    icon: 'üìà',
                    xp: 35,
                    priority: 'low',
                    difficulty: 'medium',
                    timeEstimate: '10 minutes',
                    confidence: 85,
                    aiReasoning: 'Your personal development focus shows growth mindset. Small steps create lasting change.'
                });
            }
            
            // Add variety for well-rounded users
            if (Object.keys(categoryPreferences).length >= 4) {
                tasks.push({
                    id: 'well_rounded_' + Date.now(),
                    text: 'Balance practice: choose the life area you\'ve neglected most today and give it attention',
                    category: 'wellness',
                    icon: '‚öñÔ∏è',
                    xp: 30,
                    priority: 'low',
                    difficulty: 'easy',
                    timeEstimate: '8 minutes',
                    confidence: 80,
                    aiReasoning: 'Your balanced approach to wellness is admirable. Conscious attention to neglected areas maintains harmony.'
                });
            }
            
            return tasks;
        }
        
        function filterByRelevance(tasks, context) {
            return tasks.filter(task => {
                if (context.availableTime === 'low' && task.timeEstimate && 
                    (task.timeEstimate.includes('15') || task.timeEstimate.includes('20'))) {
                    return false;
                }
                if (context.energyLevel < 0.3 && task.difficulty === 'hard') {
                    return false;
                }
                return true;
            });
        }
        
        function rankByOptimalTiming(tasks, hour, dayOfWeek) {
            return tasks.sort((a, b) => {
                let scoreA = 0, scoreB = 0;
                
                // Time-based bonuses
                if (hour >= 6 && hour <= 10) {
                    if (['fitness', 'hydration'].includes(a.category)) scoreA += 15;
                    if (['fitness', 'hydration'].includes(b.category)) scoreB += 15;
                }
                
                if (hour >= 14 && hour <= 16) {
                    if (['productivity', 'personal'].includes(a.category)) scoreA += 15;
                    if (['productivity', 'personal'].includes(b.category)) scoreB += 15;
                }
                
                // Priority weighting
                const priorityValues = { high: 25, medium: 15, low: 5 };
                scoreA += priorityValues[a.priority] || 10;
                scoreB += priorityValues[b.priority] || 10;
                
                // Confidence scoring
                scoreA += (a.confidence || 50) / 4;
                scoreB += (b.confidence || 50) / 4;
                
                return scoreB - scoreA;
            });
        }
        
        function ensureVariety(tasks) {
            const categorySeen = {};
            const diverseTasks = [];
            
            tasks.forEach(task => {
                if (!categorySeen[task.category] || diverseTasks.length < 4) {
                    diverseTasks.push(task);
                    categorySeen[task.category] = true;
                }
            });
            
            const remaining = tasks.filter(task => !diverseTasks.includes(task));
            return [...diverseTasks, ...remaining].slice(0, 8);
        }
        
        function regenerateAITasks() {
            document.querySelector('.fixed')?.remove();
            generateAdvancedAITasks();
        }
        
        function showAISettings() {
            showFloatingNotification('‚öôÔ∏è AI Settings', 'Advanced AI customization coming in next update!');
        }
        
        function customizeAITask(taskId) {
            showFloatingNotification('‚öôÔ∏è Task Customization', 'Personalization options coming soon!');
        }
        
        function skipAITask(taskId) {
            const skippedTasks = JSON.parse(localStorage.getItem('aiSkippedTasks') || '[]');
            skippedTasks.push({ id: taskId, timestamp: Date.now() });
            localStorage.setItem('aiSkippedTasks', JSON.stringify(skippedTasks.slice(-50)));
            showFloatingNotification('‚è≠Ô∏è Task Skipped', 'AI will learn from your preferences');
        }

        function adoptAITask(text, category, xp, icon, reasoning, difficulty) {
            const task = {
                id: Date.now() + Math.random(),
                text: text,
                category: category,
                xp: xp,
                completed: false,
                icon: icon,
                aiGenerated: true,
                aiReasoning: reasoning,
                difficulty: difficulty || 'medium',
                createdAt: new Date().toISOString()
            };
            
            gameState.tasks.push(task);
            updateTasksList();
            updateTasksListDetailed();
            saveGameState();
            
            awardXP(15, 'Adopted AI-generated task!');
            showFloatingNotification('üß† AI Task Added!', 'Smart choice! This task is optimized for your current state.');
            
            // Track adoption for learning
            const adoptedTasks = JSON.parse(localStorage.getItem('aiAdoptedTasks') || '[]');
            adoptedTasks.push({ category, difficulty, timestamp: Date.now() });
            localStorage.setItem('aiAdoptedTasks', JSON.stringify(adoptedTasks.slice(-100)));
            
            document.querySelector('.fixed')?.remove();
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
