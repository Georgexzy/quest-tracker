<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Life Quest RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        fitness: '#ef4444',
                        nutrition: '#16a34a',
                        hydration: '#3b82f6',
                        wellness: '#a855f7',
                        focus: '#f59e0b',
                        personal: '#6366f1'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .floating-notification {
            animation: slideInRight 0.5s ease-out, slideOutRight 0.5s ease-in 2.5s forwards;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        .xp-burst {
            animation: xpBurst 2s ease-out forwards;
        }
        @keyframes xpBurst {
            0% { transform: scale(1) translateY(0); opacity: 1; }
            50% { transform: scale(1.2) translateY(-20px); opacity: 1; }
            100% { transform: scale(1) translateY(-60px); opacity: 0; }
        }
        .level-up {
            animation: levelUp 1s ease-out;
        }
        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-bottom: 2px solid #ffffff;
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">
    
    <div class="min-h-screen">
        <!-- Header -->
        <header class="gradient-bg text-white p-4 shadow-lg">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold">üèÜ Life Quest RPG</h1>
                        <span class="text-sm opacity-90">Ultimate AI Edition</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showStorageInfo()" class="glass-effect px-3 py-1 rounded-lg text-sm hover:bg-white/20">
                            üíæ Storage
                        </button>
                        <button onclick="showProfile()" class="glass-effect px-3 py-1 rounded-lg text-sm hover:bg-white/20">
                            ‚öôÔ∏è Profile
                        </button>
                        <div class="text-right">
                            <div id="playerLevel" class="font-bold">Level 1</div>
                            <div class="text-xs opacity-90">
                                <span id="currentXP">0</span>/<span id="nextLevelXP">100</span> XP
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- XP Progress Bar -->
                <div class="mt-3">
                    <div class="bg-white/20 rounded-full h-2">
                        <div id="xpProgress" class="bg-yellow-400 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="gradient-bg border-b border-white/20">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex space-x-6 overflow-x-auto">
                    <button onclick="switchTab('dashboard')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap active">
                        üìä Dashboard
                    </button>
                    <button onclick="switchTab('exercise')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üí™ Exercise
                    </button>
                    <button onclick="switchTab('health')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üèÉ‚Äç‚ôÇÔ∏è Health
                    </button>
                    <button onclick="switchTab('ai')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üß† AI Coach
                    </button>
                    <button onclick="switchTab('tasks')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        üìã Tasks
                    </button>
                    <button onclick="switchTab('settings')" class="tab-button px-4 py-3 text-white/80 hover:text-white font-medium whitespace-nowrap">
                        ‚öôÔ∏è Settings
                    </button>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto p-4">
            <!-- AI Insights (visible on all tabs) -->
            <div id="aiInsights" class="mb-6"></div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-fitness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-fitness">üèÉ‚Äç‚ôÇÔ∏è</span>
                            <span id="stepsCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Steps</div>
                        <div class="text-xs text-fitness">Goal: 8,000</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-hydration/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-hydration">üíß</span>
                            <span id="waterCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Water</div>
                        <div class="text-xs text-hydration">Goal: 8 glasses</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-nutrition/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-nutrition">ü•ó</span>
                            <span id="caloriesCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Calories</div>
                        <div class="text-xs text-nutrition">Target: 2000</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-focus/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-focus">üß†</span>
                            <span id="focusCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Focus (min)</div>
                        <div class="text-xs text-focus">Goal: 120</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-wellness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-wellness">üò¥</span>
                            <span id="sleepCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Sleep (hrs)</div>
                        <div class="text-xs text-wellness">Goal: 8</div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border border-fitness/20">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-fitness">üí™</span>
                            <span id="workoutCount" class="text-2xl font-bold">0</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Workouts</div>
                        <div class="text-xs text-fitness">Goal: 1</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">üìã Today's Quests</h3>
                        <div id="tasksList" class="space-y-2 max-h-64 overflow-y-auto mb-4">
                            <!-- Tasks will be populated here -->
                        </div>
                        <button onclick="addCustomTask()" class="w-full bg-personal text-white py-2 rounded hover:bg-indigo-600">
                            ‚ûï Add Custom Quest
                        </button>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">üèÜ Recent Achievements</h3>
                        <div id="achievementsList" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Achievements will be populated here -->
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4">‚ö° Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="trackWater()" class="bg-hydration text-white p-3 rounded-lg hover:bg-blue-600 text-sm">
                                üíß Water
                            </button>
                            <button onclick="logWorkout()" class="bg-fitness text-white p-3 rounded-lg hover:bg-red-600 text-sm">
                                üí™ Workout
                            </button>
                            <button onclick="logMeal()" class="bg-nutrition text-white p-3 rounded-lg hover:bg-green-600 text-sm">
                                ü•ó Meal
                            </button>
                            <button onclick="startPomodoro()" class="bg-focus text-white p-3 rounded-lg hover:bg-yellow-600 text-sm">
                                üçÖ Focus
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exercise Tab -->
            <div id="exercise-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Daily Steps Tracker -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-orange-500">üö∂‚Äç‚ôÇÔ∏è Daily Steps</h3>
                            
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <div class="text-3xl font-bold text-orange-500" id="exerciseSteps">0</div>
                                        <div class="text-sm text-gray-500">Today's Steps</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-gray-700 dark:text-gray-300" id="stepGoal">8,000</div>
                                        <div class="text-xs text-gray-500">Daily Goal</div>
                                    </div>
                                </div>
                                
                                <!-- Steps Progress Bar -->
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-3">
                                    <div id="stepsProgress" class="bg-orange-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                
                                <div class="text-xs text-center text-gray-600 dark:text-gray-400" id="stepsStatus">
                                    Start walking to reach your goal!
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="quickLogSteps()" class="bg-orange-500 text-white py-3 px-4 rounded-lg hover:bg-orange-600 font-medium">
                                    üìù Log Steps
                                </button>
                                <button onclick="adjustStepGoal()" class="bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 font-medium">
                                    üéØ Set Goal
                                </button>
                            </div>
                            
                            <div class="mt-4 text-center">
                                <div class="text-xs text-purple-600 dark:text-purple-400" id="stepInsight">
                                    <!-- AI insight about steps will appear here -->
                                </div>
                            </div>
                        </div>

                        <!-- Today's Exercise Progress -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-fitness">üí™ Today's Exercise</h3>
                            
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-fitness" id="exerciseWorkouts">0</div>
                                    <div class="text-sm text-gray-500">Workouts</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-500" id="exerciseCalories">0</div>
                                    <div class="text-sm text-gray-500">Calories</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-500" id="exerciseMinutes">0</div>
                                    <div class="text-sm text-gray-500">Minutes</div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <button onclick="quickStartWorkout('cardio')" class="w-full text-left px-4 py-3 bg-red-50 dark:bg-red-900/30 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/50 border border-red-200 dark:border-red-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üèÉ‚Äç‚ôÇÔ∏è</span>
                                            <div>
                                                <div class="font-medium">Cardio Blast</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">15-30 min high intensity</div>
                                            </div>
                                        </div>
                                        <div class="text-red-600 font-bold">START</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickStartWorkout('strength')" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50 border border-blue-200 dark:border-blue-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üí™</span>
                                            <div>
                                                <div class="font-medium">Strength Training</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">20-45 min muscle building</div>
                                            </div>
                                        </div>
                                        <div class="text-blue-600 font-bold">START</div>
                                    </div>
                                </button>
                                
                                <button onclick="quickStartWorkout('yoga')" class="w-full text-left px-4 py-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50 border border-purple-200 dark:border-purple-800">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üßò‚Äç‚ôÄÔ∏è</span>
                                            <div>
                                                <div class="font-medium">Yoga & Flexibility</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">15-30 min stretching</div>
                                            </div>
                                        </div>
                                        <div class="text-purple-600 font-bold">START</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Exercise Library -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìö Exercise Library</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="showExerciseCategory('bodyweight')" class="bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600 text-sm">
                                    ü§∏‚Äç‚ôÇÔ∏è Bodyweight
                                </button>
                                <button onclick="showExerciseCategory('weights')" class="bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 text-sm">
                                    üèãÔ∏è‚Äç‚ôÇÔ∏è Weights
                                </button>
                                <button onclick="showExerciseCategory('cardio')" class="bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 text-sm">
                                    üèÉ‚Äç‚ôÇÔ∏è Cardio
                                </button>
                                <button onclick="showExerciseCategory('flexibility')" class="bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 text-sm">
                                    ü§∏‚Äç‚ôÄÔ∏è Flexibility
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Weekly Exercise Plan -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìÖ Weekly Plan</h3>
                            <div id="weeklyExercisePlan" class="space-y-3">
                                <!-- Weekly plan will be populated here -->
                            </div>
                            <button onclick="generateWeeklyPlan()" class="w-full mt-4 bg-primary text-white py-2 rounded hover:bg-purple-600">
                                üîÑ Generate New Plan
                            </button>
                        </div>

                        <!-- Exercise Streaks & Goals -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üî• Streaks & Goals</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üî•</span>
                                        <div>
                                            <div class="font-medium">Workout Streak</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Current streak</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-red-600" id="workoutStreak">0</div>
                                        <div class="text-xs text-red-500">days</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üéØ</span>
                                        <div>
                                            <div class="font-medium">Weekly Goal</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">Workouts this week</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-blue-600" id="weeklyProgress">0/5</div>
                                        <div class="text-xs text-blue-500">goal</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-xl">üí™</span>
                                        <div>
                                            <div class="font-medium">Total Minutes</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">This week</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold text-green-600" id="totalMinutes">0</div>
                                        <div class="text-xs text-green-500">min</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Tab -->
            <div id="health-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <!-- Apple Health Integration -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üì±</span>
                                <div>
                                    <h3 class="text-xl font-bold">Apple Health</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Sync your health data automatically</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="showAppleHealthSetup()" class="w-full text-left px-4 py-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/50">
                                    <div class="font-medium">‚öôÔ∏è Setup Auto-Sync</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Configure iOS shortcuts</div>
                                </button>
                                <button onclick="importHealthData()" class="w-full text-left px-4 py-3 bg-green-50 dark:bg-green-900/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50">
                                    <div class="font-medium">üì• Import Data</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Manual import options</div>
                                </button>
                                <button onclick="showHealthStatus()" class="w-full text-left px-4 py-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50">
                                    <div class="font-medium">üìä Sync Status</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">View connection status</div>
                                </button>
                            </div>
                        </div>

                        <!-- Manual Logging -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìù Manual Logging</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="logSteps()" class="bg-orange-500 text-white p-3 rounded-lg hover:bg-orange-600">
                                    üö∂‚Äç‚ôÇÔ∏è Steps
                                </button>
                                <button onclick="logWorkout()" class="bg-fitness text-white p-3 rounded-lg hover:bg-red-600">
                                    üí™ Workout
                                </button>
                                <button onclick="logSleep()" class="bg-wellness text-white p-3 rounded-lg hover:bg-purple-600">
                                    üò¥ Sleep
                                </button>
                                <button onclick="logMeal()" class="bg-nutrition text-white p-3 rounded-lg hover:bg-green-600">
                                    ü•ó Meal
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <!-- Health Progress -->
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üìä Health Progress</h3>
                            <div id="healthProgressContainer" class="space-y-4">
                                <!-- Health progress will be populated here -->
                            </div>
                            <button onclick="showHabitTracker()" class="w-full mt-4 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-2 rounded hover:bg-gray-200 dark:hover:bg-gray-600">
                                View Detailed Tracker
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Coach Tab -->
            <div id="ai-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üß†</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Nutrition Coach</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Personalized meal recommendations</p>
                                </div>
                            </div>
                            <button onclick="generateAINutritionPlan()" class="w-full bg-nutrition text-white py-3 rounded-lg hover:bg-green-600">
                                üçΩÔ∏è Generate Nutrition Plan
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üí™</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Workout Coach</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Smart exercise recommendations</p>
                                </div>
                            </div>
                            <button onclick="generateAIWorkoutPlan()" class="w-full bg-fitness text-white py-3 rounded-lg hover:bg-red-600">
                                üèãÔ∏è‚Äç‚ôÇÔ∏è Generate Workout Plan
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center space-x-3 mb-4">
                                <span class="text-3xl">üéØ</span>
                                <div>
                                    <h3 class="text-xl font-bold">AI Task Generator</h3>
                                    <p class="text-gray-600 dark:text-gray-400 text-sm">Context-aware task suggestions</p>
                                </div>
                            </div>
                            <button onclick="generateAdvancedAITasks()" class="w-full bg-personal text-white py-3 rounded-lg hover:bg-indigo-600">
                                ‚ú® Generate Smart Tasks
                            </button>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg h-full">
                            <h3 class="text-xl font-bold mb-4">ü§ñ AI Insights</h3>
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/30 dark:to-blue-900/30 p-4 rounded-lg">
                                    <h4 class="font-bold mb-2">How AI Coaching Works</h4>
                                    <ul class="text-sm space-y-2 text-gray-600 dark:text-gray-400">
                                        <li>‚Ä¢ Analyzes your current stats and patterns</li>
                                        <li>‚Ä¢ Considers your goals and preferences</li>
                                        <li>‚Ä¢ Adapts to time of day and energy levels</li>
                                        <li>‚Ä¢ Provides personalized recommendations</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-lg">
                                    <h4 class="font-bold mb-2">AI Features</h4>
                                    <ul class="text-sm space-y-2 text-gray-600 dark:text-gray-400">
                                        <li>‚Ä¢ Smart meal planning with macro tracking</li>
                                        <li>‚Ä¢ Adaptive workout routines</li>
                                        <li>‚Ä¢ Context-aware task generation</li>
                                        <li>‚Ä¢ Pattern recognition and insights</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Tab -->
            <div id="tasks-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold">üìã Today's Quests</h3>
                                <button onclick="generateDailyTasks()" class="text-primary hover:text-purple-600 text-sm">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div id="tasksListDetailed" class="space-y-2 max-h-96 overflow-y-auto mb-4">
                                <!-- Tasks will be populated here -->
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="addCustomTask()" class="flex-1 bg-personal text-white py-2 rounded hover:bg-indigo-600">
                                    ‚ûï Add Custom Quest
                                </button>
                                <button onclick="generateAdvancedAITasks()" class="flex-1 bg-purple-500 text-white py-2 rounded hover:bg-purple-600">
                                    üß† AI Tasks
                                </button>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üéØ Productivity Tools</h3>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="startPomodoro()" class="w-full text-left px-4 py-3 bg-orange-50 dark:bg-orange-900/30 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/50">
                                    <div class="font-medium">üçÖ Pomodoro Timer</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">25-minute focus sessions</div>
                                </button>
                                <button onclick="showHabitTracker()" class="w-full text-left px-4 py-3 bg-green-50 dark:bg-green-900/30 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50">
                                    <div class="font-medium">üìä Habit Tracker</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Track your daily habits</div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üèÜ Achievements</h3>
                            <div id="achievementsListDetailed" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Achievements will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üë§ Profile</h3>
                            <button onclick="showProfile()" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-purple-600">
                                Edit Profile Settings
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üîî Notifications</h3>
                            <button onclick="showNotificationSettings()" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600">
                                Manage Reminders
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4">üíæ Data</h3>
                            <button onclick="showStorageInfo()" class="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Storage Information
                            </button>
                        </div>
                    </div>

                    <div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg h-full">
                            <h3 class="text-xl font-bold mb-4">üìä Statistics</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-blue-600" id="settingsLevel">1</div>
                                    <div class="text-sm text-blue-500">Current Level</div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-green-600" id="settingsTotalXP">0</div>
                                    <div class="text-sm text-green-500">Total XP</div>
                                </div>
                                <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-purple-600" id="settingsAchievements">0</div>
                                    <div class="text-sm text-purple-500">Achievements</div>
                                </div>
                                <div class="bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-orange-600" id="settingsTasks">0</div>
                                    <div class="text-sm text-orange-500">Total Tasks</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Notifications Container -->
    <div id="notificationsContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <script>
        // üéÆ GAME STATE MANAGEMENT
        let gameState = {
            level: 1,
            xp: 0,
            totalXP: 0,
            dailyStats: {
                steps: 0,
                waterGlasses: 0,
                calories: 0,
                protein: 0,
                carbs: 0,
                fat: 0,
                meals: 0,
                focusMinutes: 0,
                sleepHours: 0,
                workouts: 0,
                caloriesBurned: 0,
                exerciseMinutes: 0
            },
            tasks: [],
            achievements: [],
            profile: {
                age: null,
                weight: null,
                height: null,
                activityLevel: 'moderate',
                fitnessGoal: 'maintain',
                bmr: null
            },
            streaks: {
                workout: 0,
                water: 0,
                sleep: 0
            },
            exercise: {
                weeklyPlan: [],
                preferences: {
                    favoriteTypes: ['cardio', 'strength'],
                    timePreference: 'morning',
                    difficulty: 'intermediate'
                },
                history: []
            },
            settings: {
                notifications: true,
                darkMode: 'auto',
                reminders: false,
                reminderTimes: {
                    water: ['09:00', '12:00', '15:00', '18:00'],
                    workout: ['07:00', '17:00'],
                    tasks: ['09:00', '14:00'],
                    sleep: ['22:00']
                }
            }
        };

        // üéØ INITIALIZATION
        function initializeApp() {
            // Apply dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });

            loadGameState();
            updateAllUI();
            generateDailyTasks();
            generateWeeklyExercisePlan();
            showAIInsights();
            
            // Auto-save every 30 seconds
            setInterval(saveGameState, 30000);
            
            console.log('üéÆ Life Quest RPG - Ultimate AI Edition Initialized!');
            
            // Check for health data on load
            checkForHealthData();
        }

        // üíæ STORAGE MANAGEMENT
        function saveGameState() {
            try {
                const serializedState = JSON.stringify(gameState);
                localStorage.setItem('lifeQuestRPG', serializedState);
                localStorage.setItem('lifeQuestRPG_lastSave', new Date().toISOString());
                console.log('‚úÖ Game state saved successfully');
            } catch (error) {
                console.error('‚ùå Failed to save game state:', error);
                showFloatingNotification('‚ö†Ô∏è Save Error', 'Unable to save progress');
            }
        }

        function loadGameState() {
            try {
                const savedState = localStorage.getItem('lifeQuestRPG');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    gameState = { ...gameState, ...parsedState };
                    console.log('‚úÖ Game state loaded successfully');
                    showFloatingNotification('üíæ Progress Loaded', 'Your data has been restored');
                } else {
                    console.log('üì± No saved data found, starting fresh');
                }
            } catch (error) {
                console.error('‚ùå Failed to load game state:', error);
                console.log('üÜï Using default game state');
            }
        }

        function showStorageInfo() {
            const stateSize = JSON.stringify(gameState).length;
            const approximateMemoryUsage = stateSize * 2;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üíæ Storage Information</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-bold mb-2">üìä Current Usage</h4>
                            <div class="text-sm space-y-1">
                                <div>Game State Size: <span class="font-mono">${(stateSize/1024).toFixed(2)} KB</span></div>
                                <div>Memory Usage: <span class="font-mono">${(approximateMemoryUsage/1024).toFixed(2)} KB</span></div>
                                <div>Tasks Count: <span class="font-mono">${gameState.tasks.length}</span></div>
                                <div>Achievements: <span class="font-mono">${gameState.achievements.length}</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                            <h4 class="font-bold mb-2 text-blue-700 dark:text-blue-300">üí° Data Persistence</h4>
                            <div class="text-sm text-blue-600 dark:text-blue-400 space-y-1">
                                <p>‚Ä¢ All progress saved automatically</p>
                                <p>‚Ä¢ Data persists across browser sessions</p>
                                <p>‚Ä¢ No internet required for saving</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="exportData()" class="flex-1 bg-green-500 text-white py-2 rounded hover:bg-green-600">
                                üì§ Export
                            </button>
                            <button onclick="importData()" class="flex-1 bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
                                üì• Import
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function exportData() {
            const dataStr = JSON.stringify(gameState, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `lifequest-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showFloatingNotification('üì§ Data Exported', 'Backup file downloaded successfully');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            gameState = { ...gameState, ...importedData };
                            saveGameState();
                            updateAllUI();
                            showFloatingNotification('üì• Data Imported', 'Your backup has been restored');
                            document.querySelector('.fixed')?.remove();
                        } catch (error) {
                            showFloatingNotification('‚ùå Import Failed', 'Invalid backup file');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // üö∂‚Äç‚ôÇÔ∏è STEPS SYSTEM
        function quickLogSteps() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4 text-orange-500">üö∂‚Äç‚ôÇÔ∏è Log Today's Steps</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Step Count</label>
                            <input type="number" id="quickStepsInput" placeholder="Enter your steps..." min="0" max="50000" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        
                        <!-- Quick buttons for common step counts -->
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setQuickSteps(5000)" class="bg-gray-100 dark:bg-gray-700 p-2 rounded text-sm hover:bg-gray-200 dark:hover:bg-gray-600">
                                5,000
                            </button>
                            <button onclick="setQuickSteps(8000)" class="bg-orange-100 dark:bg-orange-900/30 p-2 rounded text-sm hover:bg-orange-200 dark:hover:bg-orange-900/50">
                                8,000
                            </button>
                            <button onclick="setQuickSteps(10000)" class="bg-green-100 dark:bg-green-900/30 p-2 rounded text-sm hover:bg-green-200 dark:hover:bg-green-900/50">
                                10,000
                            </button>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveQuickSteps()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600">
                                Log Steps
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function setQuickSteps(steps) {
            document.getElementById('quickStepsInput').value = steps;
        }

        function saveQuickSteps() {
            const steps = parseInt(document.getElementById('quickStepsInput').value) || 0;

            if (steps > 0) {
                gameState.dailyStats.steps = steps;
                updateStepsDisplay();
                updateAllUI();
                saveGameState();
                
                const xpAmount = Math.floor(steps / 100);
                awardXP(xpAmount, `${steps.toLocaleString()} steps logged! üö∂‚Äç‚ôÇÔ∏è`);

                // Check for step-based achievements
                checkStepAchievements(steps);

                document.querySelector('.fixed').remove();
                showFloatingNotification('üö∂‚Äç‚ôÇÔ∏è Steps Logged!', `${steps.toLocaleString()} steps added`);
                
                // Update step insight
                updateStepInsight(steps);
            } else {
                showFloatingNotification('‚ùå Invalid Input', 'Please enter a valid step count');
            }
        }

        function adjustStepGoal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üéØ Set Daily Step Goal</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Daily Step Goal</label>
                            <input type="number" id="stepGoalInput" value="${gameState.profile.stepGoal || 8000}" min="1000" max="30000" step="500" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        
                        <!-- Preset goals -->
                        <div class="space-y-2">
                            <div class="text-sm font-medium text-gray-700 dark:text-gray-300">Popular Goals:</div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setStepGoal(5000)" class="bg-blue-100 dark:bg-blue-900/30 p-2 rounded text-sm hover:bg-blue-200 dark:hover:bg-blue-900/50">
                                    5,000 (Beginner)
                                </button>
                                <button onclick="setStepGoal(8000)" class="bg-orange-100 dark:bg-orange-900/30 p-2 rounded text-sm hover:bg-orange-200 dark:hover:bg-orange-900/50">
                                    8,000 (Moderate)
                                </button>
                                <button onclick="setStepGoal(10000)" class="bg-green-100 dark:bg-green-900/30 p-2 rounded text-sm hover:bg-green-200 dark:hover:bg-green-900/50">
                                    10,000 (Active)
                                </button>
                                <button onclick="setStepGoal(12000)" class="bg-purple-100 dark:bg-purple-900/30 p-2 rounded text-sm hover:bg-purple-200 dark:hover:bg-purple-900/50">
                                    12,000 (Athlete)
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveStepGoal()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600">
                                Save Goal
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function setStepGoal(goal) {
            document.getElementById('stepGoalInput').value = goal;
        }

        function saveStepGoal() {
            const goal = parseInt(document.getElementById('stepGoalInput').value) || 8000;
            
            gameState.profile.stepGoal = goal;
            updateStepsDisplay();
            saveGameState();
            
            document.querySelector('.fixed').remove();
            showFloatingNotification('üéØ Goal Updated!', `Daily step goal set to ${goal.toLocaleString()}`);
            awardXP(10, 'Step goal customized!');
        }

        function updateStepsDisplay() {
            const steps = gameState.dailyStats.steps;
            const goal = gameState.profile.stepGoal || 8000;
            const progress = Math.min(100, (steps / goal) * 100);
            
            // Update steps counter
            const stepsElement = document.getElementById('exerciseSteps');
            if (stepsElement) stepsElement.textContent = steps.toLocaleString();
            
            // Update goal display
            const goalElement = document.getElementById('stepGoal');
            if (goalElement) goalElement.textContent = goal.toLocaleString();
            
            // Update progress bar
            const progressElement = document.getElementById('stepsProgress');
            if (progressElement) {
                progressElement.style.width = `${progress}%`;
                
                // Change color based on progress
                if (progress >= 100) {
                    progressElement.className = 'bg-green-500 h-full rounded-full transition-all duration-500';
                } else if (progress >= 75) {
                    progressElement.className = 'bg-orange-500 h-full rounded-full transition-all duration-500';
                } else if (progress >= 50) {
                    progressElement.className = 'bg-yellow-500 h-full rounded-full transition-all duration-500';
                } else {
                    progressElement.className = 'bg-gray-400 h-full rounded-full transition-all duration-500';
                }
            }
            
            // Update status text
            const statusElement = document.getElementById('stepsStatus');
            if (statusElement) {
                if (progress >= 100) {
                    statusElement.textContent = `üéâ Goal achieved! ${((steps - goal)).toLocaleString()} steps over goal!`;
                    statusElement.className = 'text-xs text-center text-green-600 dark:text-green-400';
                } else if (progress >= 75) {
                    const remaining = goal - steps;
                    statusElement.textContent = `üî• Almost there! Only ${remaining.toLocaleString()} steps to go!`;
                    statusElement.className = 'text-xs text-center text-orange-600 dark:text-orange-400';
                } else if (progress >= 50) {
                    const remaining = goal - steps;
                    statusElement.textContent = `üí™ Halfway there! ${remaining.toLocaleString()} steps remaining.`;
                    statusElement.className = 'text-xs text-center text-yellow-600 dark:text-yellow-400';
                } else if (steps > 0) {
                    const remaining = goal - steps;
                    statusElement.textContent = `üö∂‚Äç‚ôÇÔ∏è Good start! ${remaining.toLocaleString()} steps to reach your goal.`;
                    statusElement.className = 'text-xs text-center text-gray-600 dark:text-gray-400';
                } else {
                    statusElement.textContent = 'Start walking to reach your goal!';
                    statusElement.className = 'text-xs text-center text-gray-600 dark:text-gray-400';
                }
            }
        }

        function checkStepAchievements(steps) {
            const achievements = [];
            
            if (steps >= 5000 && !gameState.achievements.find(a => a.title.includes('5K Walker'))) {
                achievements.push(['üö∂‚Äç‚ôÇÔ∏è 5K Walker', 'Walked 5,000+ steps in a day!', 25]);
            }
            
            if (steps >= 8000 && !gameState.achievements.find(a => a.title.includes('Step Master'))) {
                achievements.push(['üéØ Step Master', 'Hit your 8,000 step daily goal!', 40]);
            }
            
            if (steps >= 10000 && !gameState.achievements.find(a => a.title.includes('10K Hero'))) {
                achievements.push(['üèÜ 10K Hero', 'Conquered the classic 10,000 steps!', 50]);
            }
            
            if (steps >= 15000 && !gameState.achievements.find(a => a.title.includes('Step Champion'))) {
                achievements.push(['üëë Step Champion', 'Amazing! 15,000+ steps in one day!', 75]);
            }
            
            if (steps >= 20000 && !gameState.achievements.find(a => a.title.includes('Walking Machine'))) {
                achievements.push(['ü§ñ Walking Machine', 'Incredible! 20,000+ steps!', 100]);
            }
            
            achievements.forEach(([title, desc, xp]) => {
                addAchievement(title, desc, xp);
            });
        }

        function updateStepInsight(steps) {
            const insightElement = document.getElementById('stepInsight');
            if (!insightElement) return;
            
            const goal = gameState.profile.stepGoal || 8000;
            const progress = (steps / goal) * 100;
            const hour = new Date().getHours();
            
            let insight = '';
            
            if (progress >= 100) {
                insight = 'üéâ Goal smashed! Consider increasing your daily target for even better health benefits.';
            } else if (progress >= 75) {
                insight = 'üî• You\'re crushing it today! A few more steps and you\'ll hit your goal!';
            } else if (progress >= 50) {
                insight = 'üí™ Solid progress! Try taking the stairs or a quick walk to boost your count.';
            } else if (hour > 18) {
                insight = 'üåÖ Tomorrow is a new day! Start early with a morning walk to build momentum.';
            } else if (hour > 12) {
                insight = '‚è∞ Afternoon energy dip? A quick walk can boost both steps and mood!';
            } else {
                insight = 'üåü Great time to get moving! Morning steps set the tone for an active day.';
            }
            
            insightElement.textContent = insight;
        }

        // üí™ EXERCISE SYSTEM
        function quickStartWorkout(type) {
            const workouts = {
                cardio: {
                    name: 'Cardio Blast',
                    exercises: [
                        { name: 'Jumping Jacks', duration: 30, rest: 10 },
                        { name: 'High Knees', duration: 30, rest: 10 },
                        { name: 'Burpees', duration: 30, rest: 15 },
                        { name: 'Mountain Climbers', duration: 30, rest: 10 }
                    ],
                    estimatedCalories: 150,
                    color: 'red'
                },
                strength: {
                    name: 'Strength Training',
                    exercises: [
                        { name: 'Push-ups', reps: 10, rest: 30 },
                        { name: 'Squats', reps: 15, rest: 30 },
                        { name: 'Lunges', reps: 12, rest: 30 },
                        { name: 'Plank Hold', duration: 30, rest: 30 }
                    ],
                    estimatedCalories: 120,
                    color: 'blue'
                },
                yoga: {
                    name: 'Yoga & Flexibility',
                    exercises: [
                        { name: 'Cat-Cow Pose', duration: 60, rest: 5 },
                        { name: 'Downward Dog', duration: 45, rest: 5 },
                        { name: 'Warrior Pose', duration: 30, rest: 5 },
                        { name: 'Child\'s Pose', duration: 45, rest: 5 }
                    ],
                    estimatedCalories: 80,
                    color: 'purple'
                }
            };
            
            const workout = workouts[type];
            if (workout) {
                startGuidedWorkout(workout);
            }
        }

        function startGuidedWorkout(workout) {
            let currentExercise = 0;
            let isResting = false;
            let timeRemaining = 0;
            let workoutTimer = null;
            let totalDuration = 0;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4 text-center text-fitness">üí™ ${workout.name}</h3>
                    
                    <!-- Progress -->
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span>Exercise ${currentExercise + 1} of ${workout.exercises.length}</span>
                            <span id="workoutStatus">Get Ready!</span>
                        </div>
                        <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="workoutProgress" class="bg-fitness h-full rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- Current Exercise -->
                    <div class="text-center mb-6">
                        <div class="text-6xl font-bold mb-4" id="workoutTimer">3</div>
                        <div class="text-xl font-bold mb-2" id="exerciseName">Get Ready</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400" id="exerciseDetails"></div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="flex space-x-3">
                        <button id="workoutPause" onclick="pauseWorkout()" class="flex-1 bg-yellow-500 text-white py-3 rounded-lg">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button onclick="skipExercise()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg">
                            ‚è≠Ô∏è Skip
                        </button>
                        <button onclick="stopWorkout()" class="flex-1 bg-red-500 text-white py-3 rounded-lg">
                            ‚èπÔ∏è Stop
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Start countdown
            startCountdown();
            
            function startCountdown() {
                timeRemaining = 3;
                updateDisplay();
                
                workoutTimer = setInterval(() => {
                    timeRemaining--;
                    updateDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(workoutTimer);
                        startExercise();
                    }
                }, 1000);
            }
            
            function startExercise() {
                if (currentExercise >= workout.exercises.length) {
                    completeWorkout();
                    return;
                }
                
                const exercise = workout.exercises[currentExercise];
                isResting = false;
                timeRemaining = exercise.duration || (exercise.reps ? 45 : 30);
                totalDuration += timeRemaining;
                
                document.getElementById('exerciseName').textContent = exercise.name;
                document.getElementById('exerciseDetails').textContent = exercise.reps ? 
                    `${exercise.reps} reps` : `${exercise.duration} seconds`;
                document.getElementById('workoutStatus').textContent = 'Exercise';
                
                workoutTimer = setInterval(() => {
                    timeRemaining--;
                    updateDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(workoutTimer);
                        startRest();
                    }
                }, 1000);
            }
            
            function startRest() {
                const exercise = workout.exercises[currentExercise];
                isResting = true;
                timeRemaining = exercise.rest;
                
                document.getElementById('exerciseName').textContent = 'Rest';
                document.getElementById('exerciseDetails').textContent = 'Take a breather';
                document.getElementById('workoutStatus').textContent = 'Rest';
                
                workoutTimer = setInterval(() => {
                    timeRemaining--;
                    updateDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(workoutTimer);
                        currentExercise++;
                        updateProgress();
                        startExercise();
                    }
                }, 1000);
            }
            
            function updateDisplay() {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                document.getElementById('workoutTimer').textContent = 
                    minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : seconds;
            }
            
            function updateProgress() {
                const progress = (currentExercise / workout.exercises.length) * 100;
                document.getElementById('workoutProgress').style.width = `${progress}%`;
            }
            
            function completeWorkout() {
                clearInterval(workoutTimer);
                
                // Update stats
                gameState.dailyStats.workouts++;
                gameState.dailyStats.caloriesBurned += workout.estimatedCalories;
                gameState.dailyStats.exerciseMinutes += Math.floor(totalDuration / 60);
                
                // Add to exercise history
                gameState.exercise.history.push({
                    name: workout.name,
                    date: new Date().toISOString(),
                    duration: Math.floor(totalDuration / 60),
                    calories: workout.estimatedCalories,
                    type: workout.name.toLowerCase().includes('cardio') ? 'cardio' : 
                          workout.name.toLowerCase().includes('strength') ? 'strength' : 'flexibility'
                });
                
                updateAllUI();
                saveGameState();
                awardXP(workout.estimatedCalories + 50, `${workout.name} completed! üí™`);
                
                // Show completion
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4 text-center">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h3 class="text-xl font-bold mb-2">Workout Complete!</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">${workout.name}</p>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-fitness">${Math.floor(totalDuration / 60)}</div>
                                    <div class="text-sm text-gray-500">Minutes</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-orange-500">${workout.estimatedCalories}</div>
                                    <div class="text-sm text-gray-500">Calories</div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-fitness text-white py-3 rounded-lg">
                            Amazing Work! üöÄ
                        </button>
                    </div>
                `;
            }
            
            // Global functions for workout controls
            window.pauseWorkout = function() {
                clearInterval(workoutTimer);
                document.getElementById('workoutPause').textContent = '‚ñ∂Ô∏è Resume';
                document.getElementById('workoutPause').onclick = () => {
                    if (isResting) startRest(); else startExercise();
                    document.getElementById('workoutPause').textContent = '‚è∏Ô∏è Pause';
                    document.getElementById('workoutPause').onclick = pauseWorkout;
                };
            };
            
            window.skipExercise = function() {
                clearInterval(workoutTimer);
                currentExercise++;
                updateProgress();
                if (currentExercise >= workout.exercises.length) {
                    completeWorkout();
                } else {
                    startExercise();
                }
            };
            
            window.stopWorkout = function() {
                clearInterval(workoutTimer);
                modal.remove();
                showFloatingNotification('Workout Stopped', 'Every step counts! Keep moving forward!');
            };
        }

        function showExerciseCategory(category) {
            const exercises = {
                bodyweight: [
                    { name: 'Push-ups', muscle: 'Chest, Arms', difficulty: 'Beginner' },
                    { name: 'Squats', muscle: 'Legs, Glutes', difficulty: 'Beginner' },
                    { name: 'Burpees', muscle: 'Full Body', difficulty: 'Advanced' },
                    { name: 'Lunges', muscle: 'Legs', difficulty: 'Intermediate' },
                    { name: 'Plank', muscle: 'Core', difficulty: 'Beginner' },
                    { name: 'Jump Squats', muscle: 'Legs, Cardio', difficulty: 'Intermediate' }
                ],
                weights: [
                    { name: 'Dumbbell Rows', muscle: 'Back', difficulty: 'Intermediate' },
                    { name: 'Goblet Squats', muscle: 'Legs', difficulty: 'Beginner' },
                    { name: 'Overhead Press', muscle: 'Shoulders', difficulty: 'Intermediate' },
                    { name: 'Deadlifts', muscle: 'Full Body', difficulty: 'Advanced' },
                    { name: 'Bicep Curls', muscle: 'Arms', difficulty: 'Beginner' },
                    { name: 'Chest Press', muscle: 'Chest', difficulty: 'Intermediate' }
                ],
                cardio: [
                    { name: 'Jumping Jacks', muscle: 'Full Body', difficulty: 'Beginner' },
                    { name: 'High Knees', muscle: 'Legs, Core', difficulty: 'Beginner' },
                    { name: 'Mountain Climbers', muscle: 'Core, Arms', difficulty: 'Intermediate' },
                    { name: 'Sprint Intervals', muscle: 'Legs, Cardio', difficulty: 'Advanced' },
                    { name: 'Step-ups', muscle: 'Legs', difficulty: 'Beginner' },
                    { name: 'Box Jumps', muscle: 'Legs, Power', difficulty: 'Advanced' }
                ],
                flexibility: [
                    { name: 'Cat-Cow Stretch', muscle: 'Spine', difficulty: 'Beginner' },
                    { name: 'Hip Flexor Stretch', muscle: 'Hips', difficulty: 'Beginner' },
                    { name: 'Shoulder Rolls', muscle: 'Shoulders', difficulty: 'Beginner' },
                    { name: 'Hamstring Stretch', muscle: 'Legs', difficulty: 'Beginner' },
                    { name: 'Pigeon Pose', muscle: 'Hips', difficulty: 'Intermediate' },
                    { name: 'Spinal Twist', muscle: 'Spine', difficulty: 'Beginner' }
                ]
            };
            
            const categoryEmojis = {
                bodyweight: 'ü§∏‚Äç‚ôÇÔ∏è',
                weights: 'üèãÔ∏è‚Äç‚ôÇÔ∏è',
                cardio: 'üèÉ‚Äç‚ôÇÔ∏è',
                flexibility: 'ü§∏‚Äç‚ôÄÔ∏è'
            };
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center">${categoryEmojis[category]} ${category.charAt(0).toUpperCase() + category.slice(1)} Exercises</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${exercises[category].map(exercise => `
                            <div class="border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <div class="font-bold mb-2">${exercise.name}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                                    Target: ${exercise.muscle}
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs px-2 py-1 rounded ${
                                        exercise.difficulty === 'Beginner' ? 'bg-green-100 text-green-800' :
                                        exercise.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-800' :
                                        'bg-red-100 text-red-800'
                                    }">${exercise.difficulty}</span>
                                    <button onclick="addExerciseToWorkout('${exercise.name}')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                                        Add to Workout
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex justify-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function addExerciseToWorkout(exerciseName) {
            showFloatingNotification('üí™ Exercise Added!', `${exerciseName} added to your custom workout`);
            // In a full implementation, this would add to a custom workout builder
        }

        function generateWeeklyPlan() {
            const plans = [
                { day: 'Monday', workout: 'Full Body Strength', icon: 'üí™', duration: '30 min' },
                { day: 'Tuesday', workout: 'Cardio Blast', icon: 'üèÉ‚Äç‚ôÇÔ∏è', duration: '25 min' },
                { day: 'Wednesday', workout: 'Yoga & Flexibility', icon: 'üßò‚Äç‚ôÄÔ∏è', duration: '20 min' },
                { day: 'Thursday', workout: 'Upper Body Focus', icon: 'üí™', duration: '35 min' },
                { day: 'Friday', workout: 'HIIT Training', icon: 'üî•', duration: '20 min' },
                { day: 'Saturday', workout: 'Active Recovery', icon: 'üö∂‚Äç‚ôÇÔ∏è', duration: '15 min' },
                { day: 'Sunday', workout: 'Rest Day', icon: 'üò¥', duration: 'Rest' }
            ];
            
            gameState.exercise.weeklyPlan = plans;
            saveGameState();
            updateWeeklyPlan();
            showFloatingNotification('üìÖ Plan Generated!', 'Your weekly exercise plan is ready');
        }

        function generateWeeklyExercisePlan() {
            if (gameState.exercise.weeklyPlan.length === 0) {
                generateWeeklyPlan();
            } else {
                updateWeeklyPlan();
            }
        }

        function updateWeeklyPlan() {
            const container = document.getElementById('weeklyExercisePlan');
            if (!container) return;
            
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const dayMap = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            container.innerHTML = gameState.exercise.weeklyPlan.map((plan, index) => {
                const isToday = dayMap[today] === plan.day;
                return `
                    <div class="flex items-center justify-between p-3 rounded-lg ${isToday ? 'bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800' : 'bg-gray-50 dark:bg-gray-700'}">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${plan.icon}</span>
                            <div>
                                <div class="font-medium ${isToday ? 'text-blue-700 dark:text-blue-300' : ''}">${plan.day}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">${plan.workout}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${plan.duration}</div>
                            ${isToday ? '<div class="text-xs text-blue-600">Today</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // üß† AI FEATURES - All original AI functions preserved
        function generateAINutritionPlan() {
            const profile = gameState.profile;
            const stats = gameState.dailyStats;
            const hour = new Date().getHours();
            
            const nutritionNeeds = calculateNutritionNeeds(profile);
            const mealPlan = generatePersonalizedMealPlan(nutritionNeeds, hour, stats);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center text-nutrition">üß† AI Nutrition Coach</h3>
                    
                    <!-- Personalized Needs -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600">${nutritionNeeds.calories}</div>
                            <div class="text-sm text-blue-500">Daily Calories</div>
                        </div>
                        <div class="bg-red-50 dark:bg-red-900/30 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-red-600">${nutritionNeeds.protein}g</div>
                            <div class="text-sm text-red-500">Protein</div>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-600">${nutritionNeeds.carbs}g</div>
                            <div class="text-sm text-yellow-500">Carbs</div>
                        </div>
                        <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600">${nutritionNeeds.fat}g</div>
                            <div class="text-sm text-green-500">Fat</div>
                        </div>
                    </div>
                    
                    <!-- AI Meal Suggestions -->
                    <div class="mb-6">
                        <h4 class="font-bold mb-3">üçΩÔ∏è Smart Meal Suggestions</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${mealPlan.map(meal => `
                                <div class="border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="font-bold">${meal.name}</div>
                                        <div class="text-sm bg-nutrition text-white px-2 py-1 rounded">${meal.calories} cal</div>
                                    </div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">${meal.description}</div>
                                    <div class="grid grid-cols-3 gap-2 text-xs">
                                        <div class="text-center">
                                            <div class="font-bold">${meal.protein}g</div>
                                            <div class="text-gray-500">Protein</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold">${meal.carbs}g</div>
                                            <div class="text-gray-500">Carbs</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold">${meal.fat}g</div>
                                            <div class="text-gray-500">Fat</div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="text-xs text-purple-600 dark:text-purple-400 mb-2">
                                            ${meal.aiReasoning}
                                        </div>
                                        <button onclick="adoptAIMeal('${meal.id}')" class="w-full bg-nutrition text-white py-2 rounded hover:bg-green-600 text-sm">
                                            Add to My Plan
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function calculateNutritionNeeds(profile) {
            let bmr = profile.bmr || 1800;
            const activityMultipliers = {
                'sedentary': 1.2,
                'light': 1.375,
                'moderate': 1.55,
                'very': 1.725
            };
            
            const tdee = bmr * (activityMultipliers[profile.activityLevel] || 1.4);
            let calories = tdee;
            
            if (profile.fitnessGoal === 'lose_weight') calories = tdee - 500;
            else if (profile.fitnessGoal === 'gain_weight') calories = tdee + 300;
            else if (profile.fitnessGoal === 'build_muscle') calories = tdee + 200;
            
            let proteinPercent = 0.25;
            let fatPercent = 0.25;
            let carbsPercent = 0.50;
            
            if (profile.fitnessGoal === 'build_muscle') {
                proteinPercent = 0.30;
                fatPercent = 0.25;
                carbsPercent = 0.45;
            } else if (profile.fitnessGoal === 'lose_weight') {
                proteinPercent = 0.35;
                fatPercent = 0.30;
                carbsPercent = 0.35;
            }
            
            return {
                calories: Math.round(calories),
                protein: Math.round((calories * proteinPercent) / 4),
                carbs: Math.round((calories * carbsPercent) / 4),
                fat: Math.round((calories * fatPercent) / 9)
            };
        }
        
        function generatePersonalizedMealPlan(needs, hour, stats) {
            const mealDatabase = [
                {
                    id: 'protein_oats',
                    name: 'Protein Power Oats',
                    type: 'breakfast',
                    calories: 380,
                    protein: 25,
                    carbs: 45,
                    fat: 8,
                    description: 'Oatmeal with protein powder, berries, and almond butter',
                    aiReasoning: 'High protein start for sustained energy and muscle recovery'
                },
                {
                    id: 'quinoa_bowl',
                    name: 'Recovery Quinoa Bowl',
                    type: 'lunch',
                    calories: 450,
                    protein: 20,
                    carbs: 55,
                    fat: 15,
                    description: 'Quinoa with grilled chicken, vegetables, and tahini',
                    aiReasoning: 'Complete protein and complex carbs for afternoon energy'
                },
                {
                    id: 'lean_stir_fry',
                    name: 'Lean Muscle Stir-Fry',
                    type: 'dinner',
                    calories: 380,
                    protein: 30,
                    carbs: 35,
                    fat: 12,
                    description: 'Lean beef with vegetables and brown rice',
                    aiReasoning: 'High protein for overnight muscle repair and growth'
                }
            ];
            
            let recommendedMeals = [];
            
            if (hour < 11) {
                recommendedMeals.push(...mealDatabase.filter(m => m.type === 'breakfast'));
            }
            if (hour >= 11 && hour < 16) {
                recommendedMeals.push(...mealDatabase.filter(m => m.type === 'lunch'));
            }
            if (hour >= 16) {
                recommendedMeals.push(...mealDatabase.filter(m => m.type === 'dinner'));
            }
            
            return recommendedMeals.slice(0, 3);
        }
        
        function adoptAIMeal(mealId) {
            const mealPlans = generatePersonalizedMealPlan(calculateNutritionNeeds(gameState.profile), new Date().getHours(), gameState.dailyStats);
            const meal = mealPlans.find(m => m.id === mealId);
            
            if (meal) {
                gameState.dailyStats.calories += meal.calories;
                gameState.dailyStats.protein = (gameState.dailyStats.protein || 0) + meal.protein;
                gameState.dailyStats.carbs = (gameState.dailyStats.carbs || 0) + meal.carbs;
                gameState.dailyStats.fat = (gameState.dailyStats.fat || 0) + meal.fat;
                gameState.dailyStats.meals++;
                
                updateAllUI();
                saveGameState();
                awardXP(25, 'Following AI nutrition advice!');
                showFloatingNotification('üß† AI Meal Added!', `${meal.name} logged successfully`);
            }
        }

        function generateAIWorkoutPlan() {
            const profile = gameState.profile;
            const stats = gameState.dailyStats;
            const workoutPlan = generatePersonalizedWorkout(profile, stats);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center text-fitness">üß† AI Workout Coach</h3>
                    
                    <div class="space-y-4">
                        ${workoutPlan.map(workout => `
                            <div class="border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-2xl">${workout.icon}</div>
                                        <div>
                                            <div class="font-bold">${workout.name}</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400">${workout.duration} min ‚Ä¢ ${workout.difficulty}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-fitness">${workout.calories} cal</div>
                                        <div class="text-xs text-gray-500">Estimated burn</div>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-purple-600 dark:text-purple-400 mb-3">
                                    üß† ${workout.aiReasoning}
                                </div>
                                
                                <button onclick="startAIWorkout('${workout.id}')" class="w-full bg-fitness text-white py-2 rounded-lg hover:bg-red-600">
                                    Start AI Workout
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex justify-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function generatePersonalizedWorkout(profile, stats) {
            return [
                {
                    id: 'hiit_beginner',
                    name: 'AI HIIT Starter',
                    icon: 'üî•',
                    duration: 15,
                    difficulty: 'Beginner',
                    calories: 150,
                    aiReasoning: 'Perfect for building cardiovascular base and introducing HIIT principles'
                },
                {
                    id: 'strength_functional',
                    name: 'AI Functional Strength',
                    icon: 'üí™',
                    duration: 25,
                    difficulty: 'Intermediate',
                    calories: 200,
                    aiReasoning: 'Builds real-world strength patterns for daily activities'
                }
            ];
        }
        
        function startAIWorkout(workoutId) {
            const workouts = generatePersonalizedWorkout(gameState.profile, gameState.dailyStats);
            const workout = workouts.find(w => w.id === workoutId);
            
            if (workout) {
                document.querySelector('.fixed').remove();
                showFloatingNotification('üß† AI Workout Started!', workout.name);
            }
        }

        function generateAdvancedAITasks() {
            const profile = gameState.profile;
            const stats = gameState.dailyStats;
            const hour = new Date().getHours();
            const dayOfWeek = new Date().getDay();
            
            const aiTasks = generateContextualTasks(profile, stats, hour, dayOfWeek);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center">üß† AI Task Generator</h3>
                    
                    <div class="space-y-4 mb-6">
                        ${aiTasks.map(task => `
                            <div class="border rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <div class="text-2xl">${task.icon}</div>
                                        <div>
                                            <div class="font-bold">${task.text}</div>
                                            <div class="text-sm text-gray-600 dark:text-gray-400 capitalize">${task.category} ‚Ä¢ ${task.xp} XP</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-purple-600 dark:text-purple-400 mb-3">
                                    üß† ${task.aiReasoning}
                                </div>
                                
                                <button onclick="adoptAITask('${task.text}', '${task.category}', ${task.xp}, '${task.icon}')" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 text-sm">
                                    ‚úÖ Add to My Tasks
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function generateContextualTasks(profile, stats, hour, dayOfWeek) {
            const tasks = [
                {
                    id: 'hydration_' + Date.now(),
                    text: 'Drink a glass of water',
                    category: 'hydration',
                    icon: 'üíß',
                    xp: 10,
                    aiReasoning: 'Hydration is fundamental to all body functions. A simple but powerful habit.'
                },
                {
                    id: 'movement_' + Date.now(),
                    text: 'Do 20 bodyweight squats',
                    category: 'fitness',
                    icon: 'üí™',
                    xp: 15,
                    aiReasoning: 'Quick movement breaks improve circulation and energy levels.'
                },
                {
                    id: 'mindfulness_' + Date.now(),
                    text: 'Take 10 deep breaths mindfully',
                    category: 'wellness',
                    icon: 'üßò‚Äç‚ôÇÔ∏è',
                    xp: 15,
                    aiReasoning: 'Mindful breathing reduces stress and increases present-moment awareness.'
                }
            ];
            
            return tasks;
        }
        
        function adoptAITask(text, category, xp, icon) {
            const task = {
                id: Date.now() + Math.random(),
                text: text,
                category: category,
                xp: xp,
                completed: false,
                icon: icon,
                aiGenerated: true,
                createdAt: new Date().toISOString()
            };
            
            gameState.tasks.push(task);
            updateTasksList();
            saveGameState();
            
            awardXP(10, 'Adopted AI task suggestion!');
            showFloatingNotification('üß† AI Task Added!', 'Smart choice! This task is optimized for your current state.');
            
            document.querySelector('.fixed')?.remove();
        }

        function generateSmartInsights() {
            const insights = [];
            const stats = gameState.dailyStats;
            
            if (stats.steps > 8000 && stats.focusMinutes > 60) {
                insights.push({
                    type: 'positive',
                    icon: 'üåü',
                    title: 'Peak Performance Day!',
                    message: 'Your combination of movement and focus is creating optimal productivity.',
                    action: 'Keep this balanced approach for sustained energy!'
                });
            }
            
            if (stats.waterGlasses < 4 && stats.focusMinutes < 30) {
                insights.push({
                    type: 'warning',
                    icon: '‚ö†Ô∏è',
                    title: 'Hydration & Focus Alert',
                    message: 'Low water intake may be affecting your concentration.',
                    action: 'Try drinking a glass of water before your next focus session.'
                });
            }
            
            return insights.length > 0 ? insights[0] : null;
        }

        function showAIInsights() {
            const insight = generateSmartInsights();
            const container = document.getElementById('aiInsights');
            
            if (insight) {
                const typeClasses = {
                    positive: 'bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800',
                    warning: 'bg-yellow-50 dark:bg-yellow-900/30 border-yellow-200 dark:border-yellow-800',
                    suggestion: 'bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800'
                };
                
                container.innerHTML = `
                    <div class="rounded-xl p-4 border ${typeClasses[insight.type]}">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">${insight.icon}</div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-900 dark:text-white mb-1">${insight.title}</h4>
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">${insight.message}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400 italic">${insight.action}</p>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">√ó</button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        // üìù TASK MANAGEMENT - All original functions preserved
        function generateDailyTasks() {
            const dailyTasks = [
                { text: "Drink 8 glasses of water", category: "hydration", xp: 40, icon: "üíß" },
                { text: "Take 8,000 steps", category: "fitness", xp: 50, icon: "üö∂‚Äç‚ôÇÔ∏è" },
                { text: "Eat 3 balanced meals", category: "nutrition", xp: 60, icon: "ü•ó" },
                { text: "Do a 30-minute workout", category: "fitness", xp: 100, icon: "üí™" },
                { text: "Focus work for 2+ hours", category: "personal", xp: 80, icon: "üß†" },
                { text: "Get 8 hours of sleep", category: "wellness", xp: 60, icon: "üò¥" }
            ];

            dailyTasks.forEach(task => {
                const exists = gameState.tasks.some(existingTask => existingTask.text === task.text);
                if (!exists) {
                    gameState.tasks.push({
                        id: Date.now() + Math.random(),
                        ...task,
                        completed: false,
                        createdAt: new Date().toISOString()
                    });
                }
            });

            updateTasksList();
            saveGameState();
        }

        function addCustomTask() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">‚ûï Add Custom Quest</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Quest Description</label>
                            <input type="text" id="taskText" placeholder="Enter your quest..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Category</label>
                                <select id="taskCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="fitness">üèÉ‚Äç‚ôÇÔ∏è Fitness</option>
                                    <option value="nutrition">ü•ó Nutrition</option>
                                    <option value="wellness">üßò‚Äç‚ôÄÔ∏è Wellness</option>
                                    <option value="personal">üìö Personal</option>
                                    <option value="hydration">üíß Hydration</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">XP Reward</label>
                                <input type="number" id="taskXP" value="25" min="10" max="100" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="createCustomTask()" class="flex-1 bg-primary text-white py-3 rounded-lg hover:bg-purple-600">
                                Create Quest
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function createCustomTask() {
            const text = document.getElementById('taskText').value.trim();
            const category = document.getElementById('taskCategory').value;
            const xp = parseInt(document.getElementById('taskXP').value);

            if (!text) {
                showFloatingNotification('‚ùå Error', 'Please enter a quest description');
                return;
            }

            const categoryIcons = {
                fitness: 'üèÉ‚Äç‚ôÇÔ∏è',
                nutrition: 'ü•ó',
                wellness: 'üßò‚Äç‚ôÄÔ∏è',
                personal: 'üìö',
                hydration: 'üíß'
            };

            const task = {
                id: Date.now() + Math.random(),
                text: text,
                category: category,
                xp: xp,
                icon: categoryIcons[category],
                completed: false,
                createdAt: new Date().toISOString()
            };

            gameState.tasks.push(task);
            updateTasksList();
            saveGameState();

            document.querySelector('.fixed').remove();
            showFloatingNotification('‚úÖ Quest Created!', `"${text}" added to your quests`);
        }

        function updateTasksList() {
            const container = document.getElementById('tasksList');
            if (!container) return;
            
            const todayTasks = gameState.tasks.filter(task => {
                const taskDate = new Date(task.createdAt).toDateString();
                const today = new Date().toDateString();
                return taskDate === today;
            }).sort((a, b) => a.completed - b.completed);

            container.innerHTML = todayTasks.map(task => `
                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg ${task.completed ? 'opacity-60' : ''}">
                    <div class="flex items-center space-x-3">
                        <button onclick="toggleTask('${task.id}')" class="text-2xl hover:scale-110 transition-transform">
                            ${task.completed ? '‚úÖ' : '‚¨ú'}
                        </button>
                        <div>
                            <div class="font-medium ${task.completed ? 'line-through' : ''}">${task.text}</div>
                            <div class="text-xs text-gray-500 capitalize flex items-center space-x-2">
                                <span>${task.icon} ${task.category}</span>
                                ${task.aiGenerated ? '<span class="bg-purple-100 dark:bg-purple-800 text-purple-600 dark:text-purple-300 px-2 py-0.5 rounded text-xs">üß† AI</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="text-sm font-bold text-primary">+${task.xp} XP</div>
                </div>
            `).join('');

            if (todayTasks.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No quests yet! Add some tasks to get started.</div>';
            }
        }

        function toggleTask(taskId) {
            const task = gameState.tasks.find(t => t.id == taskId);
            if (task) {
                task.completed = !task.completed;
                if (task.completed) {
                    task.completedAt = new Date().toISOString();
                    awardXP(task.xp, `Completed: ${task.text}`);
                    
                    if (task.aiGenerated) {
                        addAchievement('üß† AI Trainee', 'Completed your first AI-generated task!', 50);
                    }
                    
                    checkForStreaks();
                }
                updateTasksList();
                updateAllUI();
                saveGameState();
            }
        }

        // üèÜ XP AND LEVELING SYSTEM - All original functions preserved
        function awardXP(amount, reason) {
            gameState.xp += amount;
            gameState.totalXP += amount;
            
            const xpForNextLevel = gameState.level * 100;
            if (gameState.xp >= xpForNextLevel) {
                levelUp();
            }
            
            updateXPDisplay();
            showXPAnimation(amount, reason);
            saveGameState();
        }

        function levelUp() {
            const oldLevel = gameState.level;
            gameState.level++;
            gameState.xp = gameState.xp - (oldLevel * 100);
            
            addAchievement(`üéâ Level ${gameState.level}!`, `Reached level ${gameState.level}`, gameState.level * 50);
            
            updateXPDisplay();
            showFloatingNotification('üéâ LEVEL UP!', `Welcome to Level ${gameState.level}!`);
            
            const levelElement = document.getElementById('playerLevel');
            levelElement.classList.add('level-up');
            setTimeout(() => levelElement.classList.remove('level-up'), 1000);
        }

        function updateXPDisplay() {
            const xpForNextLevel = gameState.level * 100;
            const progress = (gameState.xp / xpForNextLevel) * 100;
            
            document.getElementById('playerLevel').textContent = `Level ${gameState.level}`;
            document.getElementById('currentXP').textContent = gameState.xp;
            document.getElementById('nextLevelXP').textContent = xpForNextLevel;
            document.getElementById('xpProgress').style.width = `${progress}%`;
        }

        function showXPAnimation(amount, reason) {
            const container = document.createElement('div');
            container.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 xp-burst pointer-events-none';
            container.innerHTML = `
                <div class="bg-yellow-400 text-yellow-900 px-4 py-2 rounded-full font-bold shadow-lg">
                    +${amount} XP
                </div>
                <div class="text-center text-sm text-gray-600 dark:text-gray-400 mt-1">${reason}</div>
            `;
            document.body.appendChild(container);
            
            setTimeout(() => container.remove(), 2000);
        }

        // üìä STATS TRACKING - All original functions preserved
        function trackWater() {
            gameState.dailyStats.waterGlasses++;
            updateAllUI();
            saveGameState();
            awardXP(5, 'Stayed hydrated! üíß');
            
            if (gameState.dailyStats.waterGlasses >= 8) {
                addAchievement('üíß Hydration Hero', 'Drank 8+ glasses of water today!', 25);
            }
        }

        function logMeal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">ü•ó Log Meal</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Calories</label>
                            <input type="number" id="mealCalories" placeholder="Enter calories..." class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <label class="block text-sm font-medium mb-2">Protein (g)</label>
                                <input type="number" id="mealProtein" placeholder="0" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Carbs (g)</label>
                                <input type="number" id="mealCarbs" placeholder="0" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Fat (g)</label>
                                <input type="number" id="mealFat" placeholder="0" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="saveMeal()" class="flex-1 bg-nutrition text-white py-3 rounded-lg hover:bg-green-600">
                                Log Meal
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveMeal() {
            const calories = parseInt(document.getElementById('mealCalories').value) || 0;
            const protein = parseInt(document.getElementById('mealProtein').value) || 0;
            const carbs = parseInt(document.getElementById('mealCarbs').value) || 0;
            const fat = parseInt(document.getElementById('mealFat').value) || 0;

            if (calories > 0) {
                gameState.dailyStats.calories += calories;
                gameState.dailyStats.protein = (gameState.dailyStats.protein || 0) + protein;
                gameState.dailyStats.carbs = (gameState.dailyStats.carbs || 0) + carbs;
                gameState.dailyStats.fat = (gameState.dailyStats.fat || 0) + fat;
                gameState.dailyStats.meals++;

                updateAllUI();
                saveGameState();
                awardXP(15, 'Meal logged! ü•ó');

                document.querySelector('.fixed').remove();
                showFloatingNotification('ü•ó Meal Logged!', `${calories} calories added`);
            }
        }

        function logWorkout() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üí™ Log Workout</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Workout Type</label>
                            <select id="workoutType" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="cardio">üèÉ‚Äç‚ôÇÔ∏è Cardio</option>
                                <option value="strength">üí™ Strength Training</option>
                                <option value="yoga">üßò‚Äç‚ôÄÔ∏è Yoga</option>
                                <option value="sports">‚öΩ Sports</option>
                                <option value="other">üèãÔ∏è‚Äç‚ôÇÔ∏è Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Duration (minutes)</label>
                            <input type="number" id="workoutDuration" placeholder="30" min="5" max="300" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Estimated Calories Burned</label>
                            <input type="number" id="workoutCalories" placeholder="200" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="saveWorkout()" class="flex-1 bg-fitness text-white py-3 rounded-lg hover:bg-red-600">
                                Log Workout
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveWorkout() {
            const duration = parseInt(document.getElementById('workoutDuration').value) || 0;
            const calories = parseInt(document.getElementById('workoutCalories').value) || 0;
            const type = document.getElementById('workoutType').value;

            if (duration > 0) {
                gameState.dailyStats.workouts++;
                gameState.dailyStats.caloriesBurned += calories;
                gameState.dailyStats.exerciseMinutes += duration;

                updateAllUI();
                saveGameState();
                awardXP(duration * 2, `${type} workout completed! üí™`);

                if (gameState.dailyStats.workouts >= 1) {
                    addAchievement('üí™ Workout Warrior', 'Completed a workout today!', 30);
                }

                document.querySelector('.fixed').remove();
                showFloatingNotification('üí™ Workout Logged!', `${duration} minutes of ${type}`);
            }
        }

        function logSteps() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üö∂‚Äç‚ôÇÔ∏è Log Steps</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Steps Count</label>
                            <input type="number" id="stepsInput" placeholder="Enter step count..." min="100" max="50000" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="saveSteps()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600">
                                Log Steps
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveSteps() {
            const steps = parseInt(document.getElementById('stepsInput').value) || 0;

            if (steps > 0) {
                gameState.dailyStats.steps = steps;
                updateAllUI();
                saveGameState();
                awardXP(Math.floor(steps / 100), `${steps.toLocaleString()} steps logged! üö∂‚Äç‚ôÇÔ∏è`);

                if (steps >= 8000) {
                    addAchievement('üö∂‚Äç‚ôÇÔ∏è Step Master', 'Walked 8,000+ steps today!', 40);
                }

                document.querySelector('.fixed').remove();
                showFloatingNotification('üö∂‚Äç‚ôÇÔ∏è Steps Logged!', `${steps.toLocaleString()} steps added`);
            }
        }

        function logSleep() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4">üò¥ Log Sleep</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Hours of Sleep</label>
                            <input type="number" id="sleepHours" placeholder="8" min="1" max="12" step="0.5" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="saveSleep()" class="flex-1 bg-wellness text-white py-3 rounded-lg hover:bg-purple-600">
                                Log Sleep
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveSleep() {
            const hours = parseFloat(document.getElementById('sleepHours').value) || 0;

            if (hours > 0) {
                gameState.dailyStats.sleepHours = hours;
                updateAllUI();
                saveGameState();
                awardXP(hours * 10, `${hours} hours of sleep logged! üò¥`);

                if (hours >= 8) {
                    addAchievement('üò¥ Sleep Champion', 'Got 8+ hours of quality sleep!', 35);
                }

                document.querySelector('.fixed').remove();
                showFloatingNotification('üò¥ Sleep Logged!', `${hours} hours of rest`);
            }
        }

        // üçÖ POMODORO TIMER - All original functions preserved
        function startPomodoro() {
            let timeLeft = 25 * 60;
            let isRunning = false;
            let interval = null;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold mb-4 text-center">üçÖ Pomodoro Timer</h3>
                    <div class="text-center">
                        <div id="pomodoroTimer" class="text-6xl font-bold mb-6 text-focus">25:00</div>
                        <div id="pomodoroStatus" class="text-lg mb-6 text-gray-600 dark:text-gray-400">Ready to focus?</div>
                        <div class="flex space-x-3">
                            <button id="pomodoroStart" onclick="togglePomodoro()" class="flex-1 bg-focus text-white py-3 rounded-lg hover:bg-yellow-600">
                                ‚ñ∂Ô∏è Start
                            </button>
                            <button onclick="resetPomodoro()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                üîÑ Reset
                            </button>
                            <button onclick="this.closest('.fixed').remove(); if(interval) clearInterval(interval);" class="flex-1 bg-red-500 text-white py-3 rounded-lg hover:bg-red-600">
                                ‚ùå Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            function updateDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('pomodoroTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            window.togglePomodoro = function() {
                if (isRunning) {
                    clearInterval(interval);
                    isRunning = false;
                    document.getElementById('pomodoroStart').innerHTML = '‚ñ∂Ô∏è Resume';
                    document.getElementById('pomodoroStatus').textContent = 'Paused';
                } else {
                    isRunning = true;
                    document.getElementById('pomodoroStart').innerHTML = '‚è∏Ô∏è Pause';
                    document.getElementById('pomodoroStatus').textContent = 'Focus time! üß†';
                    
                    interval = setInterval(() => {
                        timeLeft--;
                        updateDisplay();
                        
                        if (timeLeft <= 0) {
                            clearInterval(interval);
                            gameState.dailyStats.focusMinutes += 25;
                            updateAllUI();
                            saveGameState();
                            awardXP(50, 'Completed 25-minute focus session! üçÖ');
                            
                            document.getElementById('pomodoroStatus').textContent = 'üéâ Session Complete!';
                            document.getElementById('pomodoroStart').innerHTML = 'üéä Done!';
                            showFloatingNotification('üçÖ Pomodoro Complete!', '25 minutes of focused work!');
                        }
                    }, 1000);
                }
            };

            window.resetPomodoro = function() {
                clearInterval(interval);
                timeLeft = 25 * 60;
                isRunning = false;
                updateDisplay();
                document.getElementById('pomodoroStart').innerHTML = '‚ñ∂Ô∏è Start';
                document.getElementById('pomodoroStatus').textContent = 'Ready to focus?';
            };
        }

        // üèÜ ACHIEVEMENTS - All original functions preserved
        function addAchievement(title, description, xp) {
            const achievement = {
                id: Date.now(),
                title: title,
                description: description,
                xp: xp,
                unlockedAt: new Date().toISOString()
            };

            gameState.achievements.push(achievement);
            updateAchievementsList();
            saveGameState();
            
            showFloatingNotification('üèÜ Achievement Unlocked!', title);
            awardXP(xp, `Achievement: ${title}`);
        }

        function updateAchievementsList() {
            const container = document.getElementById('achievementsList');
            if (!container) return;
            
            const recentAchievements = gameState.achievements
                .sort((a, b) => new Date(b.unlockedAt) - new Date(a.unlockedAt))
                .slice(0, 5);

            container.innerHTML = recentAchievements.map(achievement => `
                <div class="flex items-center space-x-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-lg">
                    <div class="text-2xl">üèÜ</div>
                    <div class="flex-1">
                        <div class="font-bold">${achievement.title}</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">${achievement.description}</div>
                    </div>
                    <div class="text-sm font-bold text-yellow-600">+${achievement.xp} XP</div>
                </div>
            `).join('');

            if (recentAchievements.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">Complete tasks to unlock achievements!</div>';
            }
        }

        function checkForStreaks() {
            const completedToday = gameState.tasks.filter(t => t.completed && 
                new Date(t.completedAt).toDateString() === new Date().toDateString()).length;
            
            if (completedToday >= 5) {
                addAchievement('üî• Task Master', 'Completed 5+ tasks in one day!', 50);
            }
        }

        // üìä HABIT TRACKER - All original functions preserved
        function showHabitTracker() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center">üìä Habit Tracker</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold mb-4">üéØ Today's Goals</h4>
                            <div class="space-y-3">
                                ${getHabitProgress().map(habit => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="text-xl">${habit.icon}</div>
                                            <div>
                                                <div class="font-medium">${habit.name}</div>
                                                <div class="text-xs text-gray-500">${habit.current}/${habit.goal} ${habit.unit}</div>
                                            </div>
                                        </div>
                                        <div class="w-20 bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                            <div class="bg-${habit.color} h-full rounded-full" style="width: ${Math.min(100, (habit.current/habit.goal)*100)}%"></div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold mb-4">üìà Quick Stats</h4>
                            <div class="space-y-3">
                                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-blue-600">${gameState.level}</div>
                                    <div class="text-sm text-blue-500">Current Level</div>
                                </div>
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600">${gameState.totalXP.toLocaleString()}</div>
                                    <div class="text-sm text-green-500">Total XP Earned</div>
                                </div>
                                <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/30 dark:to-pink-900/30 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-purple-600">${gameState.achievements.length}</div>
                                    <div class="text-sm text-purple-500">Achievements Unlocked</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getHabitProgress() {
            return [
                {
                    name: 'Steps',
                    icon: 'üö∂‚Äç‚ôÇÔ∏è',
                    current: gameState.dailyStats.steps,
                    goal: 8000,
                    unit: 'steps',
                    color: 'orange-500'
                },
                {
                    name: 'Water',
                    icon: 'üíß',
                    current: gameState.dailyStats.waterGlasses,
                    goal: 8,
                    unit: 'glasses',
                    color: 'blue-500'
                },
                {
                    name: 'Focus',
                    icon: 'üß†',
                    current: gameState.dailyStats.focusMinutes,
                    goal: 120,
                    unit: 'minutes',
                    color: 'yellow-500'
                },
                {
                    name: 'Sleep',
                    icon: 'üò¥',
                    current: gameState.dailyStats.sleepHours,
                    goal: 8,
                    unit: 'hours',
                    color: 'purple-500'
                },
                {
                    name: 'Workouts',
                    icon: 'üí™',
                    current: gameState.dailyStats.workouts,
                    goal: 1,
                    unit: 'sessions',
                    color: 'red-500'
                }
            ];
        }

        // üë§ PROFILE MANAGEMENT - All original functions preserved
        function showProfile() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center">üë§ Player Profile</h3>
                    
                    <div class="space-y-4">
                        <div class="text-center mb-6">
                            <div class="text-4xl mb-2">üéÆ</div>
                            <div class="text-xl font-bold">Level ${gameState.level} Player</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">${gameState.totalXP.toLocaleString()} Total XP</div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Age</label>
                                <input type="number" id="profileAge" value="${gameState.profile.age || ''}" placeholder="25" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Weight (lbs)</label>
                                <input type="number" id="profileWeight" value="${gameState.profile.weight || ''}" placeholder="150" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Height (inches)</label>
                            <input type="number" id="profileHeight" value="${gameState.profile.height || ''}" placeholder="68" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Activity Level</label>
                            <select id="profileActivity" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="sedentary" ${gameState.profile.activityLevel === 'sedentary' ? 'selected' : ''}>Sedentary (desk job)</option>
                                <option value="light" ${gameState.profile.activityLevel === 'light' ? 'selected' : ''}>Light activity</option>
                                <option value="moderate" ${gameState.profile.activityLevel === 'moderate' ? 'selected' : ''}>Moderate activity</option>
                                <option value="very" ${gameState.profile.activityLevel === 'very' ? 'selected' : ''}>Very active</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Fitness Goal</label>
                            <select id="profileGoal" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="lose_weight" ${gameState.profile.fitnessGoal === 'lose_weight' ? 'selected' : ''}>Lose weight</option>
                                <option value="maintain" ${gameState.profile.fitnessGoal === 'maintain' ? 'selected' : ''}>Maintain weight</option>
                                <option value="gain_weight" ${gameState.profile.fitnessGoal === 'gain_weight' ? 'selected' : ''}>Gain weight</option>
                                <option value="build_muscle" ${gameState.profile.fitnessGoal === 'build_muscle' ? 'selected' : ''}>Build muscle</option>
                            </select>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveProfile()" class="flex-1 bg-primary text-white py-3 rounded-lg hover:bg-purple-600">
                                Save Profile
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveProfile() {
            const age = parseInt(document.getElementById('profileAge').value);
            const weight = parseInt(document.getElementById('profileWeight').value);
            const height = parseInt(document.getElementById('profileHeight').value);
            const activityLevel = document.getElementById('profileActivity').value;
            const fitnessGoal = document.getElementById('profileGoal').value;

            gameState.profile = {
                age: age || null,
                weight: weight || null,
                height: height || null,
                activityLevel: activityLevel,
                fitnessGoal: fitnessGoal,
                bmr: calculateBMR(age, weight, height, 'male')
            };

            saveGameState();
            showFloatingNotification('‚úÖ Profile Saved!', 'Your health profile has been updated');
            
            document.querySelector('.fixed').remove();
            showAIInsights();
        }

        function calculateBMR(age, weight, height, gender) {
            if (!age || !weight || !height) return 1800;
            
            const bmr = (10 * (weight * 0.453592)) + (6.25 * (height * 2.54)) - (5 * age);
            return gender === 'male' ? bmr + 5 : bmr - 161;
        }

        // üîî NOTIFICATION SYSTEM - All original functions preserved
        function showNotificationSettings() {
            if (!gameState.settings.reminderTimes) {
                gameState.settings.reminderTimes = {
                    water: ['09:00', '12:00', '15:00', '18:00'],
                    workout: ['07:00', '17:00'],
                    tasks: ['09:00', '14:00'],
                    sleep: ['22:00']
                };
            }
            
            const hasNotifications = 'Notification' in window;
            const notificationStatus = hasNotifications ? Notification.permission : 'Not supported';
            const canEnable = hasNotifications && Notification.permission !== 'granted';
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-4">üîî Reminder Settings</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Browser Notifications</h4>
                            <div class="text-sm mb-3">
                                Status: <span class="font-mono">${notificationStatus}</span>
                                ${canEnable ? '<button onclick="requestNotificationPermission()" class="ml-2 bg-primary text-white px-3 py-1 rounded text-xs">Enable</button>' : ''}
                                ${notificationStatus === 'granted' ? '<span class="ml-2 text-green-600">‚úì Enabled</span>' : ''}
                            </div>
                        </div>
                        
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="enableReminders" ${gameState.settings.reminders ? 'checked' : ''} onchange="toggleReminders()" class="rounded">
                                <span>Enable Smart Reminders</span>
                            </label>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="saveReminderSettings()" class="flex-1 bg-primary text-white py-2 rounded hover:bg-purple-600">
                                Save Settings
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        showFloatingNotification('üîî Notifications Enabled', 'You will now receive smart reminders!');
                    } else {
                        showFloatingNotification('‚ùå Notifications Blocked', 'Enable in browser settings to get reminders');
                    }
                    
                    document.querySelector('.fixed').remove();
                    showNotificationSettings();
                });
            }
        }

        function toggleReminders() {
            gameState.settings.reminders = document.getElementById('enableReminders').checked;
            saveGameState();
        }

        function saveReminderSettings() {
            toggleReminders();
            saveGameState();
            
            document.querySelector('.fixed').remove();
            showFloatingNotification('üíæ Settings Saved', 'Reminder preferences updated');
        }

        // üì± APPLE HEALTH INTEGRATION - All original functions preserved
        function showAppleHealthSetup() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-6 text-center">üì± Apple Health Auto-Sync Setup</h3>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg mb-6">
                        <h4 class="font-bold mb-3">‚ú® Coming Soon!</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            Automatic Apple Health sync will be available in a future update. 
                            For now, you can manually log your health data.
                        </p>
                    </div>
                    
                    <div class="flex justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                            Close
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function importHealthData() {
            showFloatingNotification('üì± Health Import', 'Manual logging available - use the Health tab options');
        }

        function showHealthStatus() {
            showFloatingNotification('üìä Health Status', 'All health features are working normally');
        }

        function checkForHealthData() {
            const urlParams = new URLSearchParams(window.location.search);
            const healthData = {};
            
            if (urlParams.get('steps')) healthData.steps = parseInt(urlParams.get('steps'));
            if (urlParams.get('sleep')) healthData.sleep = parseFloat(urlParams.get('sleep'));
            if (urlParams.get('workouts')) healthData.workouts = parseInt(urlParams.get('workouts'));
            
            if (Object.keys(healthData).length > 0) {
                processHealthData(healthData);
                
                setTimeout(() => {
                    const newUrl = window.location.pathname;
                    window.history.replaceState({}, document.title, newUrl);
                }, 5000);
                
                return true;
            }
            return false;
        }

        function processHealthData(data) {
            let xpAwarded = 0;
            let updates = [];
            
            if (data.steps && data.steps > 0) {
                const oldSteps = gameState.dailyStats.steps;
                gameState.dailyStats.steps = data.steps;
                
                if (data.steps > oldSteps) {
                    xpAwarded += Math.floor((data.steps - oldSteps) / 100);
                }
                
                updates.push(`${data.steps.toLocaleString()} steps`);
                
                if (data.steps >= 8000) {
                    addAchievement('üì± Health Sync Step Master', 'Reached 8,000+ steps via health sync!', 50);
                }
            }
            
            if (data.sleep && data.sleep > 0) {
                const oldSleep = gameState.dailyStats.sleepHours;
                gameState.dailyStats.sleepHours = data.sleep;
                
                if (data.sleep > oldSleep) {
                    xpAwarded += (data.sleep - oldSleep) * 10;
                }
                
                updates.push(`${data.sleep}h sleep`);
                
                if (data.sleep >= 8) {
                    addAchievement('üì± Health Sync Sleep Champion', 'Logged 8+ hours sleep via health sync!', 40);
                }
            }
            
            if (data.workouts && data.workouts >= 0) {
                const oldWorkouts = gameState.dailyStats.workouts;
                gameState.dailyStats.workouts = data.workouts;
                
                if (data.workouts > oldWorkouts) {
                    xpAwarded += (data.workouts - oldWorkouts) * 50;
                }
                
                updates.push(`${data.workouts} workouts`);
            }
            
            updateAllUI();
            saveGameState();
            
            if (xpAwarded > 0) {
                awardXP(xpAwarded, 'Health data synced! üì±');
            }
            
            showFloatingNotification('üì± Health Synced!', updates.join(', '));
            
            if (!gameState.achievements.find(a => a.title.includes('Health Sync'))) {
                addAchievement('üì± Health Connected', 'Successfully synced health data!', 100);
            }
        }

        // üöÄ UI UPDATES
        function updateAllUI() {
            updateStatsDisplay();
            updateXPDisplay();
            updateTasksList();
            updateAchievementsList();
            updateExerciseStats();
            updateWeeklyPlan();
            showAIInsights();
        }

        function updateStatsDisplay() {
            const stats = gameState.dailyStats;
            
            const elements = {
                'stepsCount': stats.steps.toLocaleString(),
                'waterCount': stats.waterGlasses,
                'caloriesCount': stats.calories.toLocaleString(),
                'focusCount': stats.focusMinutes,
                'sleepCount': stats.sleepHours || 0,
                'workoutCount': stats.workouts,
                'exerciseWorkouts': stats.workouts,
                'exerciseCalories': stats.caloriesBurned,
                'exerciseMinutes': stats.exerciseMinutes || 0,
                'workoutStreak': gameState.streaks.workout || 0,
                'totalMinutes': stats.exerciseMinutes || 0
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });

            // Update weekly progress
            const weeklyProgress = document.getElementById('weeklyProgress');
            if (weeklyProgress) {
                weeklyProgress.textContent = `${stats.workouts}/5`;
            }
        }

        function updateExerciseStats() {
            const stats = gameState.dailyStats;
            
            const exerciseElements = {
                'exerciseWorkouts': stats.workouts,
                'exerciseCalories': stats.caloriesBurned,
                'exerciseMinutes': stats.exerciseMinutes || 0
            };

            Object.entries(exerciseElements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function updateTasksListDetailed() {
            const container = document.getElementById('tasksListDetailed');
            if (!container) return;
            
            const todayTasks = gameState.tasks.filter(task => {
                const taskDate = new Date(task.createdAt).toDateString();
                const today = new Date().toDateString();
                return taskDate === today;
            }).sort((a, b) => a.completed - b.completed);

            container.innerHTML = todayTasks.map(task => `
                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg ${task.completed ? 'opacity-60' : ''}">
                    <div class="flex items-center space-x-3">
                        <button onclick="toggleTask('${task.id}')" class="text-3xl hover:scale-110 transition-transform">
                            ${task.completed ? '‚úÖ' : '‚¨ú'}
                        </button>
                        <div>
                            <div class="font-medium ${task.completed ? 'line-through' : ''}">${task.text}</div>
                            <div class="text-sm text-gray-500 capitalize flex items-center space-x-2">
                                <span>${task.icon} ${task.category}</span>
                                ${task.aiGenerated ? '<span class="bg-purple-100 dark:bg-purple-800 text-purple-600 dark:text-purple-300 px-2 py-0.5 rounded text-xs">üß† AI</span>' : ''}
                                ${task.completed ? `<span class="text-xs text-green-600">Completed ${new Date(task.completedAt).toLocaleTimeString()}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-primary">+${task.xp} XP</div>
                        ${task.completed ? '<div class="text-xs text-green-600">‚úì Earned</div>' : ''}
                    </div>
                </div>
            `).join('');

            if (todayTasks.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-12">No quests yet! Add some tasks to get started.</div>';
            }
        }

        function updateAchievementsListDetailed() {
            const container = document.getElementById('achievementsListDetailed');
            if (!container) return;
            
            const allAchievements = gameState.achievements
                .sort((a, b) => new Date(b.unlockedAt) - new Date(a.unlockedAt));

            container.innerHTML = allAchievements.map(achievement => `
                <div class="flex items-center space-x-4 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-lg border border-yellow-200 dark:border-yellow-800">
                    <div class="text-3xl">üèÜ</div>
                    <div class="flex-1">
                        <div class="font-bold text-yellow-800 dark:text-yellow-200">${achievement.title}</div>
                        <div class="text-sm text-yellow-700 dark:text-yellow-300">${achievement.description}</div>
                        <div class="text-xs text-yellow-600 dark:text-yellow-400 mt-1">
                            Unlocked ${new Date(achievement.unlockedAt).toLocaleDateString()} at ${new Date(achievement.unlockedAt).toLocaleTimeString()}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-bold text-yellow-600">+${achievement.xp}</div>
                        <div class="text-xs text-yellow-500">XP</div>
                    </div>
                </div>
            `).join('');

            if (allAchievements.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-12">Complete tasks to unlock achievements!</div>';
            }
        }

        function updateHealthProgress() {
            const container = document.getElementById('healthProgressContainer');
            if (!container) return;
            
            const habits = getHabitProgress();
            
            container.innerHTML = habits.map(habit => `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="text-xl">${habit.icon}</div>
                        <div>
                            <div class="font-medium">${habit.name}</div>
                            <div class="text-xs text-gray-500">${habit.current}/${habit.goal} ${habit.unit}</div>
                        </div>
                    </div>
                    <div class="w-24 bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                        <div class="bg-${habit.color} h-full rounded-full" style="width: ${Math.min(100, (habit.current/habit.goal)*100)}%"></div>
                    </div>
                </div>
            `).join('');
        }

        function updateSettingsStats() {
            const elements = {
                'settingsLevel': gameState.level,
                'settingsTotalXP': gameState.totalXP.toLocaleString(),
                'settingsAchievements': gameState.achievements.length,
                'settingsTasks': gameState.tasks.length
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        // üí´ NOTIFICATIONS
        function showFloatingNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'floating-notification bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border-l-4 border-primary max-w-sm';
            notification.innerHTML = `
                <div class="font-bold text-gray-900 dark:text-white">${title}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">${message}</div>
            `;
            
            document.getElementById('notificationsContainer').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // üß≠ TAB NAVIGATION
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            event.target.classList.add('active');
            
            switch(tabName) {
                case 'exercise':
                    updateExerciseStats();
                    updateWeeklyPlan();
                    break;
                case 'tasks':
                    updateTasksListDetailed();
                    updateAchievementsListDetailed();
                    break;
                case 'health':
                    updateHealthProgress();
                    break;
                case 'settings':
                    updateSettingsStats();
                    break;
            }
        }

        // üöÄ START THE APPLICATION
        window.addEventListener('load', initializeApp);
        
        // Listen for health data from iOS shortcuts
        window.addEventListener('focus', () => {
            checkForHealthData();
        });
        
        window.addEventListener('popstate', () => {
            checkForHealthData();
        });
    </script>
</body>
</html>
